 <!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ áˆ˜á‰°áŒá‰ áˆªá‹«</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<style>
        /* ==============================================================
           === NEW: Loading Screen Styles (áŒ¥á‰áˆ© á‹¨áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŒˆáŒ½) ===
           ============================================================== */
        #loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #17212b; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999; 
            transition: opacity 0.5s ease-out; 
            opacity: 1;
            /* ğŸ›‘ NEW: á‹³áˆ«á‹ áˆˆáˆµáˆ‹áˆ³ á‰¥áˆ­áˆƒáŠ• áŠ¥áŠ•á‹²á‹«áˆ˜áŠáŒ­ */
            box-shadow: 0 0 100px rgba(255, 193, 7, 0.1) inset;
        }
        
        /* ğŸ›‘ NEW: á‹¨áˆ³áŠ•á‰²áˆ™áŠ• áˆáˆµáˆ á‹­á‰ áˆáŒ¥ á‰†áŠ•áŒ† á‹¨áˆšá‹«á‹°áˆ­áŒˆá‹ CSS */
        #coin-image {
            width: 70px; 
            height: 70px;
            margin-bottom: 20px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.8), 
                        0 0 30px rgba(255, 215, 0, 0.5); /* Glowing Effect */
            /* ğŸ›‘ NEW: á‹¨3D á‹ˆáˆ­á‰… áŒˆáŒ½á‰³ áˆˆáˆ˜áˆµáŒ á‰µ */
            background: radial-gradient(circle at 60% 30%, #FFD700, #DAA520, #FFD700 80%, #B8860B);
            /* ğŸ›‘ NEW: áŒ áˆ­á‹ áˆ‹á‹­ á‰µáŠ•áˆ½ áŒˆáŒ½á‰³ áˆˆáˆ˜áˆµáŒ á‰µ */
            border: 5px solid #FFECB3; 
        }

        #loading-text {
            /* ğŸ›‘ IMPROVED: áŒ½áˆá‰ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
            color: #FFC107; 
            font-size: 1.1em;
            font-weight: 300; /* Boldest */
            margin-top: 15px;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
            /* ğŸ›‘ NEW: á‹¨áŒ½áˆá á‰¥áˆ­áˆƒáŠ• áŠ¥áŠ•á‹²á‹«áˆ˜áŠáŒ­ */
            animation: pulse-glow 2s infinite alternate; 
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        /* ğŸ›‘ NEW: á‹¨á‰¥áˆ­áˆƒáŠ• áŠ•á‹áˆ¨á‰µ (Pulsating Glow) */
        @keyframes pulse-glow {
            from {
                text-shadow: 0 0 5px rgba(255, 193, 7, 0.5), 0 0 10px rgba(255, 193, 7, 0.3);
            }
            to {
                text-shadow: 0 0 15px #FFC107, 0 0 25px rgba(255, 215, 0, 0.7);
            }
        }
        
        /* ğŸ›‘ NEW: áˆˆáŠ á‹¶á‹á‰½ á‹¨áˆšáŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ (Floating Effect) */
        @keyframes icon-float {
            0% { transform: translateY(0); box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
            50% { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7); }
            100% { transform: translateY(0); box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        }

        /* ğŸ›‘ NEW: áˆˆ Luck Slot áŠ á‹¶ á‰¥áˆ­áˆƒáŠ• áˆ›áˆ˜áŠ•áŒ¨á‰µ (Pulsating Glow) */
        @keyframes slot-glow {
            from {
                box-shadow: 0 0 8px rgba(255, 140, 0, 0.7);
            }
            to {
                box-shadow: 0 0 20px #FF8C00, 0 0 30px rgba(255, 215, 0, 0.9);
            }
        }

        .coin-spinner {
            animation: spin 1.5s linear infinite; 
        }
        /* ==============================================================
           === Loading Screen Styles áˆ˜áŒ¨áˆ¨áˆ» ===
           ============================================================== */
      


     
        /* CSS Styles */
        :root {
            --et-yellow: #FFC107;
            --et-green: #4CAF50;
            --et-purple: #9C27B0;
            --et-red: #F44336;
            --et-blue: #2196F3;
            
            /* âœ… ğŸ›‘ á‰´áˆŒáŒáˆ«áˆ áˆ‹á‹­ áŒ¥áŒˆáŠ› á‹¨áŠá‰ áˆ© á‰€áˆˆáˆá‰½ áŠ¥á‹šáˆ… á‰‹áˆš á‰°á‹°áˆ­áŒˆá‹‹áˆ */
            --tg-bg: #1b2129;
            --tg-secondary-bg: #181818;
            --tg-text: #FFFFFF;
            --tg-hint: #AAAAAA;
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding-bottom: 70px; 
            overflow-x: hidden;
        }

        #root {
            min-height: calc(100vh - 70px);
            box-sizing: border-box;
            padding: 0 15px 15px 15px;
        }

        /* --- Global Title --- */
        .page-title {
            color: var(--et-yellow);
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding-top: 15px;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.5); /* ğŸ›‘ NEW: áˆˆ Title áŒ¥áˆ‹ */
        }
        
        /* ğŸ›‘ NEW: áˆˆ Score Display á‹¨áˆšáˆ†áŠ• áŠ«áˆ­á‹µ */
        .score-card-display {
            text-align: center; 
            font-size: 18px; 
            font-weight: bold; 
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 10px;
            /* ğŸ›‘ NEW: á‹ˆáˆ­á‰ƒáˆ› ááˆ¬áˆ áŠ¥áŠ“ áŒ¥á‰áˆ­ á‹³áˆ« */
            border: 2px solid var(--et-yellow); 
            background-color: var(--tg-secondary-bg);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }



        /* --- Task and Card Styling --- */
        .daily-tasks-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }
        .task-button {
            flex: 1 1 30%;
            padding: 15px 5px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            font-size: 14px;
            color: #212121;
            position: relative;
            cursor: pointer;
            text-align: center;
            min-width: 80px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, opacity 0.1s; /* ğŸ›‘ NEW: áˆˆáˆµáˆ‹áˆ³ áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´ */
        }
        /* ğŸ›‘ NEW: Task Button áˆ²áŒ«áŠ• */
        .task-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .task-button span {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            /* ğŸ›‘ IMPROVED: á‹¨áŒ½áˆá á‰€áˆˆáˆ */
            color: rgba(33, 33, 33, 0.8); 
        }
        .card-button {
            background-color: #333333;
            color: var(--tg-text);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: left;
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            cursor: pointer;
           box-shadow: 0 0 0 2px red, 0 0 10px #FFC107;
    transition: box-shadow 0.3s;  
          IMPROVED: á‹¨á‰°áˆ»áˆˆ á‹¨áŒ¥áˆ‹ áŒˆáŒ½á‰³ */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        /* ğŸ›‘ NEW: Card Button áˆ²áŒ«áŠ•/ áˆ²áŠáŠ« */
        .card-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        .card-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        /* ğŸ›‘ NEW: Cooldown Style for Cards */
        .card-button.cooldown-style {
            opacity: 0.6; /* ğŸ›‘ IMPROVED: á‹­á‰ áˆáŒ¥ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
            /* pointer-events: none; - á‰ JS á‰°áˆµá‰°áŠ«áŠ­áˆáˆ */
        }

        .card-icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ NEW: áˆˆáŠ á‹¶ áŒ¥áˆ‹ */
            /* âœ… NEW: á‹¨áˆ˜áŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ */
            animation: icon-float 2s infinite alternate ease-in-out; 
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        /* ğŸ›‘ NEW: áˆˆ "Day Spin" áŠ á‹¶ áˆá‹© á‹˜á‹­á‰¤ */
        .card-icon-circle.daily-spin-icon {
            /* á‹¨ Day Spin áŠ á‹¶á‹ áŠ¥áŠ•á‹²áˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŠ¥áŠ“ áŠ¥áŠ•á‹²áŠ•áˆ³áˆá á‹«á‹°áˆ­áŒ‹áˆ */
            background-color: var(--et-purple); 
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.8);
            animation: spin 1.5s linear infinite, icon-float 2s infinite alternate ease-in-out; 
        }

        /* ğŸ›‘ NEW: áˆˆ "Luck Slot" áŠ á‹¶ áˆá‹© á‹˜á‹­á‰¤ */
        .card-icon-circle.luck-slot-icon {
            /* á‹¨ Luck Slot áŠ á‹¶á‹ á‰ á‰¥áˆ­á‰± áŠ¥áŠ•á‹²á‹«áŠ•áŒ¸á‰£áˆ­á‰… áŠ¥áŠ“ áŠ¥áŠ•á‹²áŠ•áˆ³áˆá á‹«á‹°áˆ­áŒ‹áˆ */
            background-color: #FF8C00; /* Darker Orange */
            border: 2px solid var(--et-yellow);
            font-size: 28px; 
            animation: slot-glow 3s infinite alternate, icon-float 2s infinite alternate ease-in-out;
        }

        .card-text-container {
            flex-grow: 1;
            margin-right: 10px; 
        }
        .card-title {
            font-size: 16px;
            font-weight: bold;
        }
        .card-subtitle {
            font-size: 12px;
            color: var(--tg-hint);
        }

        /* ğŸ›‘ NEW BADGE STYLES */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
            margin-left: auto;
            transition: background-color 0.3s, box-shadow 0.3s; /* ğŸ›‘ NEW */
        }
        .status-badge.ready {
            background-color: var(--et-green); 
            color: white;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.7); /* ğŸ›‘ IMPROVED: á‹¨áˆšá‹«á‰ áˆ« Ready */
        }
        .status-badge.cooldown {
            background-color: var(--et-red); 
            color: white;
        }

        .arrow-icon {
            font-size: 24px;
            color: var(--et-yellow);
            margin-left: 10px;
            flex-shrink: 0;
        }
        
        
        
        /* =========================================================
           ğŸ›‘ NEW: Social Tasks Styles
           ========================================================= */
        .social-tasks-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--tg-text);
            margin-bottom: 5px;
      
        }
        .social-tasks-subtitle {
            font-size: 14px;
            color: var(--tg-hint);
            margin-bottom: 20px;
        }
        .social-task-card {
            background-color: #242424; /* áŒ¥á‰áˆ­ á‹³áˆ« áŠ¨áˆáˆµáˆ‰ áŒ‹áˆ­ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ */
            padding: 15px;
            border-radius: 15px; /* á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ */
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
        }
        .social-task-icon-container {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            flex-shrink: 0;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
            /* âœ… NEW: á‹¨áˆ˜áŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ */
            animation: icon-float 2s infinite alternate ease-in-out; 
        }
        .social-task-text-container {
            flex-grow: 1;
        }
        .social-task-title {
            font-weight: bold;
            font-size: 16px;
            color: white;
            margin-bottom: 3px;
        }
        .social-task-reward {
            font-size: 14px;
            color: var(--et-yellow); 
            font-weight: bold;
        }
        .social-task-action-button {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .social-task-action-button.join-style {
            background-color: var(--et-blue); 
            color: white;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
        }
        .social-task-action-button.join-style:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #1565C0;
        }
        .social-task-action-button.completed-style {
            background-color: #555;
            color: var(--tg-text);
            cursor: not-allowed;
        }
        .social-task-action-button .check-icon {
            margin-left: 5px;
            font-size: 16px;
            color: var(--et-yellow);
        }

        /* =========================================================
           ğŸ›‘ NEW: Daily Reward Modal Styles (á‰ áˆáˆµáˆ‰ áˆ˜áˆ°áˆ¨á‰µ á‹¨á‰°áˆ°áˆ«)
           ========================================================= */
        #daily-reward-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none; /* á‰  JS á‹­áŠ¨áˆá‰³áˆ */
            align-items: center;
            justify-content: center;
        }

        .reward-content {
            background-color: var(--tg-bg);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
        }
        
        .reward-content h2 {
            margin-top: 0;
            color: var(--et-yellow);
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .reward-content p {
            font-size: 14px;
            color: var(--tg-hint);
            margin-bottom: 20px;
        }

        .reward-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .reward-day-card {
            background-color: var(--tg-secondary-bg);
            padding: 10px 5px;
            border-radius: 8px;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .reward-day-card.claimed {
            background-color: #333;
            border-color: var(--et-green);
        }

        .reward-day-card.active-ready {
            background-color: var(--et-purple); /* áˆáˆµáˆ‰ áˆ‹á‹­ áŠ¥áŠ•á‹³áˆˆá‹ */
            border-color: var(--et-yellow);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
        
        .reward-day-card.active-ready:active {
            transform: translateY(2px);
        }
        
        .reward-day-card span {
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
            color: var(--et-yellow);
        }
        
        .reward-day-card.claimed span {
            color: var(--tg-hint);
            text-decoration: line-through;
        }

        .reward-coin-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(circle at 60% 30%, #FFD700, #DAA520, #FFD700 80%, #B8860B);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 900;
            color: #444;
            box-shadow: 0 0 5px rgba(255, 193, 7, 0.8);
            margin-bottom: 3px;
        }

        #daily-reward-claim-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 0 #388E3C;
            transition: all 0.1s ease;
        }
        
        #daily-reward-claim-button:disabled {
            background-color: #555;
            box-shadow: 0 4px 0 #333;
            cursor: not-allowed;
        }

        #daily-reward-claim-button:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #388E3C;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--tg-hint);
            font-size: 24px;
            cursor: pointer;
        }





        /* =========================================================
           ğŸ›‘ NEW: Social Tasks Styles áˆ˜áŒ¨áˆ¨áˆ»
           ========================================================= */

/* ====================================================================== */
/* === GLOBAL & THEME VARIABLES === */
/* ====================================================================== */
:root {
    /* á‰¥áŒ á‰€áˆˆáˆá‰½ */
    --et-blue: #1976D2;          /* áˆ°áˆ›á‹«á‹Š */
    --et-yellow: #FFC300;        /* á‹‹áŠ“ á‰¢áŒ« áŠ áŠ­áˆ°áŠ•á‰µ (Gold) */
    --et-yellow-dark: #cc9c00;   /* áˆˆáŒ¥áˆ‹ (Shadow) */
    --et-red: #F44336;           /* á‰€á‹­ */
    --et-green: #4CAF50;         /* áŠ áˆ¨áŠ•áŒ“á‹´ */
    
    /* á‹³áˆ« áŠ¥áŠ“ á…áˆá (á‰‹áˆš áŒ¥á‰áˆ­ áŒˆáŒ½á‰³) */
    --bg-primary: #121212;       /* áŒ¥áˆá‰… áŒ¥á‰áˆ­ á‹³áˆ« */
    --bg-card: #2B2B2B;          /* á‹¨áŠ«áˆ­á‹µ á‹³áˆ« */
    --text-light: #F0F0F0;       /* á‰€áˆ‹áˆ á‹¨á…áˆá á‰€áˆˆáˆ */
    --text-grey: #A0A0A0;        /* áŒáˆ«áŒ«áˆ› á‹¨á…áˆá á‰€áˆˆáˆ */
    --shadow-dark: rgba(0, 0, 0, 0.7); /* áŒ¥áˆá‰… áŒ¥áˆ‹ */

    /* === áˆˆáŠ áŠ’áˆœáˆ½áŠ• áŠ á‹²áˆµ á‰°áˆˆá‹‹á‹‹áŒ®á‰½ === */
    --glow-color: var(--et-yellow);
    --glow-secondary: rgba(255, 195, 0, 0.15); /* á‰µáŠ•áˆ½ á‹°á‰¥á‹›á‹› á‰¢áŒ« */
}



/* ====================================================================== */
/* === KEYFRAMES FOR ANIMATION (áŠ á‹²áˆµ á‹¨á‰°áŒ¨áˆ˜áˆ¨) === */
/* ====================================================================== */
@keyframes spinBorder {
    0% {
        box-shadow: 0 0 0 2px var(--glow-secondary), 0 0 15px var(--glow-color);
        border-color: var(--glow-color); /* áŒ áŠ•áŠ«áˆ« á‰¥áˆ­áˆƒáŠ• */
    }
    50% {
        box-shadow: 0 0 0 0px var(--glow-secondary), 0 0 5px var(--glow-secondary);
        border-color: var(--glow-secondary); /* á‹°á‰¥á‹˜á‹ á‹«áˆˆ á‰¥áˆ­áˆƒáŠ• */
    }
    100% {
        box-shadow: 0 0 0 2px var(--glow-secondary), 0 0 15px var(--glow-color);
        border-color: var(--glow-color);
    }
}




/* ====================================================================== */
/* === BASE STYLES & LAYOUT === */
/* ====================================================================== */
/* á‹¨áŒ‹áˆ« á‰°áˆˆá‹‹á‹‹áŒ®á‰½ (Variables) */
{
    background-color: var(--bg-primary); 
    color: var(--text-light);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    padding: 20px; /* áˆˆáŠ®á‹± áˆ›áˆ³á‹« */
}



/* ====================================================================== */
/* === INVITE CARD STYLES (Glow Animation á‹¨á‰°áŒ¨áˆ˜áˆ¨á‰ á‰µ) === */
/* ====================================================================== */
.invite-card-container {
    /* áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆƒáˆ áˆˆáˆ›á‹µáˆ¨áŒ á‰ áˆ™áˆ‰ HTML á‹áˆµáŒ¥ á‹¨áŠá‰ áˆ¨á‹áŠ• `invite-card-container` áŠ­ááˆ á‹­áŒ á‰€áˆ™ */
    padding: 0; 
}

/* á‹¨áŠ«áˆ­á‹± á‹‹áŠ“ áˆ˜á‹«á‹£ */
.invite-card {
    background-color: var(--bg-card); 
    padding: 10px;
    border-radius: 18px; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ */
    box-shadow: 0 8px 30px var(--shadow-dark); /* á‹­á‰ áˆáŒ¥ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‹ˆáŒ£ áŒ¥áˆá‰… áŒ¥áˆ‹ */
    width: 330px;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 10px; /* á‰  header áŠ¥áŠ“ button áˆ˜áŠ«áŠ¨áˆ á‰µáˆá‰… áŠ­áá‰°á‰µ */
    
    /* === áˆˆ Animation áŠ¥áŠá‹šáˆ… áˆáˆˆá‰µ áˆ˜áˆµáˆ˜áˆ®á‰½ á‰¥á‰» á‰°áŒ¨áˆáˆ¨á‹‹áˆ === */
    border: 2px solid var(--glow-secondary); /* á‹¨ Border áˆµá‰³á‹­áˆáŠ• á‹ˆá‹° 2px áŠ á‹µáˆ­áŒˆáŠ“áˆ */
    animation: spinBorder 2.5s infinite alternate ease-in-out; /* áŠ á‹²áˆµ áŠ áŠ’áˆœáˆ½áŠ• */
  margin-bottom:20px;
}

/* á‹¨áˆ‹á‹­áŠ›á‹ áŠ­ááˆ (áŠ á‹­áŠ®áŠ• áŠ¥áŠ“ á…áˆáá‰½) */
.header-section {
    display: flex;
    align-items: center;
}

.icon-circle {
    background-color: var(--et-yellow); 
    color: var(--bg-card); 
    width: 48px; /* á‰µáˆá‰… áŠ á‹­áŠ®áŠ• */
    height: 48px;
    border-radius: 12px; /* áŠ«áˆ¬á£ á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ á‹«áˆˆá‹ */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px; /* á‰µáˆá‰… ááŠ•á‰µ */
    font-weight: 900; /* á‰ áŒ£áˆ á‹¨á‹°áˆ˜á‰€ */
    margin-right: 15px;
    box-shadow: 0 0 10px rgba(255, 195, 0, 0.5); /* á‹¨á‰¢áŒ«á‹ á‰¥áˆ­áˆƒáŠ• */
}

.title {
    font-size: 17px;
    font-weight: 700;
    margin: 0;
    color: var(--text-light);
}

.subtitle {
    font-size: 12px;
    margin: 4px 0 0 0;
    color: var(--text-grey); 
    line-height: 1.4;
    font-style: italic; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ áŒ½áˆ‘á */
}



/* ====================================================================== */
/* === BUTTONS SECTION === */
/* ====================================================================== */
.button-row {
    display: flex;
    gap: 12px; /* á‰ á‰áˆáá‰¹ áˆ˜áŠ«áŠ¨áˆ á‹«áˆˆ áŠ­áá‰°á‰µ á‹­áŒ¨áˆáˆ«áˆ */
}

/* --- INVITE BUTTON (3D EFFECT) --- */
.invite-button {
    text-decoration: none; /* áˆˆ <a> tag */
    width: 100%;
    height: 45px; /* á‰áˆ˜á‰±áŠ• á‹­áŒ¨áˆáˆ«áˆ */
    padding: 0 15px;
    border: none;
    border-radius: 12px;
    background-color: var(--et-yellow); 
    color: var(--bg-card); 
    font-weight: 800;
    font-size: 16px;
    cursor: pointer;
    
    /* 3D/Raised Effect */
    box-shadow: 0 5px 0 var(--et-yellow-dark); 
    transition: all 0.15s ease;
    
    display: flex;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
    text-transform: uppercase; /* áŠá‹°áˆ‰áŠ• áŠ¨á á‹«á‹°áˆ­áŒ‹áˆ */
}

.invite-button:active {
    box-shadow: 0 2px 0 var(--et-yellow-dark);
    transform: translateY(5px); /* áˆ²áŒ«áŠ• á‹¨áŒ¥áˆ‹á‹ áˆ˜áŒ áŠ• á‹«áˆ…áˆ á‹­áŒˆá‰£áˆ */
}

/* --- COPY BUTTON (SQUARE, 3D EFFECT) --- */
.copy-button {
    background-color: #3A3A3A; /* áŒ¥á‰áˆ­ áŒáˆ«áŒ« á‹³áˆ« */
    border: none; 
    width: 55px; /* áŠ¨á‹‹áŠ“á‹ á‰áˆá áŒ‹áˆ­ á‰áˆ˜á‰µ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ */
    height: 55px; 
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.15s ease;
    
    /* 3D/Raised Effect */
    box-shadow: 0 7px 0 #202020; /* áŠ¨áŒ¨áˆˆáˆ› á‹³áˆ« áŒ‹áˆ­ á‹¨áˆšáˆ˜áˆ³áˆ°áˆ áŒ¥áˆá‰… áŒ¥áˆ‹ */
}

.copy-button:active {
    transform: translateY(5px); 
    box-shadow: 0 2px 0 #202020;
}
        
.copy-icon {
    width: 26px; 
    height: 26px;
    color: var(--et-yellow); /* áŠ á‹­áŠ®áŠ‘áŠ• á‰¢áŒ« á‹«á‹°áˆ­áŒˆá‹‹áˆ */
    stroke-width: 2.5; /* áŠ á‹­áŠ®áŠ‘áŠ• á‹°áˆ˜á‰… á‹«á‹°áˆ­áŒˆá‹‹áˆ */
}


.mystery-text {
    flex-grow: 1;
    margin-left: 15px;
}
.mystery-status {
    background-color: var(--et-green);
    color: var(--bg-primary);
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 12px;
}
/* ... (áˆŒáˆá‰½ áŠ áˆµáˆáˆ‹áŒŠ áˆµá‰³á‹­áˆá‰½) ... */





 /* ====================================================================== */
/* === NAVIGATION BAR STYLES (áˆáŠ­ áŠ¥áŠ•á‹° áˆáˆµáˆ‰ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) === */
/* ====================================================================== */
#nav-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    
    /* á‰áˆ˜á‰µ áŠ¥áŠ“ á‹³áˆ« (Background) */
    height: 60px;
    background-color: #202c33; /* ğŸ›‘ NEW: áŠ¥áŠ•á‹° áˆáˆµáˆ‰ áŒ¥á‰áˆ­-áˆ°áˆ›á‹«á‹Š á‹³áˆ« */
    
    display: flex;
    justify-content: space-around;
    align-items: center;
    
    border-top: 1px solid #1a2227; /* á‰€áŒ­áŠ• á‹¨áˆ‹á‹­áŠ›á‹ á‹µáŠ•á‰ áˆ­ */
    box-shadow: 0 -5px 10px var(--shadow-dark); 
    z-index: 1000;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    
    /* á‹¨áˆáˆ‰áˆ áŠ•áŒ¥áˆá‰½ (Items) á‰€áˆˆáˆ áŒáˆ«áŒ« */
    color: var(--text-grey); 
    
    font-size: 11px;
    width: 25%; /* á‰ áˆáˆµáˆ‰ áˆ‹á‹­ áŠ áˆ«á‰µ áŠ•áŒ¥áˆá‰½ áŠ áˆ‰ */
    height: 100%;
    transition: color 0.3s;
}

/* ğŸ›‘ NEW: áŠ•á‰ á‹¨áˆ†áŠá‹áŠ• áŠ á‹¶ áŠ­á‰¥ áŠ¥áŠ•á‹²áŠ–áˆ¨á‹ áˆˆáˆ›á‹µáˆ¨áŒ */
.nav-icon-container {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 2px;
    transition: background-color 0.3s;
}

.nav-item.active .nav-icon-container {
    /* ğŸ›‘ NEW: áŠ•á‰ áˆ²áˆ†áŠ• áˆ°áˆ›á‹«á‹Š á‹³áˆ« (Circle Background) */
    background-color: #5d93bb; 
}

.nav-icon {
    font-size: 20px;
    /* ğŸ›‘ NEW: á‹¨áŠ á‹¶á‹á‰¹ á‰€áˆˆáˆ á‰ áŠá‰£áˆª áŠáŒ­ (text-light) á‹­áˆ†áŠ“áˆ */
    color: var(--text-light); 
  
}

.nav-item.active {
    /* áŠ•á‰ áŒ½áˆá (Active Text) áˆ°áˆ›á‹«á‹Š á‹­áˆ†áŠ“áˆ */
    color: #5d93bb; 
    text-shadow: none; /* á‰¥áˆ­áˆƒáŠ‘áŠ• áŠ áˆµá‹ˆáŒá‹°áŠ“áˆ */
}



/* ====================================================================== */
/* === âœ… ğŸ›‘ Top pages=== */
/* ====================================================================== */
/* --- Top Page (Leaderboard) --- */
        .top-user-card {
            background-color: var(--tg-secondary-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
            /* ğŸ›‘ IMPROVEMENT: á‹ˆáˆ­á‰ƒáˆ› ááˆ¬áˆ áˆˆá‹‹áŠ“á‹ áŠ«áˆ­á‹µ */
            border: 2px solid var(--et-yellow); 
        }
        .top-user-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .stat-item {
            padding: 3px;
            border-radius: 8px;
            background-color: #333;
            flex-basis: 45%;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) inset; /* ğŸ›‘ NEW: á‹¨3D áŒˆáŒ½á‰³ */
        }
        .stat-item span {
            display: block;
            font-size: 12px;
            color: var(--tg-hint);
            margin-top: 3px;
        }
        #leaderboard-list {
            background-color: var(--tg-secondary-bg);
            padding: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #2a2a2a;
            transition: background-color 0.2s; /* ğŸ›‘ NEW */
        }
        
        /* ğŸ›‘ NEW/IMPROVEMENT: áˆˆ Top 3 á‹¨áŒ€áˆ­á‰£ á‰€áˆˆáˆ áˆ›á‹µáˆ˜á‰‚á‹« */
        .leaderboard-item.gold-highlight {
            background-color: rgba(255, 215, 0, 0.15); /* á‰€áˆ‹áˆ á‹ˆáˆ­á‰ƒáˆ› */
            border-left: 4px solid #FFD700;
        }
        .leaderboard-item.silver-highlight {
            background-color: rgba(192, 192, 192, 0.15); /* á‰€áˆ‹áˆ á‰¥áˆ­áˆ› */
            border-left: 4px solid #C0C0C0;
        }
        .leaderboard-item.bronze-highlight {
            background-color: rgba(205, 127, 50, 0.15); /* á‰€áˆ‹áˆ áŠáˆáˆ³áˆ› */
            border-left: 4px solid #CD7F32;
        }

        .leaderboard-item-rank {
            font-weight: bold;
            width: 35px; /* á‰¦á‰³á‹áŠ• áˆ˜áŒ¨áˆ˜áˆ­ */
            text-align: center;
            color: var(--tg-text);
            font-size: 16px;
        }
        /* ğŸ›‘ NEW/IMPROVEMENT: áˆˆ Top 3 á‹°áˆ¨áŒƒá‹á‰½ áˆá‹© á‰€áˆˆáˆ áŠ¥áŠ“ áˆ˜áŒ áŠ• */
        .leaderboard-item-rank.gold {
            color: #FFD700; /* á‹ˆáˆ­á‰… */
            font-size: 20px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
        }
        .leaderboard-item-rank.silver {
            color: #C0C0C0; /* á‰¥áˆ­ */
            font-size: 18px;
        }
        .leaderboard-item-rank.bronze {
            color: #CD7F32; /* áŠáˆáˆµ */
            font-size: 17px;
        }

        .leaderboard-item-photo { 
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--et-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            overflow: hidden; 
            flex-shrink: 0;
            border: 2px solid #555; /* ğŸ›‘ NEW: áˆˆáá‰¶ á‰µáŠ•áˆ½ ááˆ¬áˆ */
        }
        .leaderboard-item-name {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
            /* ğŸ›‘ IMPROVEMENT: áˆ¨áŒ…áˆ áˆµáˆá‰½ áŠ¥áŠ•á‹³á‹­á‹ˆáŒ¡ áˆ˜áŠ¨áˆ‹áŠ¨áˆ */
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap;
            margin-right: 10px; 
        }
        .leaderboard-item-score {
            font-weight: bold;
            color: var(--et-green);
            white-space: nowrap;
            font-size: 15px;
            text-shadow: 0 0 3px rgba(76, 175, 80, 0.5); /* ğŸ›‘ NEW: áˆˆáŠáŒ¥á‰¥ áŒ¥áˆ‹ */
        }
        .current-user-highlight {
            background-color: rgba(76, 175, 80, 0.3); /* ğŸ›‘ IMPROVED: á‹¨áŒ á‰†áˆ¨ á‹³áˆ« */
            border-left: 4px solid var(--et-green); 
            font-weight: bold; /* ğŸ›‘ NEW: áŒáˆ‹ á‰¥áˆ áŠ¥áŠ•á‹²á‰³á‹­ */
        }




        /* --- Profile Page Styling --- */
        #profile-page {
            text-align: center;
            padding-top: 40px;
      
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            background-color: var(--et-green);
            border-radius: 50%;
            margin: 0 auto 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            font-weight: bold;
            /* ğŸ›‘ NEW: áˆˆ Profile Avatar áŒ¥áˆ‹ */
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            border: 4px solid white; 
            overflow: hidden; 
        }
        .profile-username-display {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 30px;
            color: var(--et-yellow); /* ğŸ›‘ IMPROVED: á‹ˆáˆ­á‰ƒáˆ› á‰€áˆˆáˆ */
        }
        .profile-stat-box {
            background-color: var(--tg-secondary-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* ğŸ›‘ NEW */
      
        }
        .stat-label {
            display: flex;
            align-items: center;
            font-size: 16px;
          
        }
        .stat-label .icon {
            margin-right: 10px;
            font-size: 20px;
            color: var(--et-yellow);
        }
        .balance-value {
            font-weight: bold;
            color: var(--et-green);
            text-shadow: 0 0 3px rgba(76, 175, 80, 0.5); 
        }
        .withdraw-button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .withdraw-button:hover {
            background-color: #388E3C;
        }
        .profile-action-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: left;
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* ğŸ›‘ NEW */
            transition: transform 0.2s, box-shadow 0.2s;
        }
         .profile-action-button:hover {
            transform: translateX(5px); /* ğŸ›‘ NEW: áˆ²áŠáŠ« áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .profile-action-button .icon {
            margin-right: 15px;
            font-size: 20px;
        }
        .exchange-status {
            color: var(--tg-hint);
            font-size: 14px;
            margin-right: 10px;
        }



        /* --- Game Page Styles --- */
        .game-page-container {
            padding: 20px 10px;
            text-align: center;
        }
        .game-page-container h2 {
            margin-bottom: 20px;
            color: var(--et-yellow);
            font-size: 22px;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
        }
        .game-info-box {
            background-color: var(--tg-secondary-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED */
        }
        .game-action-button {
            display: block;
            width: 80%;
            margin: 20px auto;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 6px 0 #388E3C; /* ğŸ›‘ IMPROVED */
            transition: all 0.1s ease;
        }
        .game-action-button:active {
            box-shadow: 0 2px 0 #388E3C;
            transform: translateY(4px); /* ğŸ›‘ IMPROVED */
        }
        .game-action-button.cooldown {
             background-color: #555;
             box-shadow: 0 6px 0 #333;
             cursor: not-allowed;
        }
        .game-back-button {
            display: block;
            width: 80%;
            margin: 40px auto 10px auto;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #424242;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .game-back-button:hover {
            background-color: #555555;
        }
        .cooldown-timer {
            font-size: 20px;
            font-weight: bold;
            color: var(--et-red);
            margin-top: 10px;
            text-shadow: 0 0 5px rgba(244, 67, 54, 0.5); /* ğŸ›‘ NEW */
        }
        
        
        
/* ==========================================
   --- Daily Spin Wheel FIXED Styles ---
   ========================================== */
.wheel-container {
    position: relative;
    width: 300px; /* áŠ¥áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ á‰ á‹°áŠ•á‰¥ áŠ¥áŠ•á‹²á‰³á‹­ á‰µáŠ•áˆ½ áŠ¨á á‹­á‰ áˆ */
    height: 300px;
    margin: 20px auto 40px auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

.wheel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    overflow: hidden;
    border: 8px solid #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1); /* Smooth Spin */
}

/* --- The Geometric Calculation (Skew Method) --- */
/* 10 Segments = 360 / 10 = 36 degrees each.
   Skew Angle = 90 - 36 = 54 degrees.
*/
.segment {
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 50%;
    background: var(--clr);
    transform-origin: 0% 100%; /* áˆ˜á‹áˆªá‹«á‹ áŠ¨á‰³á‰½ á‰ áŒáˆ« (áˆ›áŠ¥áŠ¨áˆ) */
    
    /* áŠ¥á‹šáˆ… áŒ‹áˆ­ áŠá‹ áŒ¨á‹‹á‰³á‹! á‰…áˆ­áŒ¹áŠ• áˆˆáˆ›áˆµá‰°áŠ«áŠ¨áˆ Skew áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
    transform: rotate(calc(36deg * var(--i))) skewY(-54deg);
}

.segment-text {
    position: absolute;
    left: -100%;
    width: 200%;
    height: 200%;
    text-align: center;
    display: block;
    
    /* Skew á‹¨á‰°á‹°áˆ¨áŒˆá‹áŠ• á‰…áˆ­áŒ½ áˆ˜áˆáˆ¶ áˆ›áˆµá‰°áŠ«áŠ¨áˆ áŠ¥áŠ“ áŒ½áˆá‰áŠ• áˆ›á‹áˆ­ */
    transform: skewY(54deg) rotate(18deg); 
    padding-top: 20px; /* áŒ½áˆá‰áŠ• áŠ¨áŒ áˆ­á‹™ á‰µáŠ•áˆ½ á‹á‰… áˆˆáˆ›á‹µáˆ¨áŒ */
    
    color: white;
    font-weight: bold;
    font-size: 13px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    line-height: 1.2;
}

/* --- Center Circle (SPIN text) --- */
.center-circle {
    position: absolute;
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 50%;
    z-index: 10;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    color: #333;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
    border: 4px solid #FFD700;
}

/* --- Pointer (Triangle) --- */
.pointer {
    position: absolute;
    top: -15px; /* áŠ¨áˆ³áŒ¥áŠ‘ á‰µáŠ•áˆ½ á‹ˆáŒ£ á‰¥áˆ */
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    
    /* á‰µáˆªá‹«áŠ•áŒáˆ‰ á‹ˆá‹° á‰³á‰½ áŠ¥áŠ•á‹²á‹«áˆ˜áˆˆáŠ­á‰µ border-top áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 30px solid #ff3e3e; 
    
    z-index: 20;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
}

           
           
/* ====================================================================== */
/* === âœ… ğŸ›‘ á‹¨ mystery game === */
/* ====================================================================== */

        /* --- Mystery Box Styles --- */
        .box-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .mystery-box {
            width: 90px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… áŠ¥áŠ•á‹²áˆ†áŠ• */
            height: 90px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… áŠ¥áŠ•á‹²áˆ†áŠ• */
            background-color: var(--et-red);
            border-radius: 12px; /* ğŸ›‘ IMPROVED: á‰µáŠ•áˆ½ áŠ­á‰¥ á‰…áˆ­áŒ½ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… á‰…áˆ­áŒ¸-á‰áˆáŠ */
            cursor: pointer;
            transition: transform 0.2s, background-color 0.5s;
            box-shadow: 0 8px 0 #A83232; /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
        }
        .mystery-box:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #A83232;
        }
        .mystery-box.opened {
            background-color: var(--et-green);
            box-shadow: 0 8px 0 #388E3C;
        }
        .mystery-box.missed {
            background-color: #666; /* ğŸ›‘ IMPROVED: á‹¨áŒ á‰†áˆ¨ áŒáˆ«áŒ« */
        }
        
        /* --- Reflex Game Styles --- */
        #reflex-play-area {
            height: 200px;
            background-color: var(--tg-secondary-bg);
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: var(--tg-hint);
            cursor: pointer; 
            border: 2px dashed var(--et-yellow); /* ğŸ›‘ NEW: áˆˆáŒ¨á‹‹á‰³á‹ á‰¦á‰³ áŒ áˆ­á‹ */
        }
        #reflex-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--et-red);
            color: white;
            font-size: 24px;
            font-weight: bold;
            display: none; 
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 7px 0 #882222;
            transition: transform 0.1s;
        }
        #reflex-button:active {
            transform: translateY(3px);
            box-shadow: 0 4px 0 #882222;
        }
        
        
        
        
       /* ============================================== */
        /* âœ… ğŸ›‘ áŠ á‹²áˆµ: Scratch Card Game Styles */
        /* ============================================== */
        
        /* á‹­áˆ… áˆ˜á‹«á‹£ (container) áˆ½áˆáˆ›á‰±áŠ• áŠ¥áŠ“ áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áŠ¥áŠ•á‹²á‹°áˆ«áˆ¨á‰¡ á‹«á‹°áˆ­áŒ‹áˆ */
        #scratch-card-container {
            position: relative;
            width: 280px; /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹ áˆµá‹á‰µ */
            height: 150px; /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹ á‰áˆ˜á‰µ */
            margin: 20px auto 0 auto;
            border-radius: 10px;
            overflow: hidden; /* áŠ¨áŠ­á‰¥ áŒ áˆ­á‹™ á‹áŒª áŠ¥áŠ•á‹³á‹­á‰³á‹­ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            background-color: var(--tg-secondary-bg); /* áŠ¨áˆµáˆ­ á‹«áˆˆá‹ á‹³áˆ« */
        }

        /* 1. áŠ¨á‰³á‰½ á‹«áˆˆá‹ á‹¨áˆ½áˆáˆ›á‰µ áŒ½áˆá */
        .scratch-prize-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            
            /* áˆˆáˆ½áˆáˆ›á‰± á‹¨áˆšá‹«áˆáˆ­ áŒ½áˆá */
            font-size: 32px;
            font-weight: 900;
            color: var(--et-green);
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
            
            /* á‰°áŒ á‰ƒáˆšá‹ áŒ½áˆá‰áŠ• áŠ¥áŠ•á‹³á‹­áˆ˜áˆ­áŒ á‹ (select) áˆ›á‹µáˆ¨áŒ */
            user-select: none; 
            -webkit-user-select: none;
        }
        
        /* 2. áŠ¨áˆ‹á‹­ á‹«áˆˆá‹ áˆ˜áˆá‰…áˆá‰‚á‹« (Canvas) */
        .scratch-top-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2; /* áŠ¨áˆ½áˆáˆ›á‰± áŒ½áˆá á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• */
            
            /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹« áŠ á‹­áŒ¥ áˆáˆáŠ­á‰µ (cursor) */
            cursor: grab; 
        }

        .scratch-top-layer:active {
            cursor: grabbing;
        }




 
        /* ============================================== */
        /* âœ… Slot Game CSS */
        /* ============================================== */
        .game-page-container {
            padding: 15px;
            text-align: center;
        }

        .daily-game-card {
            background-color: var(--tg-secondary-bg);
            border-radius: 12px;
            padding: 20px 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin: 20px 0;
        }

        .daily-game-card .header {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 15px;
        }

        .daily-game-card .header .back-button {
            position: absolute;
            left: 0;
            font-size: 24px;
            color: var(--tg-hint);
            cursor: pointer;
            padding: 5px;
        }

        .daily-game-card .header .main-title {
            font-size: 22px;
            font-weight: bold;
            color: var(--et-yellow);
        }

        .daily-game-card .header .sub-title {
            font-size: 14px;
            color: var(--tg-hint);
            text-align: center;
            margin-top: 5px;
        }

        .info-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
        }

        .info-item {
            font-size: 14px;
            color: var(--tg-text);
            font-weight: 500;
        }

        .info-item span {
            font-weight: bold;
            color: var(--et-yellow);
            display: block;
            font-size: 18px;
        }

        .slots-area {
            display: flex;
            justify-content: space-around;
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 3px solid #3d3d3d;
        }

        .slot {
            width: 30%;
            height: 80px;
            background-color: #000000;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.2);
            overflow: hidden; 
        }

        .daily-game-card .btn {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            color: white;
            text-transform: uppercase;
        }

        #spin-btn {
            background-color: var(--et-red);
            box-shadow: 0 4px #911a1a; /* Darker red for shadow */
        }

        #claim-btn {
            background-color: #6d6d6d;
            box-shadow: 0 4px #575757;
        }

        #claim-btn:not([disabled]) {
            background-color: var(--et-green);
            box-shadow: 0 4px #006000; /* Darker green for shadow */
        }
        
        
        
        /* ============================================== */
/* âœ… ADDED: SLOTS SPINNING ANIMATION */
/* ============================================== */

/* 1. á‹¨áˆ½áŠ­áˆ­áŠ­áˆ©áŠ• áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´ á‹¨áˆšá‹ˆáˆµáŠ• á‰áˆá ááˆ¬áˆ */
@keyframes slot-spin {
    /* 1200px á‰áˆ˜á‰± á‹«áˆˆá‹ á‹¨á‹áŒ¤á‰¶á‰½ áˆ°áŠ•áˆ°áˆˆá‰µ (Strip) áŠ áˆˆ á‰¥áˆˆáŠ• áŠ¥áŠ•áŒˆáˆá‰³áˆˆáŠ• */
    to {
        transform: translateY(-1200px); /* áŠ¨áˆ‹á‹­ á‹ˆá‹° á‰³á‰½ á‰ ááŒ¥áŠá‰µ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ«áˆ */
    }
}

/* 2. áˆ½áŠ­áˆ­áŠ­áˆ©áŠ• áˆˆáˆšáŒ€áˆáˆ­ áˆ›áŠ•áŠ›á‹áˆ Slot Reel */
.slot-reel.spinning {
    /* á‹¨áŠ áŠ’áˆœáˆ½áŠ‘ ááŒ¥áŠá‰µ áŠ¥áŠ“ áŠ á‹­áŠá‰µ */
    animation: slot-spin 0.1s steps(10) infinite; 
    /* ğŸ›‘ steps(10) áˆ›áˆˆá‰µ 10 á‹¨á‰°áˆˆá‹«á‹© áˆáˆµáˆá‰½ á‹«áˆ‰á‰µ Strip áŠ áˆˆ á‰¥áˆˆáŠ• áŒˆáˆá‰°áŠ“áˆ */
}

/* 3. áˆ½áŠ­áˆ­áŠ­áˆ© áˆ²á‰†áˆ á‹ˆá‹° á‰µáŠ­áŠ­áˆˆáŠ›á‹ á‰¦á‰³ áŠ¥áŠ•á‹²á‹«áˆ­á */
/* áˆ½áŠ­áˆ­áŠ­áˆ© áˆ²á‹«áˆá‰… á‹ˆá‹° á‰¦á‰³á‹ áŠ¥áŠ•á‹²áŠ•áˆ¸áˆ«á‰°á‰µ */
.slot-reel {
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); /* áˆ½áŠ­áˆ­áŠ­áˆ© áŠ¥áŠ•á‹²á‹«áˆáˆ­ á‹«á‹°áˆ­áŒˆá‹‹áˆ */
}


        .timer-container {
            background-color: #333333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 14px;
            color: var(--tg-text);
        }
        
        
        
        
        /* ====================================================================== */
/* === âœ… ğŸ›‘ áŠ á‹²áˆµ: KENO GAME STYLES (Prefixed) === */
/* ====================================================================== */

/* á‹¨ Keno áŒ¨á‹‹á‰³ á‰€áˆˆáˆá‰½ */
#keno-game-page {
    --keno-primary: #f7a01d; 
    --keno-win: #17e05e; 
    --keno-bet-btn: #ffc107; 
    --keno-dark-bg: #1e1e1e;
    --keno-grid-bg: #440000; 
    --keno-text: #ffffff;
    --keno-selected: #ffc107; 
    --keno-drawn: #ffc107; 
    --keno-random-btn: #007bff; 
    --keno-history-bg: #2c2c2c;
    --keno-tab-active: var(--keno-primary);
    --keno-tab-inactive: #777;
    --keno-loss: #f44336; 
}

/* á‹¨ Keno áŒ¨á‹‹á‰³ á‹‹áŠ“ áŒˆáŒ½á‰³ */
#keno-game-page {
    background-color: var(--keno-dark-bg);
    color: var(--keno-text);
    text-align: center;
    user-select: none;
    padding: 10px 5px !important; /* áŠ¨ game-page-container áŒ‹áˆ­ áŠ¥áŠ•á‹³á‹­áŒ‹áŒ­ */
}

#keno-game-page #keno-game-container {
    width: 100%;
    max-width: 800px; 
    padding: 10px 0;
}

/* ------------------- KENO TAB STYLES ------------------- */
#keno-game-page #keno-tab-navigation {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-top: 15px;
    border-top: 2px solid #333;
    border-bottom: 2px solid #333;
    background-color: #2c2c2c;
}
#keno-game-page .keno-tab-button {
    flex-grow: 1;
    padding: 15px 0;
    font-size: 1em;
    font-weight: bold;
    color: var(--keno-tab-inactive);
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s;
    border-bottom: 3px solid transparent;
}
#keno-game-page .keno-tab-button.active {
    color: var(--keno-tab-active);
    border-bottom: 3px solid var(--keno-tab-active);
}

#keno-game-page .keno-tab-content {
    display: none;
    padding-top: 20px;
    min-height: 200px; 
    width: 100%;
    text-align: left;
}
#keno-game-page .keno-tab-content.active {
    display: block;
}

/* ------------------- KENO HEADER & GRID ------------------- */
#keno-game-page #keno-message {
    min-height: 20px;
    font-size: 1.1em;
    font-weight: bold;
    color: var(--keno-primary);
    margin-bottom: 10px;
    text-align: center;
}

#keno-game-page #keno-header-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 10px;
    background-color: #333;
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
}
#keno-game-page #keno-header-status span:last-child {
    color: var(--et-yellow); /* áŠ¨á‹‹áŠ“á‹ áŒˆáŒ½ áŒ‹áˆ­ áˆˆáˆ›áˆ˜áˆ³áˆ°áˆ */
}


#keno-game-page #keno-main-game-area {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 15px;
    width: 96%;
}

#keno-game-page #keno-grid {
    flex-shrink: 0;
    display: grid;
    grid-template-columns: repeat(10, 1fr); 
    gap: 2px;
    padding: 5px;
    background-color: var(--keno-grid-bg);
    border-radius: 10px;
    width: 100%; 
    transition: width 0.3s ease; 
}

#keno-game-page #keno-draw-shaker-area {
    flex-grow: 1;
    width: 35%; 
    display: none; /* á‰  JS á‹­á‰³á‹«áˆ */
    flex-direction: column;
    align-items: center;
    background-color: #2c2c2c;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
}
#keno-game-page #keno-current-ball-area {
    width: 60px; 
    height: 60px; 
    font-size: 1.5em; 
    margin: 10px 0; 
    border-radius: 50%; 
    background-color: var(--keno-drawn); 
    color: var(--keno-dark-bg); 
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-weight: bold;
}


#keno-game-page .number-cell {
    padding: 5px 0;
    background-color: var(--keno-grid-bg); 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); 
    transition: all 0.2s;
    font-size: 0.8em;
    cursor: pointer;
    color: var(--keno-text);
    text-align: center;
    border-radius: 4px; /* á‰µáŠ•áˆ½ á‹µáŠ•á‰ áˆ­ */
}

#keno-game-page .number-cell.selected {
    background-color: var(--keno-selected);
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: 2px solid var(--keno-text);
    transform: scale(1.05);
}

@keyframes keno-pulse-win {
    from {
        box-shadow: 0 0 10px var(--keno-win), 0 0 0px var(--keno-win);
        transform: scale(1.05);
    }
    to {
        box-shadow: 0 0 25px var(--keno-win), 0 0 15px var(--keno-primary);
        transform: scale(1.10);
    }
}

#keno-game-page .number-cell.match {
    background-color: var(--keno-win) !important;
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: 3px solid var(--keno-primary) !important; 
    animation: keno-pulse-win 0.5s infinite alternate; 
}
#keno-game-page .number-cell.drawn-cell {
     /* áŠ¥áŒ£ á‹¨á‹ˆáŒ£á‰ á‰µáŠ• áˆˆáˆ›áˆ³á‹¨á‰µ (á‹«áˆá‰°áˆ˜áˆ¨áŒ  á‰¢áˆ†áŠ•áˆ) */
    background-color: #555;
}

#keno-game-page .number-cell.disabled {
    cursor: not-allowed; 
    opacity: 0.6;        
}

/* ------------------- KENO BET CONTROLS ------------------- */
#keno-game-page #keno-bet-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-top: 15px;
}

#keno-game-page #keno-bet-input-group {
    display: flex;
    align-items: center;
    background-color: #333; 
    border-radius: 4px;
    overflow: hidden; 
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5); 
    margin-right: 10px;
}

#keno-game-page .keno-bet-modifier {
    padding: 10px 15px;
    font-size: 1.5em;
    background-color: var(--keno-primary); 
    color: var(--keno-dark-bg); 
    font-weight: bold; 
    border: none; 
    cursor: pointer;
}

#keno-game-page #keno-bet-amount-input {
    padding: 8px 5px;
    width: 100%; 
    background-color: #333; 
    border: none;
    color: var(--keno-text);
    text-align: center;
    font-size: 1.2em; 
    font-weight: bold; 
    max-width: 100px;
    min-width: 60px;
    /* Webkit-specific (hides arrows) */
    -webkit-appearance: textfield;
     -moz-appearance: textfield;
          appearance: textfield;
}
#keno-game-page #keno-bet-amount-input::-webkit-inner-spin-button,
#keno-game-page #keno-bet-amount-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}


#keno-game-page #keno-bet-button-group {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-shrink: 0; 
}

#keno-game-page #keno-bet-btn {
    padding: 15px 50px;
    background-color: var(--keno-bet-btn);
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 0 #b8860b; 
    cursor: pointer;
    transition: all 0.1s ease;
}
#keno-game-page #keno-bet-btn:disabled {
    background-color: #555;
    box-shadow: 0 4px 0 #333;
    cursor: not-allowed;
}
#keno-game-page #keno-bet-btn:active:not(:disabled) {
    transform: translateY(4px);
    box-shadow: 0 0 0 #b8860b;
}


#keno-game-page #keno-random-pick-btn {
    width: 100%;
    padding: 12px;
    background-color: var(--keno-random-btn);
    color: var(--keno-text);
    font-weight: bold;
    border: none;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 3px 0 #0056b3; 
    cursor: pointer;
}

/* ------------------- KENO HISTORY/RESULTS ------------------- */
#keno-game-page #keno-history-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}
#keno-game-page .keno-history-card {
    background-color: #2c2c2c;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border-left: 5px solid #555;
    overflow: hidden;
}
#keno-game-page .keno-history-card.win {
    border-left-color: var(--keno-win);
}
#keno-game-page .keno-history-card.loss {
    border-left-color: var(--keno-loss);
}
#keno-game-page .keno-history-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background-color: #3a3a3a;
}
#keno-game-page .keno-history-card .game-id {
    font-weight: bold;
    font-size: 1.1em;
}
#keno-game-page .keno-history-card .game-date {
    font-size: 0.8em;
    color: #ccc;
}
#keno-game-page .keno-history-card .game-result {
    font-weight: bold;
    font-size: 1.1em;
    padding: 4px 10px;
    border-radius: 5px;
}
#keno-game-page .keno-history-card .game-result.win {
    background-color: var(--keno-win);
    color: var(--keno-dark-bg);
}
#keno-game-page .keno-history-card .game-result.loss {
    background-color: var(--keno-loss);
    color: var(--keno-text);
}
#keno-game-page .keno-history-card .card-body {
    padding: 15px;
    text-align: left;
}
#keno-game-page .keno-history-card .card-body p {
    margin: 5px 0 10px;
}
#keno-game-page .keno-history-card .card-body .pick-list {
    color: var(--keno-primary);
    font-weight: bold;
}
#keno-game-page .keno-history-card .card-body details {
    margin-top: 10px;
    color: #aaa;
}
#keno-game-page .keno-history-card .card-body summary {
    cursor: pointer;
    font-weight: bold;
}
#keno-game-page .keno-history-card .card-body .drawn-list {
    padding-top: 8px;
    color: #ccc;
    font-size: 0.9em;
    word-wrap: break-word;
    line-height: 1.5;
}

#keno-game-page #keno-paytable-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
}
#keno-game-page .keno-paytable-card {
    background-color: #2c2c2c;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
}
#keno-game-page .keno-paytable-header {
    background-color: var(--keno-primary);
    color: var(--keno-dark-bg);
    padding: 12px;
    font-size: 1.3em;
    font-weight: bold;
    text-align: center;
}

#keno-game-page .keno-paytable-card table {
    width: 100%;
    border-collapse: collapse;
    text-align: left;
}
#keno-game-page .keno-paytable-card th, 
#keno-game-page .keno-paytable-card td {
    padding: 12px 15px;
    border-bottom: 1px solid #444;
}
#keno-game-page .keno-paytable-card th {
    background-color: #3a3a3a;
    font-size: 1em;
    color: #ccc;
}
#keno-game-page .keno-paytable-card td {
    font-size: 1.1em;
}
#keno-game-page .keno-paytable-card td:last-child {
    font-weight: bold;
    color: var(--keno-win);
    text-align: right;
    font-size: 1.2em;
}
#keno-game-page .keno-paytable-card tr:last-child td {
    border-bottom: none;
}
/* ====================================================================== */
/* === âœ… ğŸ›‘ á‹¨ KENO GAME STYLES áˆ˜áŒ¨áˆ¨áˆ» === */
/* ====================================================================== */


/* ====================================================================== */
/* === âœ… ğŸ›‘ profil page STYLES === */
/* ====================================================================== */


    /* --- 1. [áŠ á‹²áˆµ] á‹¨áˆ‹á‹­áŠ›á‹ áŠ­ááˆ (Header) --- */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    margin: 0;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.connect-wallet-btn {
    background-color: #007BFF; /* áˆ°áˆ›á‹«á‹Š */
    color: white;
    border: none;
    border-radius: 20px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

.connect-wallet-btn svg {
    width: 20px;
    height: 20px;
}

/* --- 2. [á‹¨á‹µáˆ®] á•áˆ®á‹á‹­áˆ (áŠ«áˆ­á‹µ áŠ¥áŠ•á‹²áˆ˜áˆµáˆ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) --- */
.profile-avatar {
    font-size: 50px;
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 50%; /* áŠ­á‰¥ áŠ¥áŠ•á‹²áˆ†áŠ• */
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 10px auto;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.profile-username-display {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 25px;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}


/* --- 3. [áŠ á‹²áˆµ] á‹‹áŠ“á‹ á‹¨ "Total Coin" áŠ«áˆ­á‹µ --- */
.assets-card {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: left;
  box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
}

.assets-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-size: 16px;
    margin-bottom: 10px;
}

.assets-card-header .history-btn {
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
}

.history-btn svg {
    width: 16px;
    height: 16px;
    stroke: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    text-align: left;
    margin-top: 5px; 
}

.balance-display {
    font-size: 15px;
    font-weight: 700;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.balance-display .currency {
    font-size: 15px;
    font-weight: 600;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin-left: 8px;
}

/* --- 3.1. [áŠ á‹²áˆµ] á‹¨áˆ¶áˆµá‰± áŠ á‹áˆ«áˆ®á‰½ (Actions) áŠ­ááˆ --- */
.card-actions {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 25px;
  
}

.action-btn {
    flex: 1; 
    background-color: var(--btn-bg, #3E4041);
    border: none;
    border-radius: 12px;
    padding: 15px 10px;
    cursor: pointer;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-size: 14px;
    font-weight: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  box-shadow: 0 0 0 2px red, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
}

.action-btn svg {
    width: 24px;
    height: 24px;
}

.action-btn.exchange svg {
    stroke: var(--et-yellow, #FFC107);
}

.action-btn.withdraw svg,
.action-btn.airdrop svg {
    stroke: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

/* --- 4. [á‹¨á‹µáˆ®] á‹¨ Settings áŠ­ááˆ (áˆµá‰³á‹­áˆ‰ áŠ¨á‹µáˆ®á‹ áŠ®á‹µáˆ… áŒ‹áˆ­ áŠ áŠ•á‹µ áŠá‹) --- */
.profile-action-button {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 10px;
    padding: 15px;
    width: 100%;
    border: none;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin-bottom: 12px;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between; 
    box-sizing: border-box; 
}

.profile-action-button .stat-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 16px;
    font-weight: 500;
}

.profile-action-button .icon {
    font-size: 20px;
}



  exchange ccs code

                                                                    
/* --- á‹˜áˆ˜áŠ“á‹Š á‹¨áˆá‹á‹áŒ¥ áŒˆáŒ½ á‰…áŒ¦á‰½ (Scoped) --- */

/* 1. áŠ áŒ á‰ƒáˆ‹á‹­ á‹˜áˆ˜áŠ“á‹Š áŠ«áˆ­á‹µ á‰…áŒ¥ (Modern Card Style) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card, 
#exchange-page .modern-card-3d {
    background-color: var(--tg-secondary-bg);
    padding: 10px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
    text-align: center;
    border: 1px solid #444;
}

/* 2. 3D áŠ«áˆ­á‹µ (Hover effect) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card-3d {
    background-color: #2c2c2c;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 0 5px rgba(76, 175, 80, 0.1); 
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card-3d:hover {
    transform: translateY(-5px); 
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.6), 0 0 0 5px rgba(76, 175, 80, 0.3);
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .card-title {
    font-size: 14px;
    color: var(--tg-hint);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .balance-amount {
    font-size: 20px;
    font-weight: 900;
    margin: 5px   0;
    text-shadow: 0 0 5px rgba(255, 193, 7, 0.6);
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .currency-label {
    font-size: 14px;
    color: var(--tg-text);
    opacity: 0.7;
}

/* 3. Rate Display (áˆá‹á‹áŒ¥ áˆáŒ£áŠ” áŠ á‰€áˆ›áˆ˜áŒ¥) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-label {
    font-size: 14px;
    color: var(--tg-hint);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-value {
    font-size: 16px;
    font-weight: bold;
    color: var(--et-green);
}

/* 4. Quantity Control (+/- Buttons) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .quantity-control {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-input {
    width: 120px;
    padding: 10px;
    text-align: center;
    border: 2px solid #555;
    border-radius: 5px;
    background-color: var(--tg-secondary-bg);
    color: var(--tg-text);
    font-size: 20px;
    font-weight: bold;
    margin: 0 10px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.4); 
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-btn {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 20%;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
    background-color: var(--et-yellow); 
    color: #1c1c1c;
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.4);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-btn:active {
    transform: scale(0.95);
}

/* 5. Smart Coin Output */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .smart-coin-output {
    
    justify-content: space-between;
    padding: 10px 0;
    margin-top: 15px;
    font-size: 15px;
    font-weight: bold;
    border-top: 1px dashed #555;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page #smartCoinResult {
    color: var(--et-green);
    font-size: 22px;
}

/* 6. Main Exchange Button */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-exchange-btn {
    width: 80%;
    padding: 15px;
    font-size: 18px;
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 30px;
    background-color: var(--et-green);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5); 
    transition: background-color 0.3s, box-shadow 0.3s, transform 0.1s;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-exchange-btn:not(.disabled-btn):hover {
    background-color: #388E3C;
    transform: translateY(-2px);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .disabled-btn {
    background-color: #555555 !important;
    cursor: not-allowed;
    box-shadow: none !important;
}



/* =========================================================
   âœ… ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdrawal Page) á‰…áŒ¦á‰½
   ========================================================= */

/* === áŠ áŒ á‰ƒáˆ‹á‹­ á‰…áŒ¦á‰½ (General Styles) === */

/* â­ï¸ áˆ›áˆµá‰°áŠ«áŠ¨á‹« 1: á‹¨áŒˆáŒ¹áŠ• á‹³áˆ« á‰‹áˆš áˆ›á‹µáˆ¨áŒ */
#withdraw-page {
    background-color: #1b2129; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    padding: 15px; 
    box-sizing: border-box;
}

#withdraw-page .page-title {
    margin-bottom: 15px; 
    text-align: center;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

#withdraw-page hr {
    border: 0;
    height: 1px;
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin: 20px 0;
}

/* === áŠ«áˆ­á‹¶á‰½ (Cards) === */
#withdraw-page .modern-card-3d {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 14px; 
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); 
    transition: all 0.2s ease;
    margin-bottom: 15px; 
}

#withdraw-page .card-title {
    font-size: 1.1em;
    font-weight: 600;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin: 0 0 15px 0;
}

/* === á‰€áˆª áˆ’áˆ³á‰¥ áŠ«áˆ­á‹µ (Balance Card) === */
#withdraw-page .balance-input-card .balance-amount {
    font-size: 2.5em;
    font-weight: 700;
    color: var(--et-green, #4CAF50); 
    margin: 5px 0;
}

#withdraw-page .balance-input-card .currency-label {
    font-size: 0.9em;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

/* === á‹¨á‰áŒ¥áˆ­ áˆ›áˆµáŒˆá‰¢á‹« áˆ›áˆµá‰°áŠ«áŠ¨á‹« === */
#withdraw-page .quantity-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#withdraw-page .qty-btn {
    background-color: #0088cc; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border: none;
    border-radius: 15%;
    width: 44px;
    height: 44px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
    flex-shrink: 0;
}

#withdraw-page #withdrawAmountInput {
    flex-grow: 1;
    max-width: 150px;
    padding: 12px;
    font-size: 1.5em; 
    font-weight: 700; 
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    background-color: #1b2129; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border: 5px solid #333333; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 12px;
    text-align: center;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    -moz-appearance: textfield;
}

#withdraw-page #withdrawAmountInput::-webkit-outer-spin-button,
#withdraw-page #withdrawAmountInput::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* === á‹¨áˆ˜áŠ­áˆá‹« á‹˜á‹´á‹á‰½ === */
#withdraw-page .method-master-card {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 0 0 2px #2196F3, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
    margin-bottom: 15px;
}

#withdraw-page #method-selection-container {
    display: flex;
    flex-direction: column;
    gap: 10px; 
    margin-top: 15px; 
  
}

#withdraw-page .method-wrapper {
    background-color: #333333; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 10px;
    padding: 0; 
    transition: all 0.s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  
}

#withdraw-page .method-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border: 2px solid transparent; 
    cursor: pointer;
    background-color: transparent; 
    border-radius: 10px;
  
}

#withdraw-page .method-info {
    display: flex;
    align-items: center;
    gap: 15px;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-weight: 500; 
}

#withdraw-page .method-fee {
    font-size: 0.9em;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-weight: 500;
    text-align: right;
}

#withdraw-page .selection-indicator {
    display: none; 
    font-size: 24px;
    color: var(--et-green, #4CAF50);
    flex-shrink: 0;
    margin-left: 10px;
}

/* á‹¨áŠ áˆ›áˆ«áŒ­ áˆ›á‹µáˆ˜á‰… (Selection Highlight) */
#withdraw-page .method-wrapper.active {
    box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); 
}

#withdraw-page .method-wrapper.active > .method-card {
    border-color: var(--et-green, #4CAF50); 
}

#withdraw-page .method-wrapper.active .selection-indicator {
    display: block; 
}

/* === Button Card áˆ›áˆµá‰°áŠ«áŠ¨á‹« === */
#withdraw-page .action-card {
     padding: 20px;
}

#withdraw-page #withdrawMessage {
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    color: var(--et-red, #F44336); 
    margin-bottom: 15px;
    min-height: 1.2em;
}

/* === modern-exchange-btn (áŠ¨ Exchange áŒˆáŒ½ áŒ‹áˆ­ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ) === */
#withdraw-page .modern-exchange-btn {
    width: 100%;
    padding: 16px;
    font-size: 1.2em;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
}

/* Enabled State */
#withdraw-page .modern-exchange-btn:not(.disabled-btn) {
    background: linear-gradient(135deg, var(--et-green, #4CAF50), #208f3c); 
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
}

/* Disabled State */
#withdraw-page .modern-exchange-btn.disabled-btn {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    cursor: not-allowed;
    box-shadow: none;
}


/* 1. .method-info áŠ• áˆ›áˆµá‰°áŠ«áŠ¨áˆ (áŠ á‹¶ áŠ¥áŠ“ áˆµáˆ á‰¥á‰» áŠ¥áŠ•á‹²á‹­á‹) */
#withdraw-page .method-info {
    display: flex;
    align-items: center;
    gap: 15px; /* áŠ á‹¶á‹áŠ• áŠ¥áŠ“ áˆµáˆ™áŠ• á‹­áˆˆá‹«áˆ */
    /* ... á‰€áˆª á‰…áŒ¦á‰½ ... */
}

/* 2. â­ï¸ áŠ á‹²áˆµ á‰…áŒ¥: áŠ­áá‹«á‹áŠ• áŠ¥áŠ“ á‹¨áˆ˜áˆáˆ¨áŒ« áˆáˆáŠ­á‰±áŠ• á‰ áŠ áŠ•á‹µ áˆ‹á‹­ á‹ˆá‹° á‰€áŠ á‹«áˆ°áˆá‹áˆ */
#withdraw-page .right-aligned-fee {
    display: flex;
    align-items: center; 
    gap: 10px; /* á‰  Fee áŠ¥áŠ“ á‰ áˆ˜áˆáˆ¨áŒ« áˆáˆáŠ­á‰± áˆ˜áŠ«áŠ¨áˆ á‹«áˆˆ áŠ­áá‰°á‰µ */
    flex-shrink: 0; /* áŠ¥áŠ•á‹³á‹­áŒ á‰¥ áŠ¥áŠ•á‹²á‹«á‹°áˆ­áŒ */
}

/* 3. .method-fee: áŠ áˆáŠ• á‰  method-card á‹áˆµáŒ¥ áˆµáˆˆáˆ†áŠá£ á‹¨ááˆŒáŠ­áˆµ áŠ áˆ°áˆ‹áˆˆááŠ• á‹­áŠ¨á‰°áˆ‹áˆ */
/* â­ï¸ á‹­áˆ… á‰…áŒ¥ Fee áŒ½áˆ‘á‰áŠ• áŠ¨ method-name áŒ‹áˆ­ á‰ á‰µá‹­á‹© áŠ¥áŠ•á‹²áˆ†áŠ• á‹­áˆ¨á‹³áˆ */
#withdraw-page .method-fee {
    /* á‹¨áŠ áˆáŠ‘áŠ• á‰…áŒ¥ á‹­á‰€áŒ¥áˆ‹áˆ */
    font-size: 0.9em;
    color: var(--tg-hint); /* âœ… á‹­áˆ… áŠ¨áˆ‹á‹­ áŠ«áˆˆá‹ --tg-hint áˆµáˆˆáˆšá‹ˆáˆ­áˆµ á‰½áŒáˆ­ á‹¨áˆˆá‹áˆ */
    font-weight: 500;
    /* text-align: right; áŠ á‹«áˆµáˆáˆáŒáˆ */
}

/* 4. .method-card: áŠ áˆáŠ• á‰µáŠ­áŠ­áˆˆáŠ›á‹áŠ• justify-content á‹­áŒ á‰€áˆ›áˆ */
#withdraw-page .method-card {
    display: flex;
    justify-content: space-between; /* áŒáˆ« áŠ¥áŠ“ á‰€áŠ áŒáŠ• áˆˆáŒáŠ• á‹«á‹°áˆ­áŒ‹áˆ */
    align-items: center;
    /* ... á‰€áˆª á‰…áŒ¦á‰½ ... */
}



        /* ==============================================================
           === âœ… ğŸ›‘ áŠ á‹²áˆµ: á‰€áˆˆáˆ á‹«áˆˆ á‹¨áŒ¨á‹‹á‰³ áˆá‹²áŠ•áŒ áˆµáŠ­áˆªáŠ• (Modal Spinner) ===
           ============================================================== */
        #game-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* áŠ¨áŠáˆ-áŒáˆáŒ½ áŒ¥á‰áˆ­ á‹³áˆ« */
            background-color: rgba(0, 0, 0, 0.6); 
            display: none; /* á‰ áŠá‰£áˆª á‹­á‹°á‰ á‰… */
            justify-content: center;
            align-items: center;
            z-index: 9998; /* áŠ¨áˆáˆ‰áˆ áŠáŒˆáˆ­ á‰ áˆ‹á‹­ (áŠ¨á‹‹áŠ“á‹ áˆá‹°áˆ­ á‰ á‰³á‰½) */
            opacity: 0;
            transition: opacity 0.3s ease; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ áˆ˜áŒá‰¢á‹« */
        }

        .game-spinner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 5px solid #555; /* á‹¨áŠ­á‰¡ á‹³áˆ« (track) */
            
            /* âœ… áŠá‰£áˆ©áŠ• á‰¢áŒ« á‰°áˆˆá‹‹á‹‹áŒ­ (variable) áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
            border-top-color: var(--et-yellow); 
            
            /* âœ… áŠá‰£áˆ©áŠ• 'spin' áŠ áŠ’áˆœáˆ½áŠ• áŠ¥áŠ•áŒ‹áˆ«áˆˆáŠ• */
            animation: spin 1s linear infinite; 
        }

        /* (áŠá‰£áˆ© @keyframes spin áŠ¨áˆ‹á‹­ áˆµáˆ‹áˆˆ áˆ˜á‹µáŒˆáˆ áŠ á‹«áˆµáˆáˆáŒáˆ) */
        /* ==============================================================
           === á‹¨áŒ¨á‹‹á‰³ áˆá‹²áŠ•áŒ áˆµáŠ­áˆªáŠ• áˆ˜áŒ¨áˆ¨áˆ» ===
           ============================================================== */
</style>

<style>
    /* ... (áŠá‰£áˆ© áŠ®á‹µáˆ… áŠ¥áŠ•á‹³áˆˆ áˆ†áŠ–) ... */

    /* =========================================================
       ğŸ›‘ NEW: áŠ á‹³á‹²áˆµ á‹¨áŠ áŠ’áˆœáˆ½áŠ• áŠ á‹­áŠá‰¶á‰½ (Keyframes)
       ========================================================= */

    /* 1. áˆˆ Mystery (áˆ˜áŠ•á‰€áŒ¥á‰€áŒ¥) */
    @keyframes shake {
      0%, 100% { transform: translateX(0) rotate(0); }
      10%, 30%, 50% { transform: translateX(-3px) rotate(-2deg); }
      20%, 40%, 60% { transform: translateX(3px) rotate(2deg); }
      80% { transform: translateX(-2px) rotate(-1deg); }
      90% { transform: translateX(2px) rotate(1deg); }
    }

    /* 2. áˆˆ Reflex (áˆáŒ£áŠ• áŠ•á‹áˆ¨á‰µ/Pulse) */
    @keyframes pulse-fast {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    
    /* 3. áˆˆ Social Tasks (á‰µáŠ©áˆ¨á‰µ áˆ˜áˆ³á‰¢á‹«) */
    @keyframes tada {
      from { transform: scale3d(1, 1, 1); }
      10%, 20% { transform: scale3d(.95, .95, .95) rotate3d(0, 0, 1, -3deg); }
      30%, 50%, 70%, 90% { transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, 3deg); }
      40%, 60%, 80% { transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, -3deg); }
      to { transform: scale3d(1, 1, 1); }
    }

    /* ... (áˆŒáˆá‰¹ áŠá‰£áˆ­ @keyframes áŠ¥áŠ•á‹³áˆ‰ áˆ†áŠá‹) ... */


    /* =========================================================
       ğŸ›‘ NEW: áŠ á‹²áˆ¶á‰¹áŠ• áŠ áŠ’áˆœáˆ½áŠ–á‰½ áˆˆáŠ á‹¶á‹á‰¹ áˆ˜áˆµáŒ á‰µ
       ========================================================= */
    
    /* 1. áˆˆ Mystery Icon (áŠ á‹²áˆµ class áŠ¥áŠ•áˆáŒ¥áˆ«áˆˆáŠ•) */
    .card-icon-circle.mystery-icon {
        background-color: var(--et-red); /* áˆˆáˆáˆ³áˆŒ (á‰€á‹­) */
        /* 'shake' áŠ• áŠ¨ 'icon-float' áŒ‹áˆ­ áŠ¥áŠ“á‰€áˆ‹á‰…áˆ‹áˆˆáŠ• */
        animation: shake 2.5s infinite ease-in-out, icon-float 2s infinite alternate ease-in-out;
    }

    /* 2. áˆˆ Reflex Icon (áŠ á‹²áˆµ class áŠ¥áŠ•áˆáŒ¥áˆ«áˆˆáŠ•) */
    .card-icon-circle.reflex-icon {
        background-color: var(--et-blue); /* áˆˆáˆáˆ³áˆŒ (áˆ°áˆ›á‹«á‹Š) */
        /* 'pulse-fast' áŠ• áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• (icon-float áŠ¥á‹šáˆ… áŠ á‹«áˆµáˆáˆáŒáˆ) */
        animation: pulse-fast 1.2s infinite ease-in-out;
    }

    /* 3. áˆˆ Social Tasks (áŠá‰£áˆ©áŠ• class áŠ¥áŠ“áˆµá‰°áŠ«áŠ­áˆ‹áˆˆáŠ•) */
    .social-task-icon-container {
        /* ... (áŠá‰£áˆ­ áˆµá‰³á‹­áˆá‰¹ áŠ¥áŠ•á‹³áˆ‰ áˆ†áŠá‹) ... */
        
        /* âœ… áŠá‰£áˆ©áŠ• 'icon-float' áŠ áŠ’áˆœáˆ½áŠ• á‰ áŠ á‹²áˆ± 'tada' áŠ¥áŠ•á‰°áŠ«áˆˆáŠ• */
        animation: tada 2s infinite alternate ease-in-out;
        /* á‰µáŠ•áˆ½ áŠ¥áŠ•á‹²á‹˜áŒˆá‹­ áŠ¨áˆáˆˆáŒáŠ• */
        /* animation-delay: 1s; */
    }

    /* áˆ›áˆ³áˆ°á‰¢á‹«: .daily-spin-icon (spin) áŠ¥áŠ“ .luck-slot-icon (slot-glow) 
      áŠá‰£áˆ®á‰¹ áŠ áŠ’áˆœáˆ½áŠ–á‰»á‰¸á‹ áˆ‹á‹­ áˆáŠ•áˆ áˆˆá‹áŒ¥ áŠ áˆ‹á‹°áˆ¨áŒáŠ•áˆá¢
    */
 





/* ================================================= */
/* âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Staking Page CSS - áŠ•áŒ¹áˆ… áŠ á‰€áˆ›áˆ˜áŒ¥ (FINAL) */
/* ================================================= */

/* á‰‹áˆš á‰€áˆˆáˆá‰½ (Themes) */
#staking-page {
    --stake-bg-primary: #1b2129;
    --stake-bg-secondary: #181818;
    --stake-text-primary: #FFFFFF;
    --stake-text-secondary: #AAAAAA;
    --stake-yellow: #FFC107;
    --stake-green: #4CAF50;
    --stake-red: #F44336;
    --stake-blue: #2196F3;
    --stake-border: #444;
}

#staking-page {
    background-color: var(--stake-bg-primary);
    color: var(--stake-text-primary);
    padding: 0 15px; 
}

/* Header áŠ¥áŠ“ Coin Status */
#stake-header-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin-bottom: 20px;
    background-color: var(--stake-bg-secondary);
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
    border: 1px solid var(--stake-border);
}

/* 1. á‹¨á‰³á‰¦á‰½ (Tabs) áŠ á‰€áˆ›áˆ˜áŒ¥ */
#stake-tab-navigation {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 25px; 
    border-radius: 8px;
    overflow: hidden;
    background-color: var(--stake-bg-secondary);
    border: 1px solid var(--stake-border);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

#staking-page .stake-tab-button {
    flex: 1;
    padding: 12px 0;
    font-size: 15px;
    font-weight: 600;
    color: var(--stake-text-secondary);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border-right: 1px solid #333; 
}

#staking-page .stake-tab-button.active {
    color: var(--stake-text-primary);
    background-color: #333;
    border-bottom: 3px solid var(--stake-yellow);
}

/* 2. á‹¨á‰³á‰¥ á‹­á‹˜á‰µ Display Fix */
#staking-page .stake-tab-content {
    display: none; 
    padding-top: 15px; 
    min-height: 200px; 
    width: 100%;
}
#staking-page .stake-tab-content.active {
    display: block;
}

/* ğŸ›‘ 3. á‹¨á‰°áˆ»áˆ»áˆˆ: History Card Styling (áŠ¥áŠ•á‹° Rule áŒˆá…) */
#stake-history-list {
    display: flex;
    flex-direction: column;
    gap: 15px; /* á‰ áŠ«áˆ­á‹¶á‰½ áˆ˜áŠ«áŠ¨áˆ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    padding-top: 5px;
}

#staking-page .stake-history-card {
    background-color: var(--stake-bg-secondary);
    border-radius: 12px; /* á‰µáŠ•áˆ½ á‰µáˆá‰… áŠ­á‰¥ áŒ áˆ­á‹ */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
    border: 1px solid #333; /* áŒ á‰…áˆ‹áˆ‹ á‹µáŠ•á‰ áˆ­ áŒ¨áˆáˆ¯áˆ */
    
    /* á‹¨áŒáˆ« á‹µáŠ•á‰ áˆ­ á‰€áˆˆáˆ á‰  class áˆ˜áˆ°áˆ¨á‰µ á‹­áˆµá‰°áŠ«áŠ¨áˆ‹áˆ */
    border-left-width: 5px; 
    border-left-style: solid;
}

#staking-page .stake-history-card.stake {
    border-left-color: var(--stake-red);
}
#staking-page .stake-history-card.claim {
    border-left-color: var(--stake-green);
}

#staking-page .stake-history-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 18px; /* á‹¨á‹áˆµáŒ¥ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    background-color: #2c2c2c; 
    border-bottom: 1px solid #333; /* áŒáˆáŒ½ áˆ˜áˆˆá‹«á‹« */
}

#staking-page .stake-history-card .action-amount {
    font-weight: 800; /* á‹°áˆ›á‰… áŠ á‹µáˆ­áŒ“áˆ */
    font-size: 1.1em;
    padding: 4px 10px;
    border-radius: 5px;
}

#staking-page .stake-history-card .card-body {
    padding: 15px 18px; /* á‹¨á‹áˆµáŒ¥ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    text-align: left;
    color: var(--stake-text-secondary);
}


/* 4. Rules Card Styling (áŠ¨á‹šáˆ… á‰ áŠá‰µ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) */
#stake-rules-tab ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
    padding-top: 10px; 
}
#stake-rules-tab li {
    background-color: var(--stake-bg-secondary);
    border: 1px solid #333;
    padding: 18px; 
    margin-bottom: 15px; 
    border-radius: 12px;
    border-left: 5px solid var(--stake-yellow); 
    font-size: 14px;
    line-height: 1.6;
    color: var(--stake-text-primary);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* 5. "á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ" á‰áˆá áˆ›áˆµá‰°áŠ«áŠ¨á‹« */
#staking-page .game-back-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 15px;
    margin-top: 20px;
    margin-bottom: 80px; 
    background-color: #2c2c2c; 
    color: white;
    font-weight: bold;
    font-size: 15px;
    border: 1px solid #444;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.2s;
}



/* Staking Progress Bar */
.stake-progress-container {
    width: 100%;
    background-color: #333;
    border-radius: 10px;
    height: 12px;
    margin-top: 15px;
    margin-bottom: 10px;
    overflow: hidden;
    border: 1px solid #444;
}

.stake-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--et-yellow), var(--et-green));
    width: 0%;
    transition: width 1s linear;
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
}

/* Accrued Interest Text */
.accrued-text {
    font-size: 12px;
    color: var(--tg-hint);
    margin-top: 5px;
    text-align: right;
}

.accrued-value {
    color: var(--et-green);
    font-weight: bold;
}
/* Stake Plan Cards Styling */
.stake-plan-card {
    background-color: var(--tg-secondary-bg); /* áŠ¨ TG áŒ­á‰¥áŒ¥ áŒ‹áˆ­ á‹¨áˆšáˆµáˆ›áˆ› á‹³áˆ« */
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid var(--tg-hint); /* á‰€áˆ‹áˆ áŒ áˆ­á‹ */
}

/* áŠ«áˆ­á‹± áˆ²áŒ«áŠ• á‰µáŠ•áˆ½ áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ */
.stake-plan-card:not(.disabled):active {
    transform: scale(0.98);
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
}

/* á‰ á‰‚ áŒˆáŠ•á‹˜á‰¥ áŠ¨áˆŒáˆˆ áŠ«áˆ­á‹± áŠ¥áŠ•á‹²á‹°á‰¥á‹á‹ */
.stake-plan-card.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* áˆ­á‹•áˆµ áŠ¥áŠ“ á‹¨á‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• áŠ¥áŠ•á‹²áˆˆá‹«á‹© */
.plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dashed var(--tg-hint); /* á‰ áŠáŒ áˆ‹ áˆ°áˆ¨á‹ á‹¨á‰°áŠ¨á‹áˆáˆˆ áˆ˜áˆµáˆ˜áˆ­ */
}

.plan-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--tg-text);
}

/* á‹¨á‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
.plan-rate {
    font-size: 18px;
    font-weight: 800;
    color: var(--stake-yellow, #FFD700); /* áˆˆá‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• á‹ˆáˆ­á‰ƒáˆ› á‰¢áŒ« */
}

.plan-details {
    font-size: 13px;
    line-height: 1.8;
    color: var(--tg-hint); /* á‰€áˆ‹áˆ á‰€áˆˆáˆ */
}

/* á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ˜áŒ áŠ–á‰½ áŒáˆá‰°á‹ áŠ¥áŠ•á‹²á‹ˆáŒ¡ */
.plan-details span {
    color: var(--tg-text); 
    font-weight: 600;
}




/* --- Daily Cipher Styles --- */
.cipher-display-area {
    margin: 30px auto;
    text-align: center;
}

#cipher-input {
    background-color: #333;
    border: 2px solid var(--et-purple);
    color: white;
    font-size: 24px;
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    width: 80%;
    letter-spacing: 5px;
    text-transform: uppercase;
    outline: none;
    box-shadow: 0 0 15px rgba(156, 39, 176, 0.4);
}

#cipher-input:focus {
    border-color: var(--et-yellow);
    box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
}

/* --- Memory Match Styles --- */
#memory-game-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 áŠ«áˆ­á‹¶á‰½ á‰ áŠ áŒá‹µáˆ */
    gap: 10px;
    max-width: 350px;
    margin: 0 auto;
    perspective: 1000px; /* áˆˆ 3D áˆ˜áŒˆáˆá‰ áŒ¥ */
}

.memory-card {
    background-color: #2c2c2c;
    border: 2px solid var(--et-yellow);
    border-radius: 8px;
    height: 80px;
    position: relative;
    cursor: pointer;
    transform: scale(1);
    transform-style: preserve-3d;
    transition: transform 0.5s;
}

.memory-card:active {
    transform: scale(0.95);
}

/* áŠ«áˆ­á‹± áˆ²áŒˆáˆˆá‰ áŒ¥ */
.memory-card.flip {
    transform: rotateY(180deg);
}

/* á‹¨áŠ«áˆ­á‹± áŠá‰µáŠ“ áŠ‹áˆ‹ */
.front-face, .back-face {
    width: 100%;
    height: 100%;
    position: absolute;
    border-radius: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    backface-visibility: hidden; /* áŒ€áˆ­á‰£á‹áŠ• áˆ˜á‹°á‰ á‰… */
}

.front-face {
    background-color: #fff;
    color: #000;
    transform: rotateY(180deg); /* áŠá‰± á‰°áŒˆáˆá‰¥áŒ¦ áŠ¥áŠ•á‹²á‰€áˆ˜áŒ¥ */
}

.back-face {
    background-color: var(--et-yellow); /* á‹¨áŠ«áˆ­á‹± áŒ€áˆ­á‰£ */
    color: #000;
    font-size: 24px;
    font-weight: bold;
}

.memory-card.matched .front-face {
    background-color: var(--et-green); /* áŠ¨á‰°áŒˆáŠ˜ áŠ áˆ¨áŠ•áŒ“á‹´ á‹­áˆáŠ• */
}

 
    /* áŠ¢áˆáŒ‚á‹ á‰¥á‰»á‹áŠ• áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ á‹­áˆ… áŒá‹´á‰³ áŠá‹ */
    .emoji-animate {
        display: inline-block; /* á‹­áˆ… áŠ¨áˆŒáˆˆ áŠ¢áˆáŒ‚á‹ áŠ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ­áˆ */
        font-size: 24px; /* á‹¨áŠ¢áˆáŒ‚ áˆ˜áŒ áŠ• */
    }

    /* 1. Daily Spin (á‹¨áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŒáˆ› - Momentum) */
    @keyframes spin-momentum {
        0% { transform: rotate(0deg); }
        60% { transform: rotate(340deg); }
        80% { transform: rotate(355deg); }
        100% { transform: rotate(360deg); }
    }
    .anim-spin {
        animation: spin-momentum 2.5s infinite cubic-bezier(0.1, 0.7, 1.0, 0.1);
    }

    /* 2. Lucky Slot (á‹ˆá‹° áˆ‹á‹­ áŠ¥áŠ“ á‰³á‰½ - Vertical Scroll) */
    @keyframes slot-scroll {
        0% { transform: translateY(0); }
        25% { transform: translateY(-8px); }
        50% { transform: translateY(0); }
        75% { transform: translateY(5px); }
        100% { transform: translateY(0); }
    }
    .anim-slot {
        animation: slot-scroll 1.2s infinite ease-in-out;
    }

    /* 3. Mystery Box (á‹¨áˆšáŠ•á‰€áŒ á‰€áŒ¥ - Shake) */
    @keyframes shake-icon {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-15deg); }
        75% { transform: rotate(15deg); }
    }
    .anim-shake {
        animation: shake-icon 1.5s infinite ease-in-out;
    }

    /* 4. Daily Cipher (á‹¨áˆšá‹«á‰ áˆ« - Glow/Pulse) */
    @keyframes glow-icon {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
    }
    .anim-glow {
        animation: glow-icon 2s infinite alternate;
    }

    /* 5. Memory Match (á‹¨áˆšáŒˆáˆˆá‰ áŒ¥ - Flip) */
    @keyframes flip-icon {
        0% { transform: rotateY(0); }
        50% { transform: rotateY(180deg); }
        100% { transform: rotateY(360deg); }
    }
    .anim-flip {
        animation: flip-icon 3s infinite ease-in-out;
    }

    /* 6. Reflex Game (á‹¨áˆá‰¥ áˆá‰µ - Heartbeat) */
    @keyframes pulse-heart {
        0% { transform: scale(1); }
        15% { transform: scale(1.3); }
        30% { transform: scale(1); }
        45% { transform: scale(1.15); }
        60% { transform: scale(1); }
    }
    .anim-pulse {
        animation: pulse-heart 1.5s infinite ease-in-out;
    }

    /* 7. Social Tasks (áˆ˜áŠ•áˆ³áˆá - Bounce) */
    @keyframes bounce-icon {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
    }
    .anim-bounce {
        animation: bounce-icon 2s infinite ease-in-out;
    }

   


</style>
<body>
    <div id="loading-container">
            <img id="coin-image" class="coin-spinner" src="smart_airdrop_coin.png" alt="Coin Loading" />
            <p id="loading-text">SMART AIRDROP Loading...</p>
    </div>

    <div id="game-loading-overlay">
        <div class="game-spinner"></div>
    </div>

    
            <div id="daily-reward-modal">
    <div class="reward-content">
        <button class="close-button" onclick="closeDailyRewardModal()">âœ•</button>
        <h2>Daily Reward</h2>
        <p>Get a daily bonus by logging into the game every day without skipping</p>
        
        <div class="reward-grid" id="reward-grid"></div>

        <button id="daily-reward-claim-button" disabled>Loading...</button>
        
        </div>
</div>

    

    <div id="root">
        <div id="tasks-page" class="page" style="display: none; padding: 15px 0;">
            <h1 class="page-title">á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ</h1>

            <div class="score-card-display">
                áŒ á‰…áˆ‹áˆ‹ coin : <span id="tasks-score-display" style="color: var(--et-yellow);">0 ğŸ’°</span>
            </div>

      <div class="invite-card-container">
    <div class="invite-card">
        <div class="header-section">
            <div class="icon-circle">$</div>
            <div class="text-content">
                <p class="title">+500 Coin áˆµáŒ¦á‰³</p>
                <p class="subtitle"></p>
            </div>
        </div>
        <div class="button-row">
            <a href="#" class="invite-button primary-button" id="telegramInviteLink" onclick="window.handleInviteClick(null, 500, 'last_invite_time')">
    áŒ“á‹°áŠ› áŒ‹á‰¥á‹
</a>

           <button class="copy-button" title="á‰…á‹³" onclick="handleCopyInviteLink()">
    <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>
    </button>
     
          
          </div>
    </div>
</div>
  </button>
            <div class="daily-tasks-container">
                <button class="task-button" style="background-color: var(--et-yellow);" onclick="window.showGameWithLoading('scratch-card-page');">
                    SCRATCH ğŸ<span>áŠ¥áˆˆá‰³á‹Š coin </span>
                </button>
                <button class="task-button" style="background-color: var(--et-purple);" onclick="window.showStreakWithLoading();">              
                    STREAK ğŸ”¥<span>á‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ</span>
                </button>
        <button class="task-button" style="background-color: var(--et-green);" onclick="window.showGameWithLoading('keno-game-page');">
    KENO GAME ğŸ²<span>Play & Win</span>
</button>

<button class="card-button" id="daily-cipher-card" onclick="window.showGameWithLoading('daily-cipher-page')">
    <div class="card-icon-circle" style="background-color: #9C27B0;">
        <span class="emoji-animate anim-glow">ğŸ•µï¸</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Daily Cipher</div>
        <div class="card-subtitle">á‹¨á‹•áˆˆá‰±áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áŠ®á‹µ á‹­áá‰± (+50,000 Coin)</div>
    </div>
    <div id="daily-cipher-badge" class="status-badge">...</div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="memory-game-card" onclick="window.showGameWithLoading('memory-game-page')">
    <div class="card-icon-circle" style="background-color: #FF9800;">
        <span class="emoji-animate anim-flip">ğŸƒ</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Memory Match</div>
        <div class="card-subtitle">áŒ¥áŠ•á‹µ áŠ«áˆ­á‹¶á‰½áŠ• á‰ áˆ›áŒˆáŠ“áŠ˜á‰µ áŠ áŠ¥áˆáˆ®á‹áŠ• á‹­áˆá‰µáŠ‘!</div>
    </div>
    <div id="memory-game-badge" class="status-badge">...</div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="mystery-box-card" onclick="window.showGameWithLoading('mystery-box-page')">
    <div class="card-icon-circle" style="background-color: var(--et-red);">
        <span class="emoji-animate anim-shake">ğŸ</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Mystery Box Game</div>
        <div class="card-subtitle">áˆšáˆµáŒ¥áˆ«á‹Š áˆ£áŒ¥áŠ• áŠ­áˆá‰µ áŠ¥áŠ“ á‹¨á‹˜áˆá‰€á‹° coin áŠ áŒáŠá¢</div>
    </div>
    <div id="mystery-box-badge" class="status-badge">...</div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="daily-spin-card" onclick="window.showGameWithLoading('daily-spin-page')">
    <div class="card-icon-circle" style="background-color: var(--et-blue);">
        <span class="emoji-animate anim-spin">ğŸ¡</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Daily Spin</div>
        <div class="card-subtitle">á‹•áˆˆá‰³á‹Š áˆ½áŠ­áˆ­áŠ­áˆ­ (Spin) á‹«áˆ½áŠ¨áˆ­áŠ­áˆ©áŠ“ coin á‹«áˆ¸áŠ•á‰á¢</div>
    </div>
    <div id="daily-spin-badge" class="status-badge">...</div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="reflex-game-card" onclick="window.showGameWithLoading('reflex-game-page')">
    <div class="card-icon-circle" style="background-color: var(--et-green);">
        <span class="emoji-animate anim-pulse">âš¡</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Reflex Game</div>
        <div class="card-subtitle">á‰ ááŒ¥áŠá‰µ áˆáˆ‹áˆ½ áˆ°áŒ¥á‰°á‹ coin á‹«áŒáŠ™á¢</div>
    </div>
    <div id="reflex-game-badge" class="status-badge">...</div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="social-tasks-card" onclick="handleCardClick('social-tasks-page')">
    <div class="card-icon-circle" style="background-color: var(--et-purple);">
        <span class="emoji-animate anim-bounce">ğŸŒ</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Social Tasks</div>
        <div class="card-subtitle">áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µáŠ• á‹«áŒ áŠ“á‰…á‰ áŠ¥áŠ“ á‰µáˆá‰… coin á‹­á‹áˆ°á‹±!</div>
    </div>
    <div class="arrow-icon">â†’</div>
</button>

<button class="card-button" id="slots-game-card" onclick="window.showGameWithLoading('slots-game-page')">
    <div class="card-icon-circle" style="background-color: var(--et-red);">
        <span class="emoji-animate anim-slot">ğŸ°</span>
    </div>
    <div class="card-text-container">
        <div class="card-title">Lucky Slot Game</div>
        <div class="card-subtitle">áŠ¥áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áŠ áˆ¸áŠ•áˆá‹ coin á‹«áŒáŠ™!</div>
    </div>
    <div class="arrow-icon">â†’</div>
</button>

                </div>
        </div>

        <div id="slots-game-page" class="game-page-container" style="display: none; text-align: center;">
            <h2 class="page-title">Lucky Slot Machine</h2>

            <div class="daily-game-card">
                <div class="header">
                    <span class="back-button" onclick="showMainPage()">â†</span>
                    <div class="main-title">á‹•á‹µáˆˆáŠ› </div>
                    <div class="sub-title">á‹•áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ</div>
                </div>

                <div class="info-bar">
                    <div class="info-item">
                         <span id="coin-wins">0</span>
                    </div>
                    <div class="info-item">
                        á‰€áˆª áˆ™áŠ¨áˆ«á‹á‰½ <span id="spins-left">10</span>
                    </div>
                </div>

                <div class="slots-area">
                    <div class="slot" id="slot-1"><div class="slot-content">?</div></div>
                    <div class="slot" id="slot-2"><div class="slot-content">?</div></div>
                    <div class="slot" id="slot-3"><div class="slot-content">?</div></div>
                </div>

                <button class="btn" id="claim-btn" disabled>Claim coin</button>

                <button class="btn" id="spin-btn">
                    áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‹­áŒ«áŠ‘ <br> SPIN
                </button>

                <div class="message" id="game-message"></div>

                <div class="timer-container" style="display: none;" id="reset-timer-container">
                     <br>
                     <span id="reset-timer"></span>
                </div>
            </div>

            <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
        </div>
        
        
        
        <div id="top-page" class="page" style="display: none; padding: 15px 0;">
            <h1 class="page-title">TOPE USERS</h1>

            <div class="top-user-card" style="border: 2px solid var(--et-yellow);">
                <div style="font-size: 18px; font-weight: bold; color: var(--tg-text);">ğŸ‘¤ á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ</div>
                <div class="top-user-stats">
                    <div class="stat-item" style="color: var(--et-yellow); background-color: #333333;">
                        <span id="top-score-display">0 ğŸ’°</span>
                        á‹¨áŠ¥áˆ­áˆµá‹ coin
                    </div>
                    <div class="stat-item" style="color: var(--et-blue); background-color: #333333;">
                        <span id="top-rank-display"> </span>
                        á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ
                    </div>
                </div>
            </div>


            <h2 style="font-size: 20px; margin-bottom: 15px; color: var(--tg-text);">ğŸ¥‡ Top Users (Top 50)</h2>

            <div id="leaderboard-container">
                <p style="text-align: center; color: var(--tg-hint); padding: 10px;">áŠ¥á‰£áŠ­á‹áŠ• á‰µáŠ•áˆ½ á‹­áŒ á‰¥á‰á¢</p>
            </div>
        </div>
        
        
        
        

<div id="profile-page" class="page">
    <div class="profile-avatar" id="profile-avatar">ğŸ‘¤</div>
    <div class="profile-username-display" id="profile-username">User Name</div>

    <div class="assets-card">
        <div class="assets-card-header">
            <span>Total Coin</span>
            <span class="history-btn" onclick="window.showTransactionHistory()">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:16px; height:16px; margin-right:4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path>
                </svg>
                History
            </span>
        </div>

        <div class="balance-display">
            <span id="profile-score-display">0</span>
            <span class="currency">COIN ğŸ’°</span>
        </div>

        <div class="balance-display" style="margin-top: 10px; border-top: 1px dashed #444; padding-top: 10px;">
            <span id="profile-smart-coin-display">0</span>
            <span class="currency" style="color: var(--et-green);">SMART âš¡ï¸</span>
        </div>

        <div class="card-actions">
            <button class="action-btn withdraw" onclick="switchPage('withdraw-page');">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15M12 15V3m0 0L9 6m3-3 3 3" />
                </svg>
                Withdraw
            </button>

            <button class="action-btn exchange" onclick="switchPage('exchange-page');">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h18m-7.5-12L21 9m0 0L16.5 4.5M21 9H3" />
                </svg>
                Swap
            </button>

            <button class="action-btn airdrop">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 0 1 14.625 7.5H15a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75V8.25A.75.75 0 0 1 9 7.5h.375A2.625 2.625 0 0 1 12 4.875Z" />
                </svg>
                Airdrop
            </button>
        </div>
    </div> 
    <h2 style="font-size: 18px; margin: 30px 0 15px 0; color: var(--tg-text); text-align: left;">Settings</h2>
    
    <button class="profile-action-button" onclick="handleWalletConnect()">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
            <span class="stat-label">
                <span class="icon">ğŸ’¼</span>
                <span id="wallet-btn-text">Connect to Wallet</span>
            </span>
            <span class="exchange-status" id="wallet-btn-status">Connect ></span>
        </div>
    </button>

    <button class="profile-action-button" onclick="window.handleSupportClick()">
        <span class="stat-label">
            <span class="icon">â“</span> Support
        </span>
    </button>

    <button class="profile-action-button" onclick="window.handleCloseClick()">
        <span class="stat-label">
            <span class="icon">âœ–ï¸</span> Close App)
        </span>
    </button>

</div> 




   <div id="social-tasks-page" class="game-page-container" style="display: none; text-align: left;">
            <h1 class="social-tasks-title">Social Tasks</h1>
            <p class="social-tasks-subtitle">áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µáŠ• á‰ áˆ›áŒ áŠ“á‰€á‰… á‰°áŒ¨áˆ›áˆª coin á‹«áŒáŠ™!</p>

            <div class="social-task-card" id="task-channel">
                <div class="social-task-icon-container" style="background-color: var(--et-blue);">
                    <span style="color: white;">âœˆï¸</span>
                </div>
                <div class="social-task-text-container">
                    <div class="social-task-title">Telegram Channel</div>
                    <div class="social-task-reward">+1500 ğŸ’°</div>
                </div>
                <button
                    class="social-task-action-button join-style"
                    id="channel-action"
                    data-link="https://t.me/Smart_Airdropss"
                    data-points="1500"
                    data-field="last_social_tg_channel_time"
                    data-name="Telegram Channel Join"
                    onclick="window.handleSocialTaskClick(this, 'join')">
                    Join
                </button>
            </div>

            <div class="social-task-card" id="task-group">
                <div class="social-task-icon-container" style="background-color: var(--et-blue);">
                    <span style="color: white;">ğŸ‘¥</span>
                </div>
                <div class="social-task-text-container">
                    <div class="social-task-title">Telegram Group</div>
                    <div class="social-task-reward">+1000 ğŸ’°</div>
                </div>
                <button
                    class="social-task-action-button join-style"
                    id="group-action"
                    data-link="https://t.me/school_library2012"
                    data-points="1000"
                    data-field="last_social_tg_group_time"
                    data-name="Telegram Group Join"
                    onclick="window.handleSocialTaskClick(this, 'join')">
                    Join
                </button>
            </div>

            <div class="social-task-card" id="task-youtube">
                <div class="social-task-icon-container" style="background-color: var(--et-red);">
                    <span style="color: white;">â–¶ï¸</span>
                </div>
                <div class="social-task-text-container">
                    <div class="social-task-title">YouTube Subscribe</div>
                    <div class="social-task-reward">+3000 ğŸ’°</div>
                </div>
                <button
                    class="social-task-action-button join-style"
                    id="youtube-action"
                    data-link="https://www.youtube.com/"
                    data-points="3000"
                    data-field="last_social_youtube_time"
                    data-name="YouTube Subscribe"
                    onclick="window.handleSocialTaskClick(this, 'subscribe')">
                    Subscribe
                </button>
            </div>
  <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
        </div>
        
        
        <div id="mystery-box-page" class="game-page-container" style="display: none;">
            <h2 class="page-title">Mystery Box Game</h2>
            <div class="game-info-box">
                <p>á‹•áˆˆá‰³á‹Šá‹áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áˆ£áŒ¥áŠ• á‹­áŠ­áˆá‰± áŠ¥áŠ“ á‰µáˆá‰… coin á‹«áˆ¸áŠ•á‰!</p>
                <div id="mystery-box-timer" class="cooldown-timer">Ready!</div>
                <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;">áˆ½áˆáˆ›á‰µ: +100 - +500 coin (á‰ á‹¨ 24 áˆ°á‹“á‰±)</p>
            </div>

            <div id="box-container" class="box-container">
                <div class="mystery-box" id="box-1" onclick="playMysteryBox(1)">?</div>
                <div class="mystery-box" id="box-2" onclick="playMysteryBox(2)">?</div>
                <div class="mystery-box" id="box-3" onclick="playMysteryBox(3)">?</div>
            </div>
            <p id="box-message" style="font-size: 16px; margin-top: 20px; font-weight: bold; color: var(--et-yellow);"></p>

            <button id="mystery-box-action" class="game-action-button" onclick="resetMysteryBox()">áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©</button>

            <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
        </div>
        
        
        

<div id="daily-spin-page" class="game-page-container">
    <h2 class="page-title">Daily Spin</h2>
    <div class="game-info-box">
        <p>á‹•á‹µáˆˆáŠ› áˆ½áŠ­áˆ­áŠ­áˆ­ (Spin) á‹«áˆ½áŠ¨áˆ­áŠ­áˆ© áŠ¥áŠ“ coin á‹«áŒáŠ™!</p>
        <div id="daily-spin-timer" class="cooldown-timer">Ready!</div>
    </div>

    <div class="wheel-container">
        <div class="pointer"></div>
        
        <div class="wheel" id="spin-wheel">
            <div class="segment" style="--i:0; --clr:#8BC34A;">
                <span class="segment-text">20<br>coin</span>
            </div>
            <div class="segment" style="--i:1; --clr:#CDDC39;">
                <span class="segment-text">2000<br>coin</span>
            </div>
            <div class="segment" style="--i:2; --clr:#FF9800;">
                <span class="segment-text">5<br>coin</span>
            </div>
            <div class="segment" style="--i:3; --clr:#FF5722;">
                <span class="segment-text">0<br>coin</span>
            </div>
            <div class="segment" style="--i:4; --clr:#F44336;">
                <span class="segment-text">10<br>coin</span>
            </div>
            <div class="segment" style="--i:5; --clr:#FFEB3B;">
                <span class="segment-text">1000<br>coin</span>
            </div>
            <div class="segment" style="--i:6; --clr:#9C27B0;">
                <span class="segment-text">500<br>coin</span>
            </div>
            <div class="segment" style="--i:7; --clr:#2196F3;">
                <span class="segment-text">200<br>coin</span>
            </div>
            <div class="segment" style="--i:8; --clr:#00BCD4;">
                <span class="segment-text">5000<br>coin</span>
            </div>
            <div class="segment" style="--i:9; --clr:#4CAF50;">
                <span class="segment-text">50<br>coin</span>
            </div>
        </div>

        <div class="center-circle">SPIN</div>
    </div>

    <button id="daily-spin-action" class="game-action-button" onclick="spinTheWheel()">áŠ áˆ½áŠ¨áˆ­áŠ­áˆ­</button>
    <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>


        <div id="reflex-game-page" class="game-page-container" style="display: none;">
            <h2 class="page-title">Reflex Game</h2>
            <div class="game-info-box">
                <p>áˆáŒ£áŠ•áŠá‰µá‹áŠ• á‹­áˆá‰µáŠ‘! á‰ ááŒ¥áŠá‰µ áˆáˆ‹áˆ½ áˆ°áŒ¥á‰°á‹ coin á‹«áŒáŠ™á¢</p>
                <div id="reflex-game-timer" class="cooldown-timer">Ready!</div>
                <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;">áˆ½áˆáˆ›á‰µ: áŠ¨ááŒ¥áŠá‰µá‹ áŒ‹áˆ­ á‰°áˆ˜áŒ£áŒ£áŠ (á‰ á‹¨ 24 áˆ°á‹“á‰±)</p>
            </div>

            <div id="reflex-play-area">
                <div id="reflex-button" onclick="stopReflexGame(event)">TAP ME!</div>
                <p id="reflex-message">áˆˆáˆ˜áŒ€áˆ˜áˆ­ áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰áˆá á‹­áŒ«áŠ‘á¢</p>
            </div>
            <p id="reflex-result" style="font-size: 18px; font-weight: bold; color: var(--et-yellow);"></p>

            <button id="reflex-game-action" class="game-action-button" onclick="startReflexGame()">áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­</button>

            <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
        </div>
        
        

        <div id="scratch-card-page" class="game-page-container" style="display: none;">
            <h2 class="page-title">Scratch Card Game ğŸ</h2>
            <div class="game-info-box">
                <p>áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆá‰…áˆá‰… (Scratch) á‹¨á‰°á‹°á‰ á‰€á‹áŠ• áˆ½áˆáˆ›á‰µ á‹«áŒáŠ™!</p>
                <div id="scratch-card-timer" class="cooldown-timer">Loading...</div>
                <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;">áˆ½áˆáˆ›á‰µ: áŠ¨ +100 áŠ¥áˆµáŠ¨ +500 coin (á‰ á‹¨ 12 áˆ°á‹“á‰±)</p>
            </div>

            <div id="scratch-card-container">
                <div id="scratch-prize-text" class="scratch-prize-layer">
                    <span>+500 ğŸ’°</span>
                </div>
                <canvas id="scratch-canvas" class="scratch-top-layer"></canvas>
            </div>

            <p id="scratch-result-message" style="font-size: 16px; margin-top: 20px; font-weight: bold; color: var(--et-yellow); min-height: 20px;"></p>

            <button id="scratch-card-action" class="game-action-button" style="display: none;" onclick="window.initScratchCard(true);">
                áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©
            </button>

            <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
        </div>
                
                
                
<div id="withdraw-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">ğŸ’¸ á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdrawal)</h2>

    <div class="withdraw-card modern-card-3d balance-input-card">
        <p class="card-title">áˆŠá‹ˆáŒ£ á‹¨áˆšá‰½áˆ á‰€áˆª áˆ’áˆ³á‰¥</p>
        <p class="balance-amount">
            <span id="currentWithdrawBalance">0.00</span> $
        </p>
        <span class="currency-label">Token/áŒˆáŠ•á‹˜á‰¥</span>

        <hr>

        <p class="card-title" style="margin-top: 10px;">áˆ›á‹áŒ£á‰µ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•</p>
        <div class="quantity-control">
            <button class="qty-btn minus-btn" onclick="window.adjustWithdrawInput(-10)">âˆ’</button>
            <input type="number" id="withdrawAmountInput" placeholder="á‹á‰…á‰°áŠ›á‹: 100" min="100" step="10" 
                   value="100" oninput="window.validateWithdrawal()" class="qty-input">
            <button class="qty-btn plus-btn" onclick="window.adjustWithdrawInput(10)">+</button>
        </div>
    </div>
    
    <div class="method-master-card">
        <p class="card-title">á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡</p>
        
        <div id="method-selection-container">
            
            <div class="method-wrapper" id="wrapper-telegram">
                <div class="method-card method-card-tg" data-method="telegram" onclick="window.selectMethod('telegram', this)">
                    <div class="method-info">
                        <span class="method-icon">ğŸš€</span>
                        <div class="method-name">Telegram Payments (Native)</div>
                    </div>
                    <div class="method-fee">Free: 1%</div>
                    <span class="selection-indicator" id="telegram-indicator">âœ”</span>
                </div>
            </div>

            <div class="method-wrapper" id="wrapper-crypto">
                <div class="method-card method-card-crypto" data-method="crypto" onclick="window.selectMethod('crypto', this)">
                    <div class="method-info">
                        <span class="method-icon">â‚¿</span>
                        <div class="method-name">Crypto (USDT TRC20)</div>
                    </div>
                    <div class="method-fee">Free: 1.5%</div>
                    <span class="selection-indicator" id="crypto-indicator">âœ”</span>
                </div>
            </div>

            <div class="method-wrapper" id="wrapper-paypal">
                <div class="method-card method-card-paypal" data-method="paypal" onclick="window.selectMethod('paypal', this)">
                    <div class="method-info">
                        <span class="method-icon">ğŸ…¿ï¸</span>
                        <div class="method-name">PayPal</div>
                    </div>
                    <div class="method-fee">Free: 2%</div>
                    <span class="selection-indicator" id="paypal-indicator">âœ”</span>
                </div>
            </div>

        </div>
    </div>
    
    


    

    <div class="withdraw-card action-card modern-card-3d">
        <p id="withdrawMessage"></p>
        
        <button id="finalWithdrawButton" disabled class="modern-exchange-btn disabled-btn" onclick="window.initiateWithdrawal()">
            WITHDRAW NOW
        </button>
    </div>
    
    <button class="game-back-button" onclick="switchPage('profile-page')">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
</div>
   
                <div id="exchange-page" class="game-page-container" style="display: none;">
    <h2 class="page-title" style="margin-bottom: 30px;">âš¡ï¸ SMART COIN EXCHANGE âš¡ï¸</h2>

    <div class="modern-card" style="margin-bottom: 25px;">
        <p class="card-title">á‹«áˆá‹á‰µ coin</p>
        <p class="balance-amount" id="currentCoinBalance" style="color: var(--et-yellow);">0</p>
        <span class="currency-label">COIN</span>

        <hr style="border: 0; height: 1px; background-color: #555; margin: 15px 0;">
        
        <div class="rate-display">
            <span class="rate-label">áˆá‹á‹áŒ¥ áˆáŒ£áŠ” (Rate)</span>
            <span class="rate-value" id="exchangeRateDisplay">10,000 Coin = 1 Smart Coin</span>
        </div>
    </div>
    
    <div class="modern-card-3d">
        <p class="card-title">áˆ˜á‰€á‹¨áˆ­ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•</p>
        
        <div class="quantity-control">
            <button class="qty-btn minus-btn" onclick="adjustExchangeInput(-10000)">-</button>
            <input type="number" id="exchangePointsInput" placeholder="10,000" min="10000" step="10000" 
                   value="10000" oninput="calculateSmartCoin()" class="qty-input">
            <button class="qty-btn plus-btn" onclick="adjustExchangeInput(10000)">+</button>
        </div>

        <div class="smart-coin-output">
            <p></p>
            <p id="smartCoinResult">1 Smart Coin</p>
        </div>
    </div>

    <button id="finalExchangeButton" disabled class="modern-exchange-btn disabled-btn">
        EXCHANGE NOW
    </button>
    
    <p id="exchangeMessage" style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 14px;"></p>
    
    <button class="game-back-button" onclick="switchPage('profile-page')">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
</div>

<div id="transaction-history-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">ğŸ“œ Transaction History</h2>
    
    <div id="general-history-list" style="padding-bottom: 20px;">
        <p style="text-align: center; color: #888;">áˆáŠ•áˆ á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>
    </div>

    <button class="game-back-button" onclick="switchPage('profile-page')">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
</div>



        <div id="keno-game-page" class="page" style="display: none; padding: 15px 0;">
        <div id="keno-game-container">
        <div id="keno-header-status">
            <span>KENO GAME</span>
            <span id="keno-total-points">0.00 Coin</span>
        </div>
        
        <div id="keno-tab-navigation">
            <button class="keno-tab-button active" onclick="window.kenoShowTab('keno-live-tab', this)">Live</button>
            <button class="keno-tab-button" onclick="window.kenoShowTab('keno-history-tab', this)">History</button>
            <button class="keno-tab-button" onclick="window.kenoShowTab('keno-results-tab', this)">Results</button>
        </div>
        
        <div id="keno-tab-contents">
            
            <div id="keno-live-tab" class="keno-tab-content active">
                <p id="keno-pick-info">0 Picks | Select up to 10 numbers</p>
                
                <div id="keno-main-game-area">
                    <div id="keno-grid"></div>
                    <div id="keno-draw-shaker-area">
                        <span id="keno-draw-count-area">0 / 20</span>
                        <div id="keno-current-ball-area">?</div>
                        <span id="keno-draw-status">Waiting...</span>
                    </div>
                </div>

                <button id="keno-random-pick-btn" onclick="window.kenoRandomSelect(10)">Random Pick (10 Numbers)</button>

                <div id="keno-selected-picks-area">
                    á‹¨áˆ˜áˆ¨áŒ§á‰¸á‹ á‰áŒ¥áˆ®á‰½: [ ]
                </div>
                
                <p id="keno-message">á‰áŒ¥áˆ®á‰½á‹áŠ• á‹­áˆáˆ¨áŒ¡áŠ“ BET á‹­áŒ«áŠ‘á¢</p>

                <div id="keno-bet-controls">
                    <div id="keno-bet-input-group">
                        <button class="keno-bet-modifier" onclick="window.kenoChangeBet(-100)">-</button> 
                        <input type="number" id="keno-bet-amount-input" value="100" min="100" step="100">
                        <button class="keno-bet-modifier" onclick="window.kenoChangeBet(100)">+</button> 
                    </div>
                    
                    <div id="keno-bet-button-group">
                        <button id="keno-bet-btn" onclick="window.kenoStartGame()">BET</button>
                    </div>
                </div>
            </div>

            <div id="keno-history-tab" class="keno-tab-content">
                <h4>ğŸ“œ á‹«áˆˆá‰á‰µ áŒ¨á‹‹á‰³á‹á‰½ á‰³áˆªáŠ­ (Last 10 Games)</h4>
                <div id="keno-history-list">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</div>
            </div>

            <div id="keno-results-tab" class="keno-tab-content">
                <h4>ğŸ’° á‹¨áˆ½áˆáˆ›á‰µ áˆ°áŠ•áŒ áˆ¨á‹¥ (Payout Table)</h4>
                <p>á‰ áˆ˜áˆ¨áŒ¡á‰µ á‹¨á‰áŒ¥áˆ®á‰½ á‰¥á‹›á‰µ (Picks) áˆ˜áˆ áˆ¨á‰µ á‹¨áˆ›áˆ¸áŠá á‰¥á‹œá‰µ (Multiplier) á‹­áˆˆá‹«á‹«áˆá¢</p>
                <div id="keno-paytable-content"></div>
            </div>
            
        </div>
    </div>
    <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>


<div id="staking-page" class="game-page-container" style="display: none; text-align: left;">
    <h2 class="page-title">ğŸ’° Stake & Earn ğŸ’°</h2>

    <div id="stake-header-status">
        <span>á‹«áˆá‹á‰µ Coin</span>
        <span id="stake-total-points">0.00 Coin</span>
    </div>
   
    <div id="stake-tab-navigation">
        <button class="stake-tab-button active" onclick="window.showStakeTab('stake-live-tab', this)">Stake</button>
        <button class="stake-tab-button" onclick="window.showStakeTab('stake-history-tab', this)">History</button>
        <button class="stake-tab-button" onclick="window.showStakeTab('stake-rules-tab', this)">Rules</button>
    </div>

    <div id="stake-tab-contents">

        <div id="stake-live-tab" class="stake-tab-content active">
            <div id="staking-input-card" style="display: none;">
                <p class="stake-card-title">á‹¨ Stake áŠ áˆ›áˆ«áŒ­ á‹­áˆáˆ¨áŒ¡</p>
                <div id="stake-plans-container">
                    </div>
                <p id="stakeInputMessage" class="stake-message"></p>
            </div>
            
            <div id="stake-card-wrapper" style="position: relative;">

                <div id="self-ad-banner-container">
                </div> 

                <div id="staking-claim-card" class="modern-card-3d" style="display: none; border-color: var(--stake-green);">
                    <p class="stake-card-title">áŠ áˆáŠ• á‹«áˆˆá‹ Stake</p>
                    <p class="balance-amount" id="stakedAmountDisplay">0</p>
                    <span class="currency-label">COIN STAKED</span>

                    <hr>

                    <div class="game-info-box" style="background-color: var(--stake-bg-primary); padding: 15px;">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #aaa;">Status:</span>
                            <div id="stakeCooldownTimer" class="cooldown-timer" style="font-size: 14px;">Loading...</div>
                        </div>

                        <div class="stake-progress-container">
                            <div id="stakeProgressBar" class="stake-progress-fill"></div>
                        </div>
                        
                        <div class="accrued-text" style="margin-bottom: 10px;">
                            áŠ¥áˆµáŠ«áˆáŠ• á‹¨á‰°áŒ áˆ«á‰€áˆ˜: <span id="accruedInterestDisplay" class="accrued-value">0.00</span>
                        </div>

                        <div style="display: flex; justify-content: space-between;">
                             <span style="font-size: 12px;">Total Reward:</span>
                             <span id="stakeReturnMessage" style="font-size: 14px; color: var(--stake-yellow); font-weight: bold;">...</span>
                        </div>

                    </div>
                    
                    <button id="stakeClaimButton" class="game-action-button" onclick="window.handleClaimStakeClick()" disabled>
                        CLAIM REWARD
                    </button>
                </div>
                
            </div> 
            </div> <div id="stake-history-tab" class="stake-tab-content">
            <h4 class="stake-card-title" style="text-align: center;">ğŸ“œ á‹¨ Stake á‰³áˆªáŠ­ (History)</h4>
            <div id="stake-history-list">
                <p style="text-align: center; color: var(--stake-text-secondary);">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</p>
            </div>
        </div> <div id="stake-rules-tab" class="stake-tab-content">
            <h4 class="stake-card-title" style="text-align: center;">âš–ï¸ áˆ…áŒ áŠ¥áŠ“ á‹°áŠ•á‰¥ (Rules)</h4>
            <div class="keno-paytable-card" style="background-color: var(--stake-bg-secondary);">
                <div class="keno-paytable-header" style="background-color: var(--stake-yellow); color: #111;">
                    Staking Rules
                </div>
                <ul style="padding: 15px 30px; line-height: 1.6; color: var(--stake-text-primary);">
                    <li>"Stake" áˆ›áˆˆá‰µ áˆ³áŠ•á‰²áˆá‹áŠ• áˆˆá‰°á‹ˆáˆ°áŠ áŒŠá‹œ á‰ áˆ˜á‰†áˆˆá á‹ˆáˆˆá‹µ (á‰µáˆ­á) áˆ›áŒáŠ˜á‰µ áˆ›áˆˆá‰µ áŠá‹á¢</li>
                    <li>áŠ áŠ•á‹´ "Stake" áŠ«á‹°áˆ¨áŒ‰ á‰ áŠ‹áˆ‹á£ á‹«áˆµá‰€áˆ˜áŒ¡á‰µ áŒŠá‹œ (áˆˆáˆáˆ³áˆŒ 24 áˆ°á‹“á‰µ) áŠ¥áˆµáŠªá‹«áˆá‰… á‹µáˆ¨áˆµ áˆ³áŠ•á‰²áˆá‹áŠ• áˆ›á‹áŒ£á‰µ áŠ á‹­á‰½áˆ‰áˆá¢</li>
                    <li>áŒŠá‹œá‹ áˆ²á‹«áˆá‰… "Claim" á‹¨áˆšáˆˆá‹áŠ• á‰áˆá á‰ áˆ˜áŒ«áŠ• á‹‹áŠ“á‹áŠ• áˆ³áŠ•á‰²áˆ áŠ¨áŠá‹ˆáˆˆá‹± áˆ˜á‹áˆ°á‹µ áŠ áˆˆá‰¥á‹á‰µá¢</li>
                    <li>á‰ áŠ áŠ•á‹µ áŒŠá‹œ áŠ áŠ•á‹µ á‹¨ Stake á•áˆ‹áŠ• á‰¥á‰» áˆ˜áŒ á‰€áˆ á‹­á‰½áˆ‹áˆ‰á¢</li>
                    <li>áˆ³áŠ•á‰²áˆá‹áŠ• "Claim" áŠ«áˆ‹á‹°áˆ¨áŒ‰ á‰ á‰€áˆ­ áŠ á‹²áˆµ Stake áˆ˜áŒ€áˆ˜áˆ­ áŠ á‹­á‰½áˆ‰áˆá¢</li>
                </ul>
            </div>
        </div> </div> <button class="game-back-button" onclick="window.showMainLobby()">
        â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ
    </button>
</div> 








    <div id="daily-cipher-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">Daily Cipher ğŸ•µï¸</h2>
    <div class="game-info-box">
        <p>á‹¨á‹›áˆ¬á‹áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áŠ®á‹µ (Morse/Text) á‹«áˆµáŒˆá‰¡!</p>
        <div id="daily-cipher-timer" class="cooldown-timer">Ready!</div>
        <p style="font-size: 12px; color: var(--tg-hint);">áŠ®á‹±áŠ• áˆˆáˆ›áŒáŠ˜á‰µ á‹¨á‰´áˆŒáŒáˆ«áˆ á‰»áŠ“áˆ‹á‰½áŠ•áŠ• á‹­áŠ¨á‰³á‰°áˆ‰á¢</p>
    </div>

    <div class="cipher-display-area">
        <input type="text" id="cipher-input" placeholder="CODE HERE" maxlength="10">
    </div>

    <p id="cipher-message" style="margin-top: 10px; font-weight: bold;"></p>

    <button id="cipher-submit-btn" class="game-action-button" onclick="window.submitDailyCipher()">
        CHECK CODE
    </button>

    <button class="game-back-button" onclick="showMainPage()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>

<div id="memory-game-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">Memory Match ğŸ§ </h2>
    <div class="game-info-box">
        <p>áˆáˆ‰áŠ•áˆ áŒ¥áŠ•á‹µ áŠ«áˆ­á‹¶á‰½ á‹«áŒáŠ™!</p>
        
        <div id="memory-game-timer-display" class="cooldown-timer">Status Checking...</div> 
        
        <div id="memory-cooldown-status" style="font-size:12px; color:var(--et-red); display:none;">Cooldown Active</div>
    </div>

    <div id="memory-game-grid"></div>

    <p id="memory-message" style="margin-top: 15px; font-weight: bold; color: var(--et-yellow); min-height: 20px;"></p>

    <button id="memory-start-btn" class="game-action-button" onclick="window.startMemoryGame()">
        START GAME
    </button>

    <button class="game-back-button" onclick="window.cleanupGame()">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>



    </div>
<div id="nav-bar">
        <div class="nav-item active" id="nav-tasks" onclick="switchPage('tasks-page')">
            <span class="nav-icon">â­</span>
            <span>Tasks</span>
        </div>

        <div class="nav-item" id="nav-stake" onclick="switchPage('staking-page')">
            <span class="nav-icon">ğŸ¦</span>
            <span>Stake</span>
        </div>

        <div class="nav-item" id="nav-top" onclick="switchPage('top-page')">
            <span class="nav-icon">ğŸ‘‘</span>
            <span>Top</span>
        </div>
        <div class="nav-item" id="nav-profile" onclick="switchPage('profile-page')">
            <span class="nav-icon">ğŸ‘¤</span>
            <span>Profile</span>
        </div>
    </div>
</body>

 <script>
        // ğŸ›‘ áˆ˜áá‰µáˆ” 2: á‹¨ showMainPage() á‰°áŒá‰£áˆ­ á‹ˆá‹° áŒáˆá‰£áˆ áˆµáŠ®á• á‰°áˆ˜áˆˆáˆ°
        window.showMainPage = () => switchPage('tasks-page'); 
        
        
        
        // ======================================================================
        // ğŸ›‘ NEW: á‹¨á‹ˆáˆ¨á‰€á‰µ áŠ®áŠ•áŒá‰² áŠ áŠ’áˆœáˆ½áŠ• á‰°áŒá‰£áˆ­ (Paper Confetti)
        // ======================================================================
        window.triggerConfetti = (points) => {
            if (typeof confetti === 'undefined') return;

            // áˆˆ200 coin áŠ¥áŠ“ áŠ¨á‹šá‹« á‰ áˆ‹á‹­ á‰¥á‰» áŠ¥áŠ•á‹²áˆ°áˆ«
            if (points < 200) return; 

            // á‹¨coin áˆ˜áŒ áŠ• áˆ²áŒ¨áˆáˆ­ á‹¨áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜áŒ áŠ• áŠ¥áŠ“ áˆµáˆ­áŒ­á‰µ á‹­áŒ¨áˆáˆ«áˆ
            const particleCount = points >= 500 ? 180 : 100;
            const spread = points >= 500 ? 90 : 70;
            
            // áˆˆá‹ˆáˆ¨á‰€á‰µ áŠ®áŠ•áŒá‰² á‹¨áˆšáˆ†áŠ‘ á‹°áˆ›á‰… á‰€áˆˆáˆá‰½
            const colors = ['#FFD700', '#1E90FF', '#FF69B4', '#32CD32', '#C0C0C0']; 

            // á‹¨á‹‹áŠ“ áŠ®áŠ•áŒá‰² ááŠ•á‹³á‰³
            confetti({
                particleCount: particleCount,
                spread: spread,
                origin: { y: 0.5 }, 
                colors: colors,
                // ğŸ›‘ á‹¨á‹ˆáˆ¨á‰€á‰µ áŒˆáŒ½á‰³: áŠ áˆ«á‰µ áˆ›á‹•á‹˜áŠ• áŠ¥áŠ“ á‰µáŠ•áˆ½ áŠ áˆ«á‰µ áˆ›á‹•á‹˜áŠ• á‰…áˆ­áŒ¾á‰½
                shapes: ['square', 'rect'], 
                scalar: 1.1, // á‹¨á‰…áŠ•áŒ£á‰¶á‰¹áŠ• áˆ˜áŒ áŠ• á‰µáŠ•áˆ½ áˆ˜áŒ¨áˆ˜áˆ­
                zIndex: 9998
            });
            
            // áˆˆá‰°áŒ¨áˆ›áˆª á‹µáˆ«áˆ›á‹ŠáŠá‰µ áˆ¨á‹£á‹¥áˆ á‹ˆáˆ¨á‰€á‰¶á‰½ (Ribbons)
            if (points >= 500) {
                function fireFromSide(angle, originX) {
                    confetti({
                        particleCount: 20,
                        angle: angle,
                        spread: 30,
                        origin: { x: originX, y: 0.9 }, 
                        colors: ['#FFC107', '#FFFFFF'], // á‹ˆáˆ­á‰… áŠ¥áŠ“ áŠáŒ­
                        // ğŸ›‘ á‹¨á‹ˆáˆ¨á‰€á‰µ áŒˆáŒ½á‰³: áˆ¨á‹£á‹¥áˆ á‹¨á‹ˆáˆ¨á‰€á‰µ áŠ­áˆ®á‰½ (ribbons)
                        shapes: ['line'], 
                        scalar: 0.6,
                        startVelocity: 30,
                        decay: 0.9,
                        zIndex: 9998
                    });
                }
                fireFromSide(45, 0); // áŠ¨áŒáˆ«
                fireFromSide(135, 1); // áŠ¨á‰€áŠ
            }
        }
        
        
        
   // ======================================================================
// âœ… á‹¨á‹µáˆáŒ½ áˆ›áŒ«á‹ˆá‰» á‰°áŒá‰£áˆ­ ( window. á‰°á‹ˆáŒá‹·áˆ - á‰µáŠ­áŠ­áˆˆáŠ› áŠ¥áŠ“ áŠ•áŒ¹áˆ… áˆµáˆªá‰µ)
// ======================================================================

const BASE_URL = 'https://tame3232.github.io/2/Sound/'; 

const soundUrls = {
    spin: BASE_URL + 'spin_sound.mp3',   
    win: BASE_URL + 'win_sound.mp3',     
    fail: BASE_URL + 'fail_sound.mp3',
    click: BASE_URL + 'click_sound.mp3'
};

const loadedSounds = {};
for (const type in soundUrls) {
    if (soundUrls.hasOwnProperty(type)) {
        loadedSounds[type] = new Audio(soundUrls[type]);
        // ğŸ›‘ FIX 5: .load() á‰°á‹ˆáŒá‹·áˆá¢
        // áŠ áˆ³áˆ¹ áˆ«áˆ± play() áˆ²á‰£áˆ áˆ˜áŒ«áŠ• á‹­áŒ€áˆáˆ«áˆ (á‹­áˆ… á‹¨á‰°áˆ»áˆˆ áŠá‹)
        // loadedSounds[type].load(); 
    }
}

// áŠ áˆáŠ• á‰°áŒá‰£áˆ© 'playSound' á‰¥á‰» á‰°á‰¥áˆáˆ
window.playSound = (type) => {
    const audio = loadedSounds[type];
    
    if (audio) {
        audio.pause();
        audio.currentTime = 0; 
        
        audio.play().catch(e => {
            console.warn(`Sound playback failed for '${type}':`, e.message);
        });
    } else {
        console.warn(`á‹¨áˆ›á‹­á‰³á‹ˆá‰… á‹¨á‹µáˆá… áŠ á‹­áŠá‰µ á‰°áŒ á‹­á‰‹áˆ: ${type}`);
    }
}
</script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, updateDoc, doc, setDoc, collection, query, onSnapshot, orderBy, limit, increment, serverTimestamp, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

let cachedLeaderboardData = null; 
let lastLeaderboardFetchTime = 0;
const CACHE_LIFETIME = 3 * 60 * 1000; // 3 á‹°á‰‚á‰ƒ á‰  áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ





        // ===================================================================================
        // === 2. á‹¨áŠ¥áˆ­áˆµá‹ Firebase Configuration ===
        // ===================================================================================
        const firebaseConfig = {
          // ğŸ›‘ áˆ›áˆµá‰³á‹ˆáˆ»: áŠ¥áŠá‹šáˆ… á‰áˆáá‰½ á‰ á‰µáŠ­áŠ­áˆ áŠ¨áŠ¥áˆ­áˆµá‹ Firebase project áŒ‹áˆ­ áˆ˜á‹›áˆ˜á‹µ áŠ áˆˆá‰£á‰¸á‹
          apiKey: "AIzaSyA9rGEGZifwxz820MR-DZZ6BGHTTZfd7Y4",
          authDomain: "mysteryspingame-41d3b.firebaseapp.com",
          projectId: "mysteryspingame-41d3b",
          storageBucket: "mysteryspingame-41d3b.appspot.com", 
          messagingSenderId: "1078389216479",
          appId: "1:1078389216479:web:75c64f5e4ff147c10f856a"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 


        const WebApp = window.Telegram.WebApp;
        let currentFirebaseUserId = null; 
        let telegramUserId = null; 
        let currentScore = 0; // 
        let currentSmartCoinBalance = 0;
        let currentTickets = 0; 
        let currentUserDocData = null; 
        let currentRank = 'N/A'; 
        let isReflexGameRunning = false; 
        let timerIntervals = {}; // áˆˆáˆáˆ‰áˆ Cooldown Timers á‹¨áˆšá‹áˆ
        
        
        
        // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ (Daily Streak) á‹¨áˆšá‹«áŒˆáˆˆáŒáˆ á‹áˆ­á‹áˆ­
   const dailyStreakRewards = [
    { day: 1, coins: 700, field: 'day_1_claimed' },
    { day: 2, coins: 1500, field: 'day_2_claimed' },
    { day: 3, coins: 3000, field: 'day_3_claimed' },
    { day: 4, coins: 7000, field: 'day_4_claimed' },
    { day: 5, coins: 15000, field: 'day_5_claimed' },
    { day: 6, coins: 30000, field: 'day_6_claimed' },
    { day: 7, coins: 100000, field: 'day_7_claimed' },
    
    // ğŸ‘‡ğŸ‘‡ğŸ‘‡ áŠ¥áŠá‹šáˆ… 3á‰± áˆ‹á‹­ locked: true á‰°áŒ¨áˆáˆ¯áˆ ğŸ‘‡ğŸ‘‡ğŸ‘‡
    { day: 8, coins: 500000, field: 'day_8_claimed', locked: true },
    { day: 9, coins: 1000000, field: 'day_9_claimed', locked: true },
    { day: 10, coins: 2000000, field: 'day_10_claimed', locked: true },
];
     
        // ======================================================================
        // ğŸ›‘ UPDATED: áˆˆ Slot Game á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ áˆ˜áˆ¨áŒƒá‹á‰½
        // ======================================================================
        const SLOTS_MAX_SPINS = 10;
        const SLOTS_COOLDOWN_FIELD = 'last_slot_reset_time';
        // ğŸ›‘ TICKET_REWARD á‹ˆá‹° COIN_REWARD á‰°á‰€á‹­áˆ¯áˆ áŠ¥áŠ“ á‹ˆá‹²á‹«á‹áŠ‘ á‹ˆá‹° coin á‹­á‹°áˆ˜áˆ«áˆ
        const COIN_REWARD = 1000; 
        let currentSpinsLeft = SLOTS_MAX_SPINS;
        // ğŸ›‘ slot_teto_wins á‰°á‹ˆáŒá‹·áˆ
        const slotItems = [
            'ğŸ’', // Diamond (á‰µáˆá‰… áŠ áˆ¸áŠ“áŠ)
            'â­', // Star
            'ğŸ’°', // Money Bag
            'ğŸ’', // Cherry
        ];




        // ======================================================================
        //                             UTILITY FUNCTIONS
        // ======================================================================
        
        function getAvatarHtml(username, photoUrl) {
            if (photoUrl) {
                return `<img src="${photoUrl}" alt="Profile Photo" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                const initial = username ? username.charAt(0).toUpperCase() : 'ğŸ‘¤';
                return initial;
            }
        }
        
        // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆ: á‹¨ Streak áŠ¥áŠ“ Slot áŠ áˆ˜áŠ­áŠ•á‹® á‰ áˆá‹© áˆáŠ”á‰³ á‰°á‹­á‹Ÿáˆ
        function checkDailyLimit(taskField) {
            if (!currentUserDocData || !currentUserDocData[taskField]) {
                // áˆˆáˆ˜áŒ€áˆ˜áˆªá‹« áŒŠá‹œ áˆ²áŒ áˆ« (á‹ˆá‹­áŠ•áˆ á‹³á‰³ á‹¨áˆŒáˆˆá‹ áŠ¨áˆ†áŠ)
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            }

            const lastUsedTimestamp = currentUserDocData[taskField];
            let lastUsedDate;

            if (lastUsedTimestamp && lastUsedTimestamp.toDate) {
                lastUsedDate = lastUsedTimestamp.toDate();
            } else {
                // áŒŠá‹œ áˆ›áˆ…á‰°áˆ™ á‰µáŠ­áŠ­áˆ áŠ«áˆáˆ†áŠ á‹ˆá‹­áˆ null áŠ¨áˆ†áŠ, á‹áŒáŒ áŠá‹
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            }

            // áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹µ áŒŠá‹œ á‰¥á‰» á‹¨áˆšáˆ°áˆ© áŠ“á‰¸á‹ (á‹•áˆˆá‰³á‹Š áŒˆá‹°á‰¥ á‹¨áˆ‹á‰¸á‹áˆ)
            if (taskField.startsWith('last_social_')) {
                 // á‹¨"social" á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹´ áŠ¨á‰°áˆ°áˆ© á‰ áŠ‹áˆ‹ áˆáˆáŒŠá‹œ "hasCompleted" á‹­áˆ†áŠ“áˆ‰
                 return { isReady: false, remainingMs: 0, hasCompleted: true };
            }
            
            // áˆˆáˆáˆ‰áˆ á‹•áˆˆá‰³á‹Š áŒˆá‹°á‰¦á‰½ (24-áˆ°á‹“á‰µ)
            const now = new Date();
            const twentyFourHours =  24 * 60 * 60 * 1000; // ğŸ›‘ 12 áˆ°á‹“á‰µ áŠá‹ (24 áˆ˜áˆ†áŠ• á‹¨áˆˆá‰ á‰µáˆ?) - áŠ¥áŠ•á‹° áŠ®á‹µá‹ 12 áˆ°á‹“á‰µ áˆ†áŠ—áˆ
            const elapsed = now.getTime() - lastUsedDate.getTime();
            
            if (elapsed >= twentyFourHours) {
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            } else {
                const remainingMs = twentyFourHours - elapsed;
                return { isReady: false, remainingMs: remainingMs, hasCompleted: false };
            }
        }
        
        function formatTime(ms) {
            if (ms <= 0) return "Ready!";
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
    // âœ… áŠ áˆ›áˆ«áŒ­ 2: áŠ®á‹µ - áˆáˆáŒŠá‹œ áˆ˜áŒ«áŠ• á‹­á‰»áˆ‹áˆá£ áˆ°á‹“á‰±áŠ• á‹áŒª áŠ á‹«áˆ³á‹­áˆ
function updateTaskCardStatus(cardId, badgeId, cooldownField) {
    const card = document.getElementById(cardId);
    const badge = document.getElementById(badgeId);
    
    if (!card || !badge) return;

    // ğŸ›‘ á‹‹áŠ“á‹ áˆˆá‹áŒ¥: áˆáˆáŒŠá‹œ áˆ˜áŒ«áŠ• á‹­áˆá‰€á‹³áˆ (Clickable)
    card.style.pointerEvents = 'auto'; 
    card.classList.remove('cooldown-style');

    // 1. áˆˆ Slot Game áˆá‹© áˆáŠ”á‰³
    if (cardId === 'slots-game-card') {
         const { isReady: resetReady } = checkDailyLimit(cooldownField); 
         
         if (currentSpinsLeft > 0) {
             badge.innerText = `Spins: ${currentSpinsLeft}`;
             badge.className = 'status-badge ready'; 
         } else if (!resetReady) {
             // Cooldown áˆ‹á‹­ áŠ¨áˆ†áŠ á‰£á‹¶ áŒ½áˆá
             badge.innerText = ''; 
             badge.className = 'status-badge'; 
         } else {
             badge.innerText = 'Reset Ready!';
             badge.className = 'status-badge ready'; 
         }
         return; 
    }
    
    // 2. áˆˆáˆŒáˆá‰½ áŒ¨á‹‹á‰³á‹á‰½ (Mystery, Daily Spin, Reflex)
    const { isReady } = checkDailyLimit(cooldownField);

    if (isReady) {
        badge.innerText = 'PLAY ğŸ”¥'; 
        badge.className = 'status-badge ready'; 
    } else {
        // Ready áŠ«áˆáˆ†áŠ á‰£áŒ á‰£á‹¶ á‹­áˆ†áŠ“áˆ
        badge.innerText = ''; 
        badge.className = 'status-badge';
    }
}
    
        function updateSocialTaskStatus(taskElementId, link, coins, field, actionType) { 
    const button = document.getElementById(taskElementId);
    if (!button) return;

    // 1. á‹¨á‹³á‰³á‰¤á‹ áá‰°áˆ» (Has Completed?)
    const { hasCompleted } = checkDailyLimit(field);

    if (hasCompleted) {
        // âœ… áŠ¨á‹šáˆ… á‰ áŠá‰µ áŠ¨á‰°áˆ°áˆ« (Firebase áˆ‹á‹­ áˆ˜áˆ¨áŒƒá‹ áŠ«áˆˆ)
        button.innerText = `Completed âœ…`;
        button.classList.remove('join-style');
        button.classList.add('completed-style');
        button.onclick = null; // áŠ­áˆŠáŠ­ áˆ˜áŠ¨áˆáŠ¨áˆ
        button.disabled = true;
        // âš ï¸ data-stateáŠ• áˆ›áˆµá‹ˆáŒˆá‹µ (Timer Logic áŠ«áˆˆáˆ…)
        button.removeAttribute('data-state'); 
    } else {
        // âŒ áŠ«áˆá‰°áˆ°áˆ«á£ áŠ á‹áˆ«áˆ©áŠ• áˆˆáˆµáˆ« áˆ›á‹˜áŒ‹áŒ€á‰µ
        const actionText = actionType === 'subscribe' ? 'Subscribe' : 'Join';
        
        // Timer áŠ¥á‹¨áˆ®áŒ  áŠ«áˆáˆ†áŠ á‰¥á‰» á‹ˆá‹° Join áˆ˜áˆ˜áˆˆáˆµ
        if (!button.innerText.includes('Checking')) {
             button.innerText = actionText;
             button.classList.remove('completed-style');
             button.classList.add('join-style');
             button.disabled = false;
             button.onclick = () => window.handleSocialTaskClick(button, actionType);
             button.removeAttribute('data-state');
        }
    }
}


        function startCooldownTimer(taskField, timerElementId, actionButtonId) {
            if (timerIntervals[taskField]) {
                clearInterval(timerIntervals[taskField]);
            }

            const timerEl = document.getElementById(timerElementId);
            const actionButton = document.getElementById(actionButtonId);
            
            if (!timerEl && !actionButton) return; 
            
            // ğŸ›‘ UPDATED: áˆˆ Slot Game Timer áˆá‹© áŠ áˆ˜áŠ­áŠ•á‹®
             if (taskField === SLOTS_COOLDOWN_FIELD) {
                 const { isReady, remainingMs } = checkDailyLimit(taskField);
                 const timerContainer = document.getElementById('reset-timer-container');
                 const spinBtn = document.getElementById('spin-btn');
                 const messageEl = document.getElementById('game-message');

                 if (isReady) {
                      if(currentSpinsLeft <= 0) {
                          // á‹³áŒáˆ á‹¨áˆ›áˆµáŒ€áˆ˜áˆ­ áŒŠá‹œ á‹°áˆ­áˆ·áˆ (áŒáŠ• áŒˆáŠ“ á‹³áŒáˆ áŠ áˆá‰°áŒ€áˆ˜áˆ¨áˆ)
                          if(timerContainer) timerContainer.style.display = 'block';
                          if(timerEl) timerEl.innerText = "Ready to Reset! Click SPIN to get 10 more.";
                          if (spinBtn) {
                              spinBtn.disabled = false;
                              spinBtn.innerText = "RESET & SPIN";
                              spinBtn.onclick = () => window.resetSlotGameAndSpin(true); // á‹³áŒáˆ áŠ áˆµáŒ€áˆáˆ­áŠ“ áˆµá’áŠ• áŠ á‹µáˆ­áŒ
                          }
                      } else {
                           if (timerContainer) timerContainer.style.display = 'none';
                      }
                      
                      // á‹­áˆ…áŠ•áŠ• á‹¨24-áˆ°á‹“á‰µ á‰†áŒ£áˆª á‰ á‹¨áˆ°áŠ¨áŠ•á‹± áˆ›áˆ„á‹µ áŠ á‹«áˆµáˆáˆáŒáˆ - á‰ áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­á‰ á‰µ áŒŠá‹œ á‰¥á‰» áŠá‹ á‹¨áˆšá‹«áˆµáˆáˆáŒˆá‹
                      if (timerIntervals[taskField]) {
                           clearInterval(timerIntervals[taskField]);
                           delete timerIntervals[taskField];
                      }
                      return; 
                 } else if (currentSpinsLeft <= 0) {
                      // áŒˆá‹°á‰¡ áŠ áˆˆá‰€ áŠ¥áŠ“ áŒŠá‹œá‹ áŒˆáŠ“ áŠ áˆá‹°áˆ¨áˆ°áˆ
                      if (timerContainer) timerContainer.style.display = 'block';
                      if (spinBtn) spinBtn.disabled = true;
                      if (messageEl) messageEl.innerText = "Spin áŠ áˆá‰‹áˆá¢ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢";
                      
                      const updateSlotTimer = () => {
                           const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit(taskField);
                           if(checkAgain) {
                               window.startCooldownTimer(taskField, timerElementId, actionButtonId); // áˆ«áˆ±áŠ• á‹³áŒáˆ áŒ áˆ­á‰¶ á‹áŒáŒ á‹«á‹°áˆ­áŒ‹áˆ
                           } else if (timerEl) {
                               timerEl.innerText = `Reset in: ${formatTime(remainingAgain)}`;
                           }
                      };
                      updateSlotTimer(); 
                      timerIntervals[taskField] = setInterval(updateSlotTimer, 1000);
                      return; // áŠ¨ Slot Logic á‰ áŠ‹áˆ‹ áˆ˜á‹áŒ£á‰µ
                 } else {
                      // áŠ¥á‹¨á‰°áŒ«á‹ˆá‰° áŠ¨áˆ†áŠ
                      if (timerContainer) timerContainer.style.display = 'none';
                      // Slot Game á‹¨áˆ«áˆ± á‹¨áˆ†áŠ áŒŠá‹œ á‰†áŒ£áˆª áŠ á‹«áˆµáˆáˆáŒˆá‹áˆ
                      return;
                 }
             }
             
             // ğŸ›‘ áˆˆáˆáˆ‰áˆ áˆŒáˆá‰½ áŒ¨á‹‹á‰³á‹á‰½
             const updateTimer = () => {
                 const { isReady, remainingMs } = checkDailyLimit(taskField);
                 
                 if (isReady) {
                     if (timerEl) timerEl.innerText = "Ready to Play!";
                     if(actionButton) {
                         actionButton.classList.remove('cooldown');
                         actionButton.disabled = false;
                     }
                     if (taskField === 'last_invite_time') { 
                         const inviteButton = document.getElementById('invite-button');
                         if(inviteButton) inviteButton.classList.remove('cooldown');
                         if(inviteButton) inviteButton.disabled = false;
                     }
                     if (timerIntervals[taskField]) {
                         clearInterval(timerIntervals[taskField]);
                         delete timerIntervals[taskField];
                     }

                 } else {
                     if (timerEl) timerEl.innerText = `Remaining Cooldown: ${formatTime(remainingMs)}`;
                     
                     if(actionButton) {
                         actionButton.classList.add('cooldown');
                         actionButton.disabled = true;
                     }
                     if (taskField === 'last_invite_time') { 
                         const inviteButton = document.getElementById('invite-button');
                         if(inviteButton) inviteButton.classList.add('cooldown');
                         if(inviteButton) inviteButton.disabled = true;
                     }
                 }
             };
            
            updateTimer(); 
            timerIntervals[taskField] = setInterval(updateTimer, 1000);
        }
        
        function getTelegramUsername() {
            let username = 'á‰°áŒ«á‹‹á‰½-' + (telegramUserId ? telegramUserId.slice(-4) : Math.floor(Math.random() * 10000)); 
            if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
                const user = WebApp.initDataUnsafe.user;
                if (user.username) {
                    username = `@${user.username}`; 
                } else if (user.first_name) {
                    username = user.first_name;
                    if (user.last_name) {
                        username += ` ${user.last_name}`;
                    }
                }
            }
            return username;
        }


        // ======================================================================
        //                          FIREBASE FUNCTIONS
        // ======================================================================
        
        
        
        
        // ======================================================================
//                          FIREBASE FUNCTIONS
// ======================================================================

/**
 * âœ… áŠ á‹²áˆµ á‰°áŒá‰£áˆ­á¡ á‹¨áŠ áˆáŠ‘áŠ• á‰°áŒ á‰ƒáˆš áˆ˜áˆ¨áŒƒ á‰¥á‰» á‰ áŠ¥á‹áŠá‰°áŠ› áŒŠá‹œ á‹«á‹³áˆáŒ£áˆ (onSnapshot)
 * á‹­áˆ… á‰ Tasks/Profile áŒˆáŒ¾á‰½ áˆ‹á‹­ áŠáŒ¥á‰¦á‰½ á‹ˆá‹²á‹«á‹ áŠ¥áŠ•á‹²á‹˜áˆáŠ‘ á‹«á‹°áˆ­áŒ‹áˆá¢
 */
function setupCurrentUserListener(userId) {
    const userRef = doc(db, 'users', userId);
    
    onSnapshot(userRef, (doc) => {
        if (doc.exists()) {
            const data = doc.data();
            // Global á‰°áˆˆá‹‹á‹‹áŒ®á‰½áŠ• áˆ›á‹˜áˆ˜áŠ• (á‹­áˆ… áŠ®á‹µ áŠ¨á‹µáˆ®á‹ setupLeaderboardListener á‰°á‹ˆáˆµá‹·áˆ)
            currentScore = data.total_score || 0;
            currentSmartCoinBalance = data.smart_coin_balance || 0;
            currentTickets = data.tickets || 0;
            currentUserDocData = data;
            
            // á‹¨ Slot Game áˆáŠ”á‰³áŠ• áˆ›á‹˜áˆ˜áŠ•
            currentSpinsLeft = data.slot_spins_left !== undefined ? data.slot_spins_left : SLOTS_MAX_SPINS;

            // á‹°áˆ¨áŒƒá‹ áŠ¥áˆµáŠªáˆ˜áŒ£ á‹µáˆ¨áˆµ '...' á‰°á‰¥áˆ á‹­á‰€áˆ˜áŒ£áˆ
            if (currentRank === 'N/A' || currentRank === '0' || currentRank === '...') {
                currentRank = '...';
            }
            
            // ... (á‰  setupCurrentUserListener á‰°áŒá‰£áˆ­ á‹áˆµáŒ¥) ...
            
            // á‹°áˆ¨áŒƒá‹ áŠ¥áˆµáŠªáˆ˜áŒ£ á‹µáˆ¨áˆµ '...' á‰°á‰¥áˆ á‹­á‰€áˆ˜áŒ£áˆ
            if (currentRank === 'N/A' || currentRank === '0' || currentRank === '...') {
                currentRank = '...';
            }
            
            // âœ… NEW FIX: á‹¨ Top áŒˆáŒ½ áˆ‹á‹­ á‹«áˆˆá‹áŠ• á‹¨áŒáˆ áŠáŒ¥á‰¥ áˆ›á‹˜áˆ˜áŠ•
            const topScoreDisplay = document.getElementById('top-score-display');
            if (topScoreDisplay) {
                topScoreDisplay.innerText = `${currentScore.toLocaleString()} ğŸ’°`;
            }

            renderPageContent();
// ...
    // 3. âœ… FIX: á‹¨ Exchange áŒˆáŒ½áŠ• á‰£áˆ‹áŠ•áˆµ áˆ›á‹˜áˆ˜áŠ•
    const exchangeBalanceElement = document.getElementById('currentCoinBalance');
    if (exchangeBalanceElement) {
        exchangeBalanceElement.innerText = currentScore.toLocaleString();
    }

            
            renderPageContent();

            // Loading Screen áˆ˜á‹°á‰ á‰…
            const loadingContainer = document.getElementById('loading-container');
            if (loadingContainer.style.display !== 'none') {
                 loadingContainer.style.opacity = '0';
                setTimeout(() => {
                    loadingContainer.style.display = 'none';
                }, 500); 
            }
            
        } else {
            console.warn("á‹¨áŠ áˆáŠ‘ á‰°áŒ á‰ƒáˆš áˆ˜áˆ¨áŒƒ (document) áŠ áˆá‰°áŒˆáŠ˜áˆ!");
        }
    }, (error) => {
        console.error("Error listening to user document:", error);
        WebApp.showAlert("Error: Could not load your profile.");
    });
}



        
        
        async function firebaseLogin() {
            try {
                const userCredential = await signInAnonymously(auth);
                currentFirebaseUserId = userCredential.user.uid;
                
                            telegramUserId = window.telegramUserId; // áŠ áˆµá‰€á‹µáˆ á‹¨á‰°áŒ«áŠá‹áŠ• 'window.telegramUserId' áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•

                const userRef = doc(db, 'users', currentFirebaseUserId);
                const userDoc = await getDoc(userRef); // áˆ°áŠá‹± áˆ˜áŠ–áˆ©áŠ• áŠ áˆµá‰€á‹µáˆ áˆ˜áˆá‰°áˆ½

                const username = getTelegramUsername();
                const photo_url = WebApp.initDataUnsafe.user?.photo_url || null;
                
                let referrerId = null;
                if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.start_param) {
                    referrerId = WebApp.initDataUnsafe.start_param;
                    if (referrerId === telegramUserId) {
                        referrerId = null; 
                    }
                }
                
                if (!userDoc.exists()) {
                    // áŠ á‹²áˆµ á‰°áŒ á‰ƒáˆš áŠ¨áˆ†áŠ:
                    await setDoc(userRef, {
                        telegram_id: telegramUserId,
                        username: username, 
                        photo_url: photo_url,
                        created_at: serverTimestamp(),
                        tickets: 0, 
                        total_score: 0, 
                        referrer_id: referrerId || null, // áŠ á‹²áˆµ áŠ¨áˆ†áŠ referral ID áˆ›áˆµá‰€áˆ˜áŒ¥
                        // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ áˆ˜áˆ¨áŒƒá‹á‰½
                        daily_streak: 0,
                        last_streak_claim_time: null,
                        // ğŸ›‘ UPDATED: áˆˆ Slot Game á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ áˆ˜áˆ¨áŒƒá‹á‰½
                        slot_spins_left: SLOTS_MAX_SPINS,
                        last_slot_reset_time: null, // <--- âœ… áŠ®áˆ› (,) áŠ¥á‹šáˆ… á‰°áŒ¨áˆáˆ¯áˆ
                        
                        // âœ… ğŸ›‘ áŠ á‹²áˆµ á‹¨ Staking áˆ˜áˆµáŠ®á‰½
                        staked_amount: 0,
                        stake_start_time: null
                    });
                } else {
                    // áŠá‰£áˆ­ á‰°áŒ á‰ƒáˆš áŠ¨áˆ†áŠ:
                    await setDoc(userRef, {
                        telegram_id: telegramUserId,
                        username: username, 
                        photo_url: photo_url,
                        // referrer_id, created_at, total_score, daily_streak áŠ á‹­áˆ»áˆ»áˆ‰áˆ
                    }, { merge: true });
                }

            } catch (error) {
                WebApp.showAlert("Firebase Login Failed: " + error.message);
                console.error("Firebase Login Failed:", error);
            }
        }



        async function updateScore(coinsToAdd, source, timestampField = null, extraUpdateData = {}) { 
            if (!currentFirebaseUserId) {
                WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆ˜á‰°áŒá‰ áˆªá‹«á‹ áŠ¥áˆµáŠªáŒ«áŠ• á‹­áŒ á‰¥á‰ (Login Failed).");
                return false;
            }
            
            const userRef = doc(db, "users", currentFirebaseUserId); 
            
            const updateData = {
                total_score: increment(coinsToAdd), 
                last_played: serverTimestamp(), 
                last_reward_source: source,
                ...extraUpdateData // áŠ¨á‹áŒ­ á‹¨áˆ˜áŒ¡ á‰°áŒ¨áˆ›áˆª áˆ›áˆ»áˆ»á‹«á‹á‰½
            };

            if (timestampField) {
                // áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹µ áŒŠá‹œ á‰¥á‰» á‹¨áˆšáˆ°áˆ© á‰ áˆ˜áˆ†áŠ“á‰¸á‹:
                 if (timestampField.startsWith('last_social_')) {
                    // áˆ°á‹“á‰±áŠ• áŠ«áˆµá‰€áˆ˜áŒ¥áŠ• á‰ áŠ‹áˆ‹ á‹³áŒáˆ áŠ á‹­áˆ°áˆ«áˆ
                    updateData[timestampField] = serverTimestamp(); 
                 } else {
                    // áˆˆá‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ (Daily Tasks) á‹¨áŒŠá‹œ áˆ›áˆ…á‰°áˆ áˆ›áˆµá‰€áˆ˜áŒ¥
                    updateData[timestampField] = serverTimestamp();
                 }
            }
            
            try {
                await updateDoc(userRef, updateData); 
                // ğŸ›‘ áŠáŒ¥á‰¡ á‹œáˆ® á‹ˆá‹­áˆ áŠ áˆ‰á‰³á‹Š áŠ¨áˆ†áŠ áˆ›áŠ•á‰‚á‹« áˆ›áˆ³á‹¨á‰µ á‹¨áˆˆá‰¥áŠ•áˆ
                if(coinsToAdd > 0) WebApp.showAlert(`ğŸ‰ ${coinsToAdd.toLocaleString()} coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ¨áˆ˜áˆ¨!`); 
                // ğŸ›‘ UPDATED: áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜á‰°áŠ®áˆµ
                window.triggerConfetti(coinsToAdd); 
                return true;

            } catch (error) {
                if (error.code === 'not-found' || error.message.includes('No document to update')) {
                    const username = getTelegramUsername();
                    const photo_url = WebApp.initDataUnsafe.user?.photo_url || null;
                    
                    const setData = {
                        total_score: coinsToAdd, 
                        username: username,
                        telegram_id: telegramUserId,
                        photo_url: photo_url,
                        last_played: serverTimestamp(), 
                        last_reward_source: source,
                        created_at: serverTimestamp(),
                        tickets: 0, 
                        daily_streak: 0, // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ
                        last_streak_claim_time: null, // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ
                        slot_spins_left: SLOTS_MAX_SPINS, // ğŸ›‘ NEW: áˆˆ Slot Game
                        last_slot_reset_time: null, // ğŸ›‘ NEW: áˆˆ Slot Game
                        // referrer_id áŠ á‹­áŠ«á‰°á‰µáˆ - á‰ áˆ˜áŒ€áˆ˜áˆªá‹«á‹ firebaseLogin á‹áˆµáŒ¥ á‰¥á‰» áˆµáˆˆáˆšáˆ˜á‹˜áŒˆá‰ á‹
                        smart_coin_balance: 0, // <--- âœ… áŠ®áˆ› (,) áŠ¥á‹šáˆ… á‰°áŒ¨áˆáˆ¯áˆ
                       
                        // âœ… ğŸ›‘ áŠ á‹²áˆµ á‹¨ Staking áˆ˜áˆµáŠ®á‰½ áŠ¥á‹šáˆ…áˆ áˆ˜áŒá‰£á‰µ áŠ áˆˆá‰£á‰¸á‹
                        staked_amount: 0,
                        stake_start_time: null
                    };

                    if (timestampField) {
                         if (timestampField.startsWith('last_social_')) {
                            setData[timestampField] = serverTimestamp(); 
                        } else {
                            setData[timestampField] = serverTimestamp();
                        }
                    }

                    await setDoc(userRef, setData);
                    if(coinsToAdd > 0) WebApp.showAlert(`ğŸ‰ áŠ á‹²áˆµ áˆ˜áˆ¨áŒƒ á‰°áˆáŒ áˆ¨ áŠ¥áŠ“ ${coinsToAdd.toLocaleString()} coin á‰°áŒ¨áˆ˜áˆ¨!`); // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin
                    // ğŸ›‘ UPDATED: áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜á‰°áŠ®áˆµ
                    window.triggerConfetti(coinsToAdd); 
                    return true;
                } else {
                    WebApp.showAlert("âŒ coin á‰ áˆ›á‹˜áˆ˜áŠ• áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨: " + error.message); // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin
                    console.error("Error updating score:", error);
                    return false;
                }
            }
        }

// âœ… áŠ á‹²áˆµ: áˆˆáˆ˜áˆªá‹á‰½ áˆ°áˆŒá‹³ áˆ˜áˆ¨áŒƒ áˆ›áˆµá‰€áˆ˜áŒ« á‰áˆá
const LEADERBOARD_STORAGE_KEY = 'smart_drop_leaderboard_cache';

/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ fetchLeaderboard: localStorage Caching á‹­áŒ á‰€áˆ›áˆ
 * á‹­áˆ… á‹˜á‹´ á‹ˆáŒªáŠ• (Cost) áŠ¥áŠ“ á‹¨á‹³á‰³ áŠ áŒ á‰ƒá‰€áˆáŠ• á‰ áŠ¥áŒ…áŒ‰ á‹­á‰€áŠ•áˆ³áˆá¢
 */
async function fetchLeaderboard() {
    console.log("DEBUG: fetchLeaderboard á‰°áŒá‰£áˆ­ á‰°áŒ€áˆáˆ¯áˆá¢");
    const leaderboardContainer = document.getElementById('leaderboard-container');
    
    // áˆ˜áŒ«áŠ‘áŠ• áˆˆáˆ›áˆ³á‹¨á‰µ (áŠ¨á‹šáˆ… á‰ áŠá‰µ á‹³á‰³ áŠ¨áˆŒáˆˆ á‰¥á‰»)
    if (!leaderboardContainer.innerHTML.includes('leaderboard-item')) {
        leaderboardContainer.innerHTML = '<p style="text-align: center; color: var(--tg-hint); padding: 10px;">áŠ¥á‰£áŠ­á‹áŠ• á‰µáŠ•áˆ½ á‹­áŒ á‰¥á‰...</p>';
    }

    const now = Date.now();

    // ============================================================
    // 1. áˆ˜áŒ€áˆ˜áˆªá‹« áŠ¨ localStorage áˆ˜áˆ¨áŒƒ áŠ«áˆˆ áŠ¥áŠ•áˆá‰µáˆ½ (CACHE CHECK)
    // ============================================================
    const cachedDataString = localStorage.getItem(LEADERBOARD_STORAGE_KEY);
    
    if (cachedDataString) {
        try {
            const cachedObj = JSON.parse(cachedDataString);
            // áˆ˜áˆ¨áŒƒá‹ áŠ«áˆˆ áŠ¥áŠ“ áŠ¨ 3 á‹°á‰‚á‰ƒ (CACHE_LIFETIME) á‰ á‰³á‰½ áŠ¨áˆ†áŠ
            if (now - cachedObj.timestamp < CACHE_LIFETIME) {
                console.log("DEBUG: áˆ˜áˆ¨áŒƒ áŠ¨ localStorage (Cache) áŠ¥á‹¨á‰°áŒ«áŠ áŠá‹á¢ (Firebase áŠ á‹­áŠá‰ á‰¥áˆ)");
                
                // á‰  Cache á‹áˆµáŒ¥ á‹«áˆˆá‹áŠ• á‹¨áˆ«áˆ±áŠ• á‹°áˆ¨áŒƒ (Rank) áŠ áˆáŠ• áŠ«áˆˆá‹ User ID áŒ‹áˆ­ áŠ¥áŠ“áˆµá‰°áŠ«áŠ­áˆ
                // (áˆáŠ“áˆá‰£á‰µ á‰°áŒ á‰ƒáˆšá‹ áŠ áŠ«á‹áŠ•á‰µ á‰€á‹­áˆ® áŠ¨áˆ†áŠ)
                const currentUserEntry = cachedObj.data.players.find(p => p.id === currentFirebaseUserId);
                cachedObj.data.foundUserRank = currentUserEntry ? currentUserEntry.rank : 0;

                renderLeaderboard(cachedObj.data);
                return; // ğŸ›‘ áŠ¨ Firebase áˆ³áŠ•áŒ á‹­á‰… áŠ¥á‹šáˆ áŠ¥áŠ“á‰†áˆ›áˆˆáŠ• (Cost Saved!)
            }
        } catch (e) {
            console.warn("Cache parsing error, fetching fresh data.");
            // áˆµáˆ…á‰°á‰µ áŠ«áˆˆ á‰½áŒáˆ­ á‹¨áˆˆá‹áˆá£ áŠ¨á‰³á‰½ áŠ á‹²áˆµ áŠ¥áŠ“á‹ˆáˆ­á‹³áˆˆáŠ•
        }
    }

    // ============================================================
    // 2. Cache áŠ¨áˆŒáˆˆ á‹ˆá‹­áˆ áŒŠá‹œá‹ áŠ«áˆˆáˆá‰ á‰µá£ áŠ¨ Firebase áŠ¥áŠ•áŒ á‹­á‰…
    // ============================================================
    try {
        console.log("DEBUG: áŠ á‹²áˆµ áˆ˜áˆ¨áŒƒ áŠ¨ Firebase áŠ¥á‹¨á‰°áˆ³á‰  áŠá‹á¢");
        
        const usersCollectionRef = collection(db, "users");
        // Top 100 á‰°áŒ á‰ƒáˆšá‹á‰½áŠ• á‰ áŠáŒ¥á‰¥ á‰¥á‹›á‰µ (descending) áŠ áˆáŒ£
        const q = query(usersCollectionRef, orderBy('total_score', 'desc'), limit(100)); 
        
        const snapshot = await getDocs(q); 
        
        let players = [];
        let foundUserRank = 0; 
        let rankCounter = 0;
        
        snapshot.forEach((doc) => {
            rankCounter++;
            const data = doc.data();
            const rank = rankCounter;
            
            // áˆ˜áˆ¨áŒƒá‹áŠ• á‹ˆá‹° array áŠ¥áŠ•áŒ¨áˆáˆ­
            players.push({ id: doc.id, ...data, rank: rank });

            // á‹¨áŠ áˆáŠ‘áŠ• á‰°áŒ á‰ƒáˆš á‹°áˆ¨áŒƒ áŠ¥áŠ•áˆáˆáŒ
            if (doc.id === currentFirebaseUserId) {
                foundUserRank = rank; 
            }
        });
        
        const leaderboardData = { players, foundUserRank };

        // ============================================================
        // 3. áŠ á‹²áˆ±áŠ• áˆ˜áˆ¨áŒƒ á‹ˆá‹° localStorage áŠ¥áŠ“áˆµá‰€áˆáŒ¥ (SAVE CACHE)
        // ============================================================
        try {
            localStorage.setItem(LEADERBOARD_STORAGE_KEY, JSON.stringify({
                data: leaderboardData,
                timestamp: now
            }));
        } catch (e) {
            console.warn("localStorage is full or disabled", e);
        }

        // áˆ˜áˆ¨áŒƒá‹áŠ• á‹ˆá‹° UI áˆ˜áˆ‹áŠ­
        renderLeaderboard(leaderboardData);
        
        console.log("DEBUG: fetchLeaderboard á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ áŠ“á‰€á‰€ (Updated Cache).");

    } catch (error) {
        leaderboardContainer.innerHTML = `<p style="text-align: center; color: var(--et-red); padding: 10px;">ğŸ›‘ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨! ${error.message}</p>`;
        console.error("CRITICAL ERROR in fetchLeaderboard:", error);
        WebApp.showAlert("ğŸ›‘ áˆµáˆ…á‰°á‰µ: LeaderboardáŠ• áˆ›áˆáŒ£á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢");
    }
}


/**
 * LeaderboardáŠ• áˆ˜áˆ¨áŒƒá‹áŠ• á‰°á‰€á‰¥áˆ á‹ˆá‹° HTML á‹¨áˆšá‰€á‹­áˆ­ á‰°áŒá‰£áˆ­ (áŠ¨ fetchLeaderboard á‹ˆáŒ¥á‰·áˆ)
 */
function renderLeaderboard(data) {
    const { players, foundUserRank } = data;
    const leaderboardContainer = document.getElementById('leaderboard-container');
    
    // á‹¨á‹°áˆ¨áŒƒ áŠ áˆ˜áŠ­áŠ•á‹® (Rank Logic)
    if (foundUserRank > 0) {
        currentRank = `#${foundUserRank}`;
    } else {
        currentRank = 'Top 100+'; 
    }
    
    // UI áˆ›áˆ»áˆ»á‹« (Rank Update)
    const rankDisplayEl = document.getElementById('top-rank-display');
    if(rankDisplayEl) {
         rankDisplayEl.innerText = currentRank;
    }

    // Leaderboard HTML áˆ˜áŒˆáŠ•á‰£á‰µ áŠ¥áŠ“ áˆ›áˆ³á‹¨á‰µ
    let leaderboardHTML = `<div id="leaderboard-list">`;
    
    if (players.length === 0) {
         leaderboardHTML += '<p style="text-align: center; color: var(--tg-hint); padding: 10px;">áˆáŠ•áˆ á‰°áŒ«á‹‹á‰½ á‹¨áˆˆáˆá¢</p>';
    } else {
         players.forEach((player) => {
             const isCurrentUser = player.id === currentFirebaseUserId;
             const avatarHtml = getAvatarHtml(player.username, player.photo_url); 
             let rankClass = '';
             let rankDisplay; 
             const rankNumber = Number(player.rank); 
              
             if (isNaN(rankNumber) || rankNumber < 1) {
                 rankDisplay = '#?';
                 rankClass = '';
             } else if (rankNumber === 1) {
                 rankClass = 'gold-highlight';
                 rankDisplay = 'ğŸ¥‡'; 
             } else if (rankNumber === 2) {
                 rankClass = 'silver-highlight';
                 rankDisplay = 'ğŸ¥ˆ'; 
             } else if (rankNumber === 3) {
                 rankClass = 'bronze-highlight';
                 rankDisplay = 'ğŸ¥‰'; 
             } else {
                 rankDisplay = rankNumber.toString() + '.'; 
                 rankClass = ''; 
             }
              
             const itemClasses = `${isCurrentUser ? 'current-user-highlight' : ''} ${rankClass}`;
             const rankHtmlClass = (rankNumber === 1) ? 'gold' : (rankNumber === 2) ? 'silver' : (rankNumber === 3) ? 'bronze' : '';


            leaderboardHTML += `
                <div class="leaderboard-item ${itemClasses}">
                    <span class="leaderboard-item-rank ${rankHtmlClass}">
                        ${rankDisplay} 
                    </span> 
                    <div class="leaderboard-item-photo">${avatarHtml}</div> 
                    <span class="leaderboard-item-name">${player.username || 'á‹«áˆá‰³á‹ˆá‰€ á‰°áŒ«á‹‹á‰½'}</span>
                    <span class="leaderboard-item-score">${(player.total_score || 0).toLocaleString()} ğŸ’°</span>
                </div>
            `;
         });
    }
      
    leaderboardHTML += `</div>`;
    leaderboardContainer.innerHTML = leaderboardHTML;
}




// ======================================================================
// âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: áˆˆáŒ¨á‹‹á‰³ áŒˆáŒ¾á‰½ (á‰€áˆ‹áˆ) Loading Screen á‰°áŒá‰£áˆ­
// ======================================================================

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ áŠ á‹²áˆ±áŠ• "á‰€áˆ‹áˆ" áˆá‹°áˆ­ á‹«áˆ³á‹«áˆ
 */
window.showGameWithLoading = (pageId) => {
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: áŠ á‹²áˆ±áŠ• 'game-loading-overlay' áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•
    const loadingContainer = document.getElementById('game-loading-overlay'); 

    if (!loadingContainer) {
        switchPage(pageId);
        return;
    }

    // 1. Loading áˆµáŠ­áˆªáŠ‘áŠ• áŠ áˆ³á‹­
    loadingContainer.style.display = 'flex';
    // (á‰µáŠ•áˆ½ áŠ­áá‰°á‰µ áŠ¥áŠ•áˆ°áŒ£áˆˆáŠ• opacity áŠ¥áŠ•á‹²áˆ°áˆ«)
    setTimeout(() => {
        loadingContainer.style.opacity = '1';
    }, 10); 

    // 2. á‹¨áŒˆáŒ½ áˆ˜á‰€á‹¨áˆªá‹«á‹ áŠ¥áŠ•á‹²áˆ°áˆ« áŠ¥áŠ“ UI áŠ¥áŠ•á‹²á‹«áˆ­á á‰µáŠ•áˆ½ áŒŠá‹œ áˆµáŒ á‹
    setTimeout(() => {

        // 3. á‹‹áŠ“á‹áŠ• á‹¨áŒˆáŒ½ áˆ˜á‰€á‹¨áˆªá‹« á‰°áŒá‰£áˆ­ áŒ¥áˆ«
        switchPage(pageId);

        // 4. á‹¨áŒ¨á‹‹á‰³á‹ áŒˆáŒ½ áŠ¨á‰³á‹¨ á‰ áŠ‹áˆ‹ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹°á‰¥á‰…
        // âœ… áˆˆá‹áŒ¥: áŠ¨ 100 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹ˆá‹° 2000 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ (2 áˆ°áŠ¨áŠ•á‹µ) á‰°á‰€á‹­áˆ¯áˆ
        setTimeout(() => { 
            loadingContainer.style.opacity = '0';
            // á‹¨ CSS transition (0.3s) áŠ¥áŠ•á‹²á‹«áˆá‰… áŒ á‰¥á‰…
            setTimeout(() => {
                loadingContainer.style.display = 'none';
            }, 300); 
        }, 2000); // ğŸ›‘ áŠ áˆáŠ• 2000ms (2 áˆ°áŠ¨áŠ•á‹µ) á‹­á‰†á‹«áˆ

    }, 100); // áˆá‹°áˆ© áŠ¥áŠ•á‹²á‰³á‹­ 100ms áŠ¥áŠ•áˆ°áŒ£áˆˆáŠ•
}

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ áˆˆ Daily Streak (Modal) á‹«áŒˆáˆˆáŒáˆ‹áˆ
 */
window.showStreakWithLoading = () => {
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: áŠ á‹²áˆ±áŠ• 'game-loading-overlay' áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•
    const loadingContainer = document.getElementById('game-loading-overlay'); 

    if (!loadingContainer) {
        window.openDailyRewardModal(); // Fallback
        return;
    }

    // 1. Loading áˆµáŠ­áˆªáŠ‘áŠ• áŠ áˆ³á‹­
    loadingContainer.style.display = 'flex';
    setTimeout(() => {
        loadingContainer.style.opacity = '1';
    }, 10);

    setTimeout(() => {
        // 2. áˆá‹³áˆ‰áŠ• á‹¨áˆšáŠ¨áá‰°á‹áŠ• á‹‹áŠ“ á‰°áŒá‰£áˆ­ áŒ¥áˆ«
        window.openDailyRewardModal();

        // 3. áˆá‹³áˆ‰ áˆáŒ£áŠ• áˆµáˆˆáˆ†áŠ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹ˆá‹²á‹«á‹ á‹°á‰¥á‰…
        // âœ… áˆˆá‹áŒ¥: áŠ¨ 100 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹ˆá‹° 2000 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ (2 áˆ°áŠ¨áŠ•á‹µ) á‰°á‰€á‹­áˆ¯áˆ
        setTimeout(() => { 
            loadingContainer.style.opacity = '0';
            setTimeout(() => {
                loadingContainer.style.display = 'none';
            }, 300); // á‹¨ CSS transition áŒŠá‹œ
        }, 2000); // ğŸ›‘ áŠ áˆáŠ• 2000ms (2 áˆ°áŠ¨áŠ•á‹µ) á‹­á‰†á‹«áˆ
    }, 100);
}








// ======================================================================
//                          PAGE NAVIGATION FUNCTIONS
// ======================================================================

        window.switchPage = (pageIdToShow) => {
            // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' áŠ¥á‹šáˆ… á‰ á‹‹áŠ“ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‰°áŒ¨áˆáˆ¯áˆ
            const mainPages = ['tasks-page', 'top-page', 'profile-page', 'staking-page'];
            const gamePages = [
                'mystery-box-page',
                'daily-spin-page',
                'reflex-game-page',
                'withdraw-page',
                'exchange-page',
                'social-tasks-page',
                'slots-game-page',
                'scratch-card-page',
                'keno-game-page',
                'daily-cipher-page', 
                'memory-game-page',  
                'transaction-history-page'
                // 'staking-page' áŠ¨á‹šáˆ… á‰°á‹ˆáŒá‹·áˆ
            ];
            const allPages = [...mainPages, ...gamePages];
            
            allPages.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            const targetPage = document.getElementById(pageIdToShow);
            if (targetPage) {
                targetPage.style.display = 'block';
            }

            mainPages.forEach(id => {
                let navId = id.split('-')[0];
                // 'staking-page' á‹¨ nav-stake ID áˆµáˆ‹áˆˆá‹
                if (id === 'staking-page') navId = 'stake'; 
                
                const navItem = document.getElementById(`nav-${navId}`);
                if (navItem) {
                    navItem.classList.remove('active');
                }
            });
            
            if (mainPages.includes(pageIdToShow)) {
                // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' á‹¨ nav-stake ID áˆµáˆ‹áˆˆá‹
                let navId = pageIdToShow.split('-')[0];
                if (pageIdToShow === 'staking-page') navId = 'stake'; 
                
                const navItem = document.getElementById(`nav-${navId}`);
                if (navItem) {
                    navItem.classList.add('active');
                }
                 // á‰ á‹‹áŠ“ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‹¨áŠ‹áˆ‹ á‰áˆá áŠ á•áˆŠáŠ¬áˆ½áŠ‘áŠ• áŠ¥áŠ•á‹²á‹˜áŒ‹ á‹«á‹°áˆ­áŒ‹áˆ
                 WebApp.BackButton.hide();
                 WebApp.BackButton.onClick(() => WebApp.close()); 

            } else {
                // á‰ áŠ•áŠ¡áˆµ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‹¨áŠ‹áˆ‹ á‰áˆá á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‹­áˆ˜áˆáˆ³áˆ
                WebApp.BackButton.show();
                WebApp.BackButton.onClick(window.showMainPage);
            }
            
            if (pageIdToShow === 'tasks-page') {
                 // ğŸ›‘ NEW: á‹¨áˆ˜áŒ‹á‰ á‹£ á‰áˆá á‰†áŒ£áˆªáŠ• áˆ›áˆµáŒ€áˆ˜áˆ­
                 startCooldownTimer('last_invite_time', null, 'invite-button'); 
                
                // á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›á‹˜áˆ˜áŠ•
                updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
                updateTaskCardStatus('memory-game-card', 'memory-game-badge', 'last_memory_game_time'); 
                // á‹¨áŠ«áˆ­á‹µ á‰£áŒ†á‰½áŠ• á‰ á‹¨áŒŠá‹œá‹ áŠ¥áŠ•á‹²á‹«á‹˜áˆáŠ• áˆ›á‹µáˆ¨áŒ
                if (!timerIntervals['card_status_update']) {
                    timerIntervals['card_status_update'] = setInterval(() => {
                        updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                        updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                        updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                        updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
                        updateTaskCardStatus('memory-game-card', 'memory-game-badge', 'last_memory_game_time'); 

                    }, 5000); 
                }

            } else {
                 // á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›áˆ»áˆ»á‹«á‹áŠ• áŠ á‰áˆ
                if (timerIntervals['card_status_update']) {
                    clearInterval(timerIntervals['card_status_update']);
                    delete timerIntervals['card_status_update'];
                }

                // ----------------------------------------------------
                // --- âœ… áŠ á‹²áˆ± á‰µáŠ­áŠ­áˆˆáŠ› á‹¨ 'else' á‰¥áˆáŠ­ á‹­áˆ„ áŠá‹ ---
                // ----------------------------------------------------
                if (pageIdToShow === 'top-page') { 
                    fetchLeaderboard(); 
                
                // âœ… ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' áŠ¥á‹šáˆ… áŒˆá‰¥á‰·áˆ (áŠ¨ 'mainPages' áŒ‹áˆ­)
                } else if (pageIdToShow === 'staking-page') {
                    window.initStakingPage();

                } else if (pageIdToShow === 'mystery-box-page') { 
                    startCooldownTimer('last_mystery_time', 'mystery-box-timer', 'mystery-box-action');
                    window.resetMysteryBox(false);
                } else if (pageIdToShow === 'daily-spin-page') {
                    startCooldownTimer('last_spin_time', 'daily-spin-timer', 'daily-spin-action');
                } else if (pageIdToShow === 'reflex-game-page') {
                    startCooldownTimer('last_reflex_time', 'reflex-game-timer', 'reflex-game-action');
                    window.resetReflexGame(false); 
                    isReflexGameRunning = false; 
                    window.document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;
                } else if (pageIdToShow === 'social-tasks-page') {
                    updateSocialTaskStatus('channel-action', 'https://t.me/Smart_Airdropss', 1500, 'last_social_tg_channel_time', 'join');
                    updateSocialTaskStatus('group-action', 'https://t.me/school_library2012', 1000, 'last_social_tg_group_time', 'join');
                    updateSocialTaskStatus('youtube-action', 'https://www.youtube.com/', 3000, 'last_social_youtube_time', 'subscribe');
                } else if (pageIdToShow === 'exchange-page') {
                    const pointsInput = document.getElementById('exchangePointsInput');
                    if (pointsInput) pointsInput.value = EXCHANGE_RATE.toString(); // á‹ˆá‹° 10,000 á‹­áˆ˜áˆáˆ°á‹‹áˆ
                    const coinBalanceEl = document.getElementById('currentCoinBalance');
                    if (coinBalanceEl) {
                        coinBalanceEl.innerText = currentScore.toLocaleString();
                    }
                    window.calculateSmartCoin(); // áŠ á‹áˆ«áˆ©áŠ• áŠ¥áŠ“ á‹áŒ¤á‰±áŠ• á‹«áˆ°áˆ‹áˆ
                } else if (pageIdToShow === 'withdraw-page') {
                    document.getElementById('currentWithdrawBalance').innerText = currentSmartCoinBalance.toLocaleString();
                    document.querySelectorAll('#withdraw-page .method-wrapper').forEach(wrapper => {
                        wrapper.classList.remove('active');
                    });
                    selectedWithdrawMethod = null;
                    document.getElementById('withdrawAmountInput').value = MIN_WITHDRAWAL;
                    const messageEl = document.getElementById('withdrawMessage');
                    if (messageEl) messageEl.innerText = "âš ï¸ áŠ¥á‰£áŠ­á‹ á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡á¢";
                    if (messageEl) messageEl.style.color = 'var(--et-red, #F44336)';
                    const buttonEl = document.getElementById('finalWithdrawButton');
                    if (buttonEl) {
                        buttonEl.classList.add('disabled-btn');
                        buttonEl.disabled = true;
                        buttonEl.innerText = "WITHDRAW NOW";
                    }
                    window.validateWithdrawal();
                
                } else if (pageIdToShow === 'slots-game-page') {
                     window.updateSlotGameUI();
                     startCooldownTimer(SLOTS_COOLDOWN_FIELD, 'reset-timer', 'spin-btn');
                
            } else if (pageIdToShow === 'scratch-card-page') { 
    window.initScratchCard(false); 
                
} else if (pageIdToShow === 'keno-game-page') { 
    window.initKenoGame();
        
} else if (pageIdToShow === 'daily-cipher-page') {
    setTimeout(() => { 
        window.startCooldownTimer('last_daily_cipher_time', 'daily-cipher-timer', 'cipher-submit-btn');
    }, 100); 

} else if (pageIdToShow === 'memory-game-page') {
    setTimeout(() => { 
        window.startCooldownTimer('last_memory_game_time', 'memory-game-timer-display', 'memory-start-btn');            
    }, 100); 
}
        
     

    renderPageContent(); 

}
                
        } // <-- á‹­áˆ„ 'window.switchPage'áŠ• á‹­á‹˜áŒ‹áˆ

        // âœ…âœ…âœ… === á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (áˆµáˆ…á‰°á‰µ 2) === âœ…âœ…âœ…
        // ğŸ›‘ á‹¨á‰°áˆ³áˆ³á‰°á‹ 'renderPageContent();' áŠ¨á‹šáˆ… á‰°á‹ˆáŒá‹·áˆ
        

        // ğŸ›‘ showMainPage() á‹ˆá‹° áˆµáŠ­áˆªá•á‰µ áˆ˜áŒ€áˆ˜áˆªá‹« (áŠ¨ module á‹áŒª) á‰°áŠ•á‰€áˆ³á‰…áˆ·áˆ

        window.handleCardClick = (pageId) => {
            switchPage(pageId);
        }

        window.handleTaskClick = async (taskName, coins, timestampField) => { // ğŸ›‘ points á‹ˆá‹° coins
            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                WebApp.showAlert(`âŒ ${taskName} áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢ áŠ¥á‰£áŠ­á‹ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢`);
                return;
            }
            await updateScore(coins, taskName, timestampField); // ğŸ›‘ points á‹ˆá‹° coins
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }
// ğŸ›‘ áŠ á‹²áˆ± áŠ¥áŠ“ á‹°áˆ…áŠ•áŠá‰± á‹¨á‰°áŒ á‰ á‰€ handleSocialTaskClick (Timer Logic á‹«áˆˆá‹)
window.handleSocialTaskClick = async (button, actionType) => {
    const link = button.getAttribute('data-link');
    const coins = parseInt(button.getAttribute('data-points')); 
    const field = button.getAttribute('data-field');
    const taskName = button.getAttribute('data-name');
    
    // 1. á‹¨áˆ™áˆŒá‰µ áá‰°áˆ»
    const { hasCompleted } = checkDailyLimit(field);

    if (hasCompleted) {
        WebApp.showAlert(`âœ… á‹­áˆ…áŠ• á‰°áŒá‰£áˆ­ (${taskName}) áŠ áˆµá‰€á‹µáˆ˜á‹ áŠ áŒ áŠ“á‰€á‹‹áˆá¢`);
        return;
    }

    // 2. áˆ½áˆáˆ›á‰µ áˆˆáˆ˜áŒ á‹¨á‰… á‹áŒáŒ áŠ¨áˆ†áŠ
    if (button.getAttribute('data-state') === 'ready-to-claim') {
        button.innerText = 'Claiming...';
        button.disabled = true;

        if (await updateScore(coins, taskName, field)) {
            // á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ¨á‰°áˆ°áŒ  á‰ áŠ‹áˆ‹ áˆáŠ”á‰³á‹áŠ• áˆ˜á‰€á‹¨áˆ­
            button.innerText = `Completed âœ…`;
            button.classList.remove('join-style');
            button.classList.add('completed-style');
            button.onclick = null;
            button.disabled = true;
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        } else {
            // áŠ«áˆá‰°áˆ³áŠ« á‹ˆá‹° áˆ˜áŒ€áˆ˜áˆªá‹«á‹ áˆáŠ”á‰³ áˆ˜áˆ˜áˆˆáˆµ
            WebApp.showAlert(`âŒ á‹¨á‹³á‰³á‰¤á‹ áˆµáˆ…á‰°á‰µ! áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢`);
            button.innerText = `Claim Reward`; 
            button.disabled = false;
        }
        return;
    }

    // 3. á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« áŠ­áˆŠáŠ­ (Timer á‹­áŒ€áˆáˆ«áˆ)
    if (button.innerText.includes('Join') || button.innerText.includes('Subscribe') || button.innerText.includes('Claim')) {
        
        // 3a. áˆŠáŠ•áŠ©áŠ• á‹­áŠ­áˆá‰µ
        if (link.includes('t.me/')) {
             WebApp.openTelegramLink(link);
        } else {
             WebApp.openLink(link);
        }
        
        // 3b. á‰†áŒ£áˆªá‹áŠ• á‹­áŒ€áˆáˆ«áˆ (Anti-Cheating)
        const actionText = actionType === 'subscribe' ? 'Subscribed' : 'Joined';
        button.disabled = true;
        button.onclick = null; // á‹¨á‹µáŒ‹áˆš áŠ­áˆŠáŠ­ á‹­á‹˜áŒ‹áˆ

        let timeLeft = 15; // 15 áˆ°áŠ¨áŠ•á‹µ
        
        const countdown = setInterval(() => {
            timeLeft--;
            button.innerText = `Checking... (${timeLeft}s)`;
            
            if (timeLeft <= 0) {
                clearInterval(countdown);
                
                // áŒŠá‹œá‹ áˆ²á‹«áˆá‰… áŠ á‹áˆ«áˆ©áŠ• áˆˆáˆ˜áŒ á‹¨á‰… á‹áŒáŒ áˆ›á‹µáˆ¨áŒ
                button.innerText = `Claim Reward`;
                button.disabled = false;
                button.setAttribute('data-state', 'ready-to-claim'); // áŠ á‹²áˆµ áˆáŠ”á‰³
                
                // áˆˆá‹µáŒ‹áˆš áŠ­áˆŠáŠ­ áˆ«áˆ±áŠ• áŠ¥áŠ•á‹²áŒ áˆ« (áˆ½áˆáˆ›á‰µ áŠ¥áŠ•á‹²áˆ°áŒ¥)
                button.onclick = () => window.handleSocialTaskClick(button, actionType);
            }
        }, 1000);

        WebApp.showAlert(`â³ áŠ¥á‰£áŠ­á‹áŠ• á‰»áŠ“áˆ‰áŠ•/á‹©á‰²á‹©á‰¥áŠ• áŠ¨á‰°á‰€áˆ‹á‰€áˆ‰ á‰ áŠ‹áˆ‹ áˆˆ15 áˆ°áŠ¨áŠ•á‹µ á‹­áŒ á‰¥á‰á¢`);
    }
};

                





        // ======================================================================
        // ğŸ›‘ UPDATED: á‹¨á‰°áˆ»áˆ»áˆˆá‹ á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹ á‰°áŒá‰£áˆ­ (Telegram Share Integration)
        // ======================================================================
    // ... (áˆŒáˆá‰½ á‰°áŒá‰£áˆ«á‰µ áŠ¥áŠ•á‹° formatTime, checkDailyLimit, updateScore, startCooldownTimer, renderPageContent áŠ¥á‹šáˆ… áˆ˜áŒˆáˆˆáŒ½ áŠ áˆˆá‰£á‰¸á‹)

// á‹¨á‰´áˆŒáŒáˆ«áˆ á‰¦á‰µ á‹©á‹˜áˆ­áŠ”áˆ (á‰ áŠ¥áˆ­áˆµá‹ á‰µáŠ­áŠ­áˆˆáŠ› á‹¨á‰¦á‰µ áˆµáˆ áˆ˜á‰°áŠ«á‰µá‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡!)
const BOT_USERNAME = 'Smartgame21_bot'; 

// ============================================================
// ğŸ’¼ WALLET CONNECT LOGIC (TON CONNECT)
// ============================================================

// Manifest URL: áŠ¥áˆ­áˆµá‹ á‹¨áˆáŒ áˆ©á‰µ á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆŠáŠ•áŠ­ áŠ¥á‹šáˆ… á‰°á‰€áˆáŒ§áˆ
const manifestUrl = 'https://gist.githubusercontent.com/tame3232/ae2716a46705d31ed7596f34e11c4147/raw/a526a858fbd73c9579541d584992c0e0c112b6b4/tonconnect-manifest.json'; 

// TonConnectUI áˆ˜ááŒ áˆ­
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: manifestUrl,
});

// Wallet áˆ²áŒˆáŠ“áŠ á‹ˆá‹­áˆ áˆ²á‰‹áˆ¨áŒ¥ UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
tonConnectUI.onStatusChange(wallet => {
    const btnText = document.getElementById('wallet-btn-text');
    const btnStatus = document.getElementById('wallet-btn-status');
    
    if (wallet) {
        // á‰°áŒˆáŠ“áŠá‰·áˆ (Connected)
        const rawAddress = wallet.account.address;
        const shortAddress = rawAddress.slice(0, 4) + '...' + rawAddress.slice(-4);
        
        console.log("Wallet Connected:", rawAddress);

        // UI áˆ›á‹˜áˆ˜áŠ•
        if (btnText) btnText.innerText = "Wallet Connected";
        if (btnStatus) {
            btnStatus.innerText = shortAddress;
            btnStatus.style.color = "var(--et-green)"; 
            btnStatus.style.fontWeight = "bold";
        }

        // áŠ¥á‹šáˆ… áŒ‹áˆ­ saveWalletToFirebase(rawAddress) áˆ˜áŒ¨áˆ˜áˆ­ á‹­á‰½áˆ‹áˆ‰á¢

    } else {
        // áŠ áˆá‰°áŒˆáŠ“áŠ˜áˆ (Disconnected)
        if (btnText) btnText.innerText = "Connect Wallet";
        if (btnStatus) {
            btnStatus.innerText = "Connect >";
            btnStatus.style.color = "var(--tg-hint)";
            btnStatus.style.fontWeight = "normal";
        }
    }
});

// áŠ á‹áˆ«áˆ© áˆ²áŒ«áŠ• á‹¨áˆšáˆ°áˆ«á‹ á‰°áŒá‰£áˆ­
window.handleWalletConnect = async () => {
    try {
        if (tonConnectUI.connected) {
            const confirmDisconnect = confirm("Walletá‹áŠ• áˆ›á‰‹áˆ¨áŒ¥ á‹­áˆáˆáŒ‹áˆ‰?");
            if (confirmDisconnect) {
                await tonConnectUI.disconnect();
            }
        } else {
            // á‹¨áˆ›áŒˆáŠ“áŠ› áˆ³áŒ¥áŠ‘áŠ• (Modal) á‹­áŠ­áˆá‰µ
            await tonConnectUI.openModal();
        }
    } catch (error) {
        console.error("Wallet connection error:", error);
    }
};
// ============================================================

// ======================================================================
// 2. ğŸ”— á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ­ áˆ˜á‰…áŒƒ á‰°áŒá‰£áˆ­ (Handle Copy Invite Link)
// ğŸ›‘ FIX 1: áŠ áˆáŠ• á‹­áˆ°áˆ«áˆ (á‰  firebaseLogin() á‹áˆµáŒ¥ á‰£áˆˆá‹ áˆ›áˆµá‰°áŠ«áŠ¨á‹«)
// ======================================================================

window.handleCopyInviteLink = () => {
    // telegramUserId á‹¨áˆšáˆˆá‹ á‰°áˆˆá‹‹á‹‹áŒ­ áˆ˜áŒ«áŠ‘áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ (á‰ áŠ¥áˆ­áˆµá‹ áŠ®á‹µ á‹áˆµáŒ¥ global áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ)
    if (!window.telegramUserId) { // ğŸ›‘ FIX 1: á‹­áˆ… áŠ áˆáŠ• á‰  firebaseLogin() áˆáŠ­áŠ•á‹«á‰µ á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ°áˆ«áˆ
        WebApp.showAlert("áˆ˜áˆ¨áŒƒá‹ áŒˆáŠ“ áŠ áˆá‰°áŒ«áŠáˆá¢ áŠ¥á‰£áŠ­á‹ á‰µáŠ•áˆ½ á‰†á‹­á‰°á‹ á‹­áˆáŠ­áˆ©á¢");
        return;
    }
    
    // á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ©áŠ• á‹­áˆáŒ¥áˆ«áˆ
    const referralLink = `https://t.me/${BOT_USERNAME}?start=${window.telegramUserId}`;

    // áˆŠáŠ•áŠ©áŠ• á‹ˆá‹° Clipboard áˆ˜á‰…á‹³á‰µ
    navigator.clipboard.writeText(referralLink).then(() => {
        WebApp.showAlert("âœ… á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ­ á‰°á‰€á‹µá‰·áˆ!");
    }).catch(err => {
        console.error('Failed to copy link: ', err);
        WebApp.showAlert("âŒ áˆŠáŠ•áŠ©áŠ• áˆ˜á‰…á‹³á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢");
    });
};



// ======================================================================
// 3. ğŸ‘¥ á‹¨á‰°áˆ»áˆ»áˆˆá‹ á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹/Share á‰°áŒá‰£áˆ­ (Handle Invite Click) ğŸ›‘ áˆ½áˆáˆ›á‰µ á‰°á‹ˆáŒá‹·áˆ
// ======================================================================

window.handleInviteClick = (inviteLink, coins, timestampField) => { 
    // áˆ½áˆáˆ›á‰± á‰ á‰¦á‰µ/áˆ°áˆ­á‰¨áˆ­ Logic áˆµáˆˆáˆšáˆ°áŒ¥á£ á‹¨ 24-áˆ°á‹“á‰µ á‰†áŒ£áˆª áŠ¥áŠ“ updateScore á‰°á‹ˆáŒá‹·áˆ
    
    // ğŸ›‘ FIX 1: window.telegramUserId áŠ áˆáŠ• á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ°áˆ«áˆ
    const currentUserId = window.telegramUserId || 'MOCK_USER';
    
    // á‹¨á‰´áˆŒáŒáˆ«áˆ Referral áˆŠáŠ•áŠ­ áˆ˜ááŒ áˆ­
    const referralLink = `https://t.me/${BOT_USERNAME}?start=${currentUserId}`; 

    const messageText = encodeURIComponent(`â€‹ğŸ¤« áˆšáˆµáŒ¥áˆ©áŠ• áˆáŠ•áŒˆáˆ­áˆ…?
â€‹á‰´áˆŒáŒáˆ«áˆ áˆ‹á‹­ á‰¥á‹™ áˆ°á‹á‰½ á‹¨áˆ›á‹«á‹á‰á‰µ Coin áˆ˜ááˆˆá‰‚á‹« áˆšáŠ’-áŠ á• áŠ áŒáŠá‰»áˆˆáˆ!
â€‹á‹­áˆ„ áŒŒáˆ áŠ á‹­á‹°áˆˆáˆâ€”áŠ¥á‹áŠá‰°áŠ› á‹•á‹µáˆ áŠá‹!
â€‹ğŸ’¡ áŠ¥áŠ”áŠ“ áŒ“á‹°áŠá‰¼ áŠ áˆáŠ• á‰ áŒáŠ•á‰£áˆ­ á‰€á‹°áˆá‰µáŠá‰µ áŒ€áˆáˆ¨áŠ“áˆ! á‰ áŠ‹áˆ‹ áŠ¥áŠ•á‹³á‰µá‰†áŒ­!
â€‹áŠ áˆáŠ‘áŠ‘ á‰°á‰€áˆ‹á‰…áˆˆáˆ… á‹¨á‹µáˆ áˆ˜áŠ•áŒˆá‹±áŠ• áŒ€áˆáˆ­:`); 

    // á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ¼áˆ­ á‹©áŠ áˆ­áŠ¤áˆ
    const shareLink = `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${messageText}`;

    
    // á‰°áŒ á‰ƒáˆšá‹áŠ• á‹ˆá‹° á‰´áˆŒáŒáˆ«áˆ áˆ˜áŒ‹áˆªá‹« áˆ˜á‹áˆ°á‹µ (Share)
    WebApp.openTelegramLink(shareLink); 
    
    // á‰°áŒ á‰ƒáˆšá‹ áŠ¥áŠ•á‹²á‹«áŒ‹áˆ« áˆˆáˆ›á‰ áˆ¨á‰³á‰³á‰µ áˆ›áˆ³á‹ˆá‰‚á‹« áˆ˜áˆµáŒ á‰µ
    WebApp.showAlert("âœ… áŠ¥á‰£áŠ­á‹ áˆŠáŠ•áŠ©áŠ• áˆˆáŒ“á‹°áŠá‰½á‹ Share á‰ áˆ›á‹µáˆ¨áŒ áŠ¥áŠ•á‹²á‰€áˆ‹á‰€áˆ‰ á‹­áŒ‹á‰¥á‹™!"); 
};




// ======================================================================
// ğŸ›‘ FIX 3 & 4: áˆˆ Support áŠ¥áŠ“ Close áŠ á‹áˆ«áˆ®á‰½ á‹¨á‰°áŒ¨áˆ˜áˆ© á‰°áŒá‰£áˆ«á‰µ
// ======================================================================

/**
 * 3. ğŸ’¼ Support Button Function
 * (á‹­áˆ…áŠ•áŠ• á‰°áŒá‰£áˆ­ á‰  HTML á‹áˆµáŒ¥ áŠ«áˆˆá‹á‰µ á‹¨ Support áŠ á‹áˆ«áˆ­ áŒ‹áˆ­ á‹«áŒˆáŠ“áŠ™á‰µ)
 * e.g., <button onclick="window.handleSupportClick()">Support</button>
 */
window.handleSupportClick = () => {
    // ğŸ›‘ áŠ¥á‰£áŠ­á‹áŠ• 'YourSupportUsername' á‹¨áˆšáˆˆá‹áŠ• á‰ á‰µáŠ­áŠ­áˆˆáŠ›á‹ á‹¨á‹µáŒ‹á áŠ áŠ«á‹áŠ•á‰µ áˆµáˆ á‹­á‰°áŠ©
    const SUPPORT_LINK = 'https://t.me/smartgameSupporter_bot'; // ğŸ‘ˆ áŠ¥á‰£áŠ­á‹áŠ• á‹­áˆ…áŠ•áŠ• á‹­á‰°áŠ©
    try {
        if (window.Telegram && window.Telegram.WebApp) {
            WebApp.openTelegramLink(SUPPORT_LINK);
        } else {
            alert('Support can only be accessed within the Telegram app.');
            window.open(SUPPORT_LINK, '_blank'); // Fallback for browsers
        }
    } catch (e) {
        WebApp.showAlert('Could not open support link: ' + e.message);
    }
};

/**
 * 4. âŒ Close Button Function
 * (á‹­áˆ…áŠ•áŠ• á‰°áŒá‰£áˆ­ á‰  HTML á‹áˆµáŒ¥ áŠ«áˆˆá‹á‰µ á‹¨á‹áŒ‹ áŠ á‹áˆ«áˆ­ áŒ‹áˆ­ á‹«áŒˆáŠ“áŠ™á‰µ)
 * e.g., <button onclick="window.handleCloseClick()">Close</button>
 */
window.handleCloseClick = () => {
    try {
        if (window.Telegram && window.Telegram.WebApp) {
            WebApp.close(); // áˆ˜á‰°áŒá‰ áˆªá‹«á‹áŠ• á‹­á‹˜áŒ‹áˆ
        } else {
            alert('This can only be closed from within the Telegram app.');
        }
    } catch (e) {
        WebApp.showAlert('Error closing app: ' + e.message);
    }
};


        // ======================================================================
        // ?? á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹ á‰°áŒá‰£áˆ­ áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================


        // ğŸ›‘ FIX 2: áŠ¥áŠá‹šáˆ… áŠ¨á‰³á‰½ á‹¨áŠá‰ áˆ©á‰µ á‹¨á‰°á‹°áŒ‹áŒ‹áˆš (Duplicate) á‰°áŒá‰£áˆ«á‰µ á‰°á‹ˆáŒá‹°á‹‹áˆ
        /*
        window.handleWalletConnect = () => { ... };
        window.handleWalletConnect = () => { ... };
        window.handleCopyInviteLink = () => { ... };
        */


   



        // ======================================================================
//                          DAILY STREAK MODAL CODE ğŸ›‘ NEW SECTION
// ======================================================================
        
// áˆ½áˆáˆ›á‰± (streak) á‹¨áˆšá‰‹áˆ¨áŒ¥á‰ á‰µáŠ• áŒŠá‹œ á‰ áˆ°á‹“á‰µ á‹­á‹ˆáˆµáŠ“áˆ (48 áˆ°á‹“á‰µ = 2 á‰€áŠ•)
const STREAK_BREAK_HOURS = 48; 

window.openDailyRewardModal = () => {
    document.getElementById('daily-reward-modal').style.display = 'flex';
    window.updateDailyRewardModal();
}
// ======================================================================
// âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Streak Game Modal áˆ˜á‹áŒŠá‹« á‰°áŒá‰£áˆ­
// ======================================================================

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ Daily Reward ModaláŠ• á‹­á‹˜áŒ‹áˆ.
 */
window.closeDailyRewardModal = () => { // ğŸ›‘ 'Window' á‹ˆá‹° 'window' (á‰µáŠ•áˆ½ áŠá‹°áˆ) á‰°áˆµá‰°áŠ«áŠ­áˆáˆ
    
    // 1. Modal (áˆ½áˆáˆ›á‰±áŠ•) á‹áŒ‹
    document.getElementById('daily-reward-modal').style.display = 'none';

    // áˆá‹³áˆ áˆ²á‹˜áŒ‹ á‹¨áŒŠá‹œ á‰†áŒ£áˆªá‹áŠ• áˆ›á‰†áˆ (á‹¨á‰€á‹°áˆ˜á‹ áŠ®á‹µáˆ…)
    if (typeof timerIntervals !== 'undefined' && timerIntervals['daily_streak_timer']) {
        clearInterval(timerIntervals['daily_streak_timer']);
        delete timerIntervals['daily_streak_timer'];
    }
    
    // 2. âœ… ğŸ›‘ áŠ á‹²áˆµ áŠ®á‹µ: á‹¨áŒ¨á‹‹á‰³ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹ˆá‹²á‹«á‹áŠ‘ á‹áŒ‹
    const loadingOverlay = document.getElementById('game-loading-overlay');
    
    // áˆá‹°áˆ© á‹¨áˆšá‰³á‹­ áŠ¨áˆ†áŠ á‰¥á‰» á‹áŒ‹
    if (loadingOverlay && loadingOverlay.style.display === 'flex') {
        
        // áˆá‹°áˆ©áŠ• á‰ áˆµáˆá‰µ áˆˆáˆ˜á‹áŒ‹á‰µ (Fade out áŠ¥áŠ•á‹²á‹«á‹°áˆ­áŒ)
        loadingOverlay.style.opacity = '0'; 
        
        // á‹¨ CSS transition áŠ¥áˆµáŠªá‹«áˆá‰… áŒ á‰¥á‰€áŠ• Display áŠ• Hide áŠ¥áŠ“á‹°áˆ­áŒ‹áˆˆáŠ•
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
            // áˆˆáˆšá‰€áŒ¥áˆˆá‹ áŒŠá‹œ áˆµáŠ•áŠ¨áá‰µ á‰ á‰µáŠ­áŠ­áˆ áŠ¥áŠ•á‹²á‰³á‹­ opacity áŠ• á‹ˆá‹° 1 áŠ¥áŠ•áˆ˜áˆáˆ°á‹
            loadingOverlay.style.opacity = '1'; 
        }, 300); // 300ms á‹¨ CSS transition áŒŠá‹œ áŠá‹
    }
}

/**
 * á‹¨ Streak áˆ˜á‰‹áˆ¨áŒ¥áŠ• (break) á‹­áˆá‰µáˆ»áˆ
 * (á‹­áˆ… á‰°áŒá‰£áˆ­ áˆáŠ•áˆ áŠ áˆá‰°áŠáŠ«áˆ)
 */
const checkStreakBroken = (lastClaimTimestamp) => {
    if (!lastClaimTimestamp) {
        return false; // áŒˆáŠ“ áˆáŠ•áˆ claim áŠ áˆ‹á‹°áˆ¨áŒˆáˆ
    }
    const lastClaimTime = lastClaimTimestamp.toDate(); // Timestamp á‹ˆá‹° Date á‰€á‹­áˆ­
    const now = new Date();
    const hoursElapsed = (now.getTime() - lastClaimTime.getTime()) / (1000 * 60 * 60);
    
    // áŠ¨ 48 áˆ°á‹“á‰³á‰µ á‰ áˆ‹á‹­ áŠ«áˆˆáˆá‹, streak á‰°á‰‹áˆ­áŒ§áˆ
    return hoursElapsed > STREAK_BREAK_HOURS; 
}




window.updateDailyRewardModal = () => {
    const rewardGrid = document.getElementById('reward-grid');
    const claimButton = document.getElementById('daily-reward-claim-button');
    
    if (!currentUserDocData) return;

    const { isReady, remainingMs } = checkDailyLimit('last_streak_claim_time');
    const isStreakBroken = checkStreakBroken(currentUserDocData.last_streak_claim_time);
    
    let nextDayToClaim;
    if (isStreakBroken) {
        nextDayToClaim = 1;
    } else {
        nextDayToClaim = currentUserDocData.daily_streak || 1;
    }
    
    const daysAlreadyClaimed = (nextDayToClaim > 1 && !isStreakBroken) ? (nextDayToClaim - 1) : 0;

    let rewardCardsHtml = '';

    dailyStreakRewards.forEach((reward, index) => {
        const dayNumber = index + 1;
        const isClaimedToday = dayNumber <= daysAlreadyClaimed; 
        const isNextDay = dayNumber === nextDayToClaim;
        
        let cardClass = '';
        let lockIcon = '';
        let extraStyle = '';
        let numberBlur = '';

        if (reward.locked) {
            // âœ… áˆ›áˆµá‰°áŠ«áŠ¨á‹« 1: Opacity á‹ˆá‹° 1 á‰°áŒ áŒá‰·áˆ (á‰ á‹°áŠ•á‰¥ áŠ¥áŠ•á‹²á‰³á‹­)á£ áŒáŠ• á‹¨á‹³áˆ­ áˆ˜áˆµáˆ˜áˆ© (Border) á‰€á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• á‰°á‹°áˆ­áŒ“áˆ
            extraStyle = 'opacity: 0.9; border: 1px solid var(--et-red); pointer-events: none; background-color: #2a2a2a;'; 
            
            // âœ… áˆ›áˆµá‰°áŠ«áŠ¨á‹« 2: á‹¨á‰áˆá áˆáˆáŠ­á‰±áŠ• á‹ˆá‹° á‰€á‹­ SVG á‰€á‹­áˆ¨áŠá‹‹áˆ (áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­)
            lockIcon = `
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; background: rgba(0,0,0,0.8); border-radius: 50%; padding: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px #000;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FF5252" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>`;
            
            // á‹µá‰¥á‹˜á‹›á‹áŠ• (Blur) áˆ™áˆ‰ áˆˆáˆ™áˆ‰ áŠ áŒ¥áá‰°áŠá‹‹áˆ
            numberBlur = ''; 

        } else if (isClaimedToday) {
            cardClass = 'claimed';
        } else if (isNextDay && isReady) {
            cardClass = 'active-ready';
        }

        rewardCardsHtml += `
            <div class="reward-day-card ${cardClass}" id="reward-day-${dayNumber}" style="position: relative; ${extraStyle}">
                ${lockIcon}
                <p style="font-size: 10px; color: ${cardClass === 'claimed' ? 'var(--tg-hint)' : 'var(--tg-text)'}; margin: 0;">Day ${dayNumber}</p>
                <div class="reward-coin-icon">${(reward.coins / 1000).toFixed(0)}K</div> 
                <span style="${numberBlur}">${reward.coins.toLocaleString()}</span> 
            </div>
        `;
    });
    
    rewardGrid.innerHTML = rewardCardsHtml;

    // áŠ á‹áˆ«áˆ©áŠ• áˆ›áˆµá‰°áŠ«áŠ¨áˆ
    if (dailyStreakRewards[nextDayToClaim - 1].locked) {
         claimButton.disabled = true;
         claimButton.style.backgroundColor = '#333';
         claimButton.style.color = '#FF5252'; // áŒ½áˆá‰ á‰€á‹­ áŠ¥áŠ•á‹²áˆ†áŠ•
         claimButton.style.border = '1px solid #FF5252';
         claimButton.style.boxShadow = 'none';
         claimButton.innerText = `ğŸ”’ Day ${nextDayToClaim} is Locked (Coming Soon)`;
         claimButton.onclick = null;
         return;
    }

    if (isReady) {
        const rewardAmount = dailyStreakRewards[nextDayToClaim - 1].coins;
        claimButton.disabled = false;
        claimButton.style.backgroundColor = 'var(--et-green)';
        claimButton.style.color = 'white';
        claimButton.style.border = 'none';
        claimButton.style.boxShadow = '0 4px 0 #388E3C';
        claimButton.innerText = `CLAIM DAY ${nextDayToClaim} (+${rewardAmount.toLocaleString()} ğŸ’°)`; 
        claimButton.onclick = () => window.claimDailyReward(nextDayToClaim, rewardAmount); 
    
    } else {
        claimButton.disabled = true;
        claimButton.style.backgroundColor = '#555';
        claimButton.style.color = 'white';
        claimButton.style.border = 'none';
        claimButton.style.boxShadow = '0 4px 0 #333';
        claimButton.onclick = null;
        claimButton.innerText = `Come back tomorrow (${formatTime(remainingMs)} left)`;
        
        if (timerIntervals['daily_streak_timer']) {
            clearInterval(timerIntervals['daily_streak_timer']);
        }
        timerIntervals['daily_streak_timer'] = setInterval(() => {
            const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit('last_streak_claim_time');
            if(checkAgain) {
                window.updateDailyRewardModal();
                clearInterval(timerIntervals['daily_streak_timer']);
            } else {
                claimButton.innerText = `Come back tomorrow (${formatTime(remainingAgain)} left)`;
            }
        }, 1000);
    }
}


window.claimDailyReward = async (dayToClaim, coins) => { 
    
    // âœ…âœ…âœ… === á‹¨ Streak áˆ›áˆ¨áŒ‹áŒˆáŒ« (Validation) === âœ…âœ…âœ…
    const isStreakBroken = checkStreakBroken(currentUserDocData.last_streak_claim_time);
    
    let expectedDayToClaim;
    if (isStreakBroken) {
        expectedDayToClaim = 1; // á‰°á‰‹áˆ­áŒ§áˆá£ á‰€áŠ• 1áŠ• áˆ˜áŒ á‰ á‰…
    } else {
        expectedDayToClaim = currentUserDocData.daily_streak || 1; // áŠ«áˆá‰°á‰‹áˆ¨áŒ  áŠ¨á‰†áˆ˜á‰ á‰µ
    }
    
    // á‰°áŒ á‰ƒáˆšá‹ claim áˆˆáˆ›á‹µáˆ¨áŒ á‹¨áˆáŠ¨áˆ¨á‹ á‰€áŠ• áŠ¥áŠ“ áŠ¥áŠ› á‹¨áˆáŠ•áŒ á‰¥á‰€á‹ á‰€áŠ• á‹­á‹›áˆ˜á‹³áˆ‰?
    if (dayToClaim !== expectedDayToClaim) {
        WebApp.showAlert("âŒ á‰µáŠ­áŠ­áˆˆáŠ›á‹áŠ• á‰€áŠ• áŠ¥á‹¨áŒ á‹¨á‰ áŠ á‹­á‹°áˆ‰áˆ! (Streak may have reset)");
        window.updateDailyRewardModal(); // UI áŠ¥áŠ•á‹²áˆµá‰°áŠ«áŠ¨áˆ
        return;
    }
    // âœ…âœ…âœ… === áˆ›áˆ¨áŒ‹áŒˆáŒ«á‹ áŠ áˆˆá‰€ === âœ…âœ…âœ…
    
    // á‹¨ streak á‰†áŒ áˆ«á‹ á‰ á‰€áŒ¥á‰³ á‹ˆá‹°áˆšá‰€áŒ¥áˆˆá‹ á‰€áŠ• á‹­á‹˜áˆ‹áˆ. 10 áŠ¨á‹°áˆ¨áˆ° á‹ˆá‹° 1 á‹­áˆ˜áˆˆáˆ³áˆ.
    const newStreakCount = dayToClaim >= dailyStreakRewards.length ? 1 : dayToClaim + 1;
    
    const extraUpdateData = {
        // áŠ á‹²áˆ± streak á‰áŒ¥áˆ­ (áŠ¨1 áŠ¥áˆµáŠ¨ 10)
        daily_streak: newStreakCount, 
        // á‹­áˆ… áŒŠá‹œ á‰†áŒ£áˆª áŠáŒˆ áŠ¥áŠ•á‹²áˆ°áˆ« á‹¨áˆšá‹«á‹°áˆ­áŒˆá‹ áŠá‹
        last_streak_claim_time: serverTimestamp(), 
    };
    
    // áŠ á‹áˆ«áˆ©áŠ• áŠ¥áŠ•á‹³á‹­áŒ«áŠ• áˆ›á‹µáˆ¨áŒ
    document.getElementById('daily-reward-claim-button').disabled = true;
    document.getElementById('daily-reward-claim-button').innerText = 'CLAIMED!';

    const success = await updateScore(coins, `Daily Streak Day ${dayToClaim}`, 'last_streak_claim_time', extraUpdateData); 

    if (success) {
        window.playSound('win'); // ğŸ›‘ á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
        // á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ¨á‰°áˆ°áŒ  á‰ áŠ‹áˆ‹ á‹¨áŠ áˆáŠ‘áŠ• á‹¨áˆá‹³áˆ áŠ¥á‹­á‰³ á‹ˆá‹²á‹«á‹áŠ‘ áˆ›á‹˜áˆ˜áŠ•
        if (timerIntervals['daily_streak_timer']) {
             clearInterval(timerIntervals['daily_streak_timer']);
             delete timerIntervals['daily_streak_timer'];
        }
        // Firebase á‹³á‰³á‹ á‰  onSnapshot áˆµáˆˆáˆšá‹˜áˆáŠ•, á‰µáŠ•áˆ½ á‰†á‹­á‰¶ updateDailyRewardModal áˆ˜áŒ¥áˆ«á‰µ
        setTimeout(window.updateDailyRewardModal, 1000); 
        renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
    }
}


        // ======================================================================
        //                          DAILY STREAK MODAL CODE áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================
     


   // ======================================================================
        //                          LUCKY SLOT GAME CODE ğŸ›‘ UPDATED SECTION
        // ======================================================================
        
        // ?? UPDATED (Problem #1 Fixed)
        window.updateSlotGameUI = () => {
             const spinBtn = document.getElementById('spin-btn');
             const spinsLeftDisplay = document.getElementById('spins-left');
             const messageEl = document.getElementById('game-message');
             const resetTimerEl = document.getElementById('reset-timer');
             const resetContainer = document.getElementById('reset-timer-container');
             
             // âœ… á‹¨á‰†áŒ£áˆª á‰áˆá (timer key) áŠ¨áˆŒáˆá‰½ á‰†áŒ£áˆªá‹á‰½ áŒ‹áˆ­ áŠ¥áŠ•á‹³á‹­áŒ‹áŒ­
             const timerKey = 'slot_reset_timer';

             spinsLeftDisplay.innerText = currentSpinsLeft;
             
             const { isReady: resetReady, remainingMs: resetRemainingMs } = checkDailyLimit(SLOTS_COOLDOWN_FIELD);
             
             if (currentSpinsLeft > 0) {
                 spinBtn.disabled = false;
                 spinBtn.innerText = "áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‹­áŒ«áŠ‘ \n SPIN";
                 spinBtn.onclick = window.spinSlotMachine;
                 resetContainer.style.display = 'none';
                 messageEl.innerText = "Spin áˆˆáˆ›á‹µáˆ¨áŒ á‹­áŒ«áŠ‘á¢";

                 // âœ… áˆ°á‹“á‰µ á‰†áŒ£áˆªá‹ áŠ¥á‹¨áˆ°áˆ« áŠ¨áˆ†áŠ áˆ›á‰†áˆ (spin áˆµáˆ‹áŒˆáŠ˜)
                 if (timerIntervals[timerKey]) {
                     clearInterval(timerIntervals[timerKey]);
                     delete timerIntervals[timerKey];
                 }
             } else if (resetReady) {
                 spinBtn.disabled = false;
                 spinBtn.innerText = "RESET & SPIN";
                 spinBtn.onclick = () => window.resetSlotGameAndSpin(true);
                 resetContainer.style.display = 'block';
                 resetTimerEl.innerText = "Ready to Reset!";
                 messageEl.innerText = "Spin áŠ áˆá‰‹áˆ! áŠ á‹²áˆµ áˆ™áŠ¨áˆ« áˆˆáˆ˜áŒ€áˆ˜áˆ­ RESET & SPIN á‹­áŒ«áŠ‘á¢";

                 // âœ… áˆ°á‹“á‰µ á‰†áŒ£áˆªá‹ áŠ¥á‹¨áˆ°áˆ« áŠ¨áˆ†áŠ áˆ›á‰†áˆ (á‹áŒáŒ áˆµáˆˆáˆ†áŠ)
                 if (timerIntervals[timerKey]) {
                     clearInterval(timerIntervals[timerKey]);
                     delete timerIntervals[timerKey];
                 }
             } else {
                 spinBtn.disabled = true;
                 spinBtn.innerText = "SPIN (No Spins Left)";
                 spinBtn.onclick = null;
                 resetContainer.style.display = 'block';
                 messageEl.innerText = "Spin áŠ áˆá‰‹áˆá¢ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢";
                 
                 // ğŸ›‘ğŸ›‘ğŸ›‘ === FIX #1 ADDED === ğŸ›‘ğŸ›‘ğŸ›‘
                 // áˆ°á‹“á‰± áŠ¥áŠ•á‹²á‰†áŒ¥áˆ­ áˆ›á‹µáˆ¨áŒ
                 resetTimerEl.innerText = `Reset in: ${formatTime(resetRemainingMs)}`; 
                 
                 if (!timerIntervals[timerKey]) { // á‰†áŒ£áˆªá‹ áŠ áˆµá‰€á‹µáˆ áŠ«áˆá‰°áŒ€áˆ˜áˆ¨ á‰¥á‰»
                     timerIntervals[timerKey] = setInterval(() => {
                         const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit(SLOTS_COOLDOWN_FIELD);
                         if(checkAgain) {
                             window.updateSlotGameUI(); // áŒŠá‹œá‹ áˆ²á‹«áˆá‰… UIáŠ• á‹«á‹˜áˆáŠ“áˆ
                             clearInterval(timerIntervals[timerKey]);
                             delete timerIntervals[timerKey];
                         } else {
                             resetTimerEl.innerText = `Reset in: ${formatTime(remainingAgain)}`;
                         }
                     }, 1000);
                 }
                 // ğŸ›‘ğŸ›‘ğŸ›‘ === END OF FIX === ğŸ›‘ğŸ›‘ğŸ›‘
             }
        }
        
        // ğŸ›‘ UPDATED (á‹­áˆ… á‰°áŒá‰£áˆ­ á‰µáŠ­áŠ­áˆ áŠá‰ áˆ­)
        window.resetSlotGameAndSpin = async (startSpin = false) => {
            if (currentSpinsLeft > 0) return; // á‹¨áˆšáˆ°áˆ«á‹ á‹œáˆ® áˆ²áˆ†áŠ• á‰¥á‰» áŠá‹
            
            const userRef = doc(db, "users", currentFirebaseUserId); 
            
            const updateData = {
                slot_spins_left: SLOTS_MAX_SPINS,
                last_slot_reset_time: serverTimestamp(),
            };
            
            try {
                await updateDoc(userRef, updateData);
                currentSpinsLeft = SLOTS_MAX_SPINS; // á‹ˆá‹²á‹«á‹áŠ‘ UIáŠ• áˆˆáˆ›á‹˜áˆ˜áŠ•
                
                if (startSpin) {
                    WebApp.showAlert("âœ… Slot Game á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆá¢ áŠ áˆáŠ• áˆµá’áŠ• áˆ›á‹µáˆ¨áŒ á‹­á‰½áˆ‹áˆ‰á¢");
                    await window.spinSlotMachine(); 
                } else {
                    WebApp.showAlert("âœ… Slot Game á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ! 10 Spin áŠ áŒáŠá‰°á‹‹áˆá¢");
                }
                
                window.updateSlotGameUI(); 
                return true;
            } catch (error) {
                WebApp.showAlert("âŒ Slot GameáŠ• á‹³áŒáˆ á‰ áˆ›áˆµáŒ€áˆ˜áˆ­ áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨: " + error.message);
                console.error("Error resetting Slot Game:", error);
                return false;
            }
        }
        
        // ğŸ›‘ UPDATED (Problem #2 Fixed)
        window.spinSlotMachine = async () => {
            if (currentSpinsLeft <= 0) {
                 WebApp.showAlert("âŒ áˆáŠ•áˆ á‰€áˆª Spin á‹¨áˆˆá‹á‰µáˆá¢");
                 window.updateSlotGameUI(); 
                 return;
            }
            
            window.playSound('spin'); 
            
            const spinBtn = document.getElementById('spin-btn');
            const slots = [
                document.getElementById('slot-1'),
                document.getElementById('slot-2'),
                document.getElementById('slot-3')
            ];
            
            spinBtn.disabled = true;
            spinBtn.innerText = "SPINNING...";
            
            // ... (á‹¨áŠ áŠ’áˆœáˆ½áŠ• áŠ¥áŠ“ á‹¨á‹áŒ¤á‰µ áˆáŒ‚áŠ­áˆ… á‰ áˆ™áˆ‰ áŠ¥á‹šáˆ… áŒ‹áˆ­ - áˆáˆ‰áˆ á‰µáŠ­áŠ­áˆ áŠá‹) ...
            // 1. á‹¨á‹˜áˆá‰€á‹° á‹áŒ¤á‰¶á‰½áŠ• áˆ›áˆ˜áŠ•áŒ¨á‰µ
            const isJackpotWinner = Math.random() < 0.08; 
            const finalPrizes = [];
            // ... (á‰€áˆªá‹ á‹¨á‹áŒ¤á‰µ áˆáŒ‚áŠ­) ...
            if (isJackpotWinner) {
                for(let i=0; i<3; i++) finalPrizes.push(slotItems[0]);
            } else {
                for(let i=0; i<3; i++) {
                    const randomIndex = Math.floor(Math.random() * slotItems.length);
                    finalPrizes.push(slotItems[randomIndex]);
                }
            }

            // 2. áŠ áŠ’áˆœáˆ½áŠ• áˆ˜áŒ€áˆ˜áˆ­ áŠ¥áŠ“ á‹áŒ¤á‰±áŠ• áˆ›áˆ³á‹¨á‰µ
            let animations = [];
            // ... (á‰€áˆªá‹ á‹¨áŠ áŠ’áˆœáˆ½áŠ• áˆáŒ‚áŠ­) ...
            slots.forEach((slot, index) => {
                 const randomStopIndex = Math.floor(Math.random() * 20) + 10; 
                 const finalPosition = 360 * randomStopIndex + index * 120 + 360; 
                 
                 slot.classList.add('spinning-slot'); 
                 slot.style.transition = `transform ${2 + index * 0.5}s cubic-bezier(0.25, 0.46, 0.45, 0.94)`;
                 slot.style.transform = `translateY(-${finalPosition}px)`;

                 animations.push(new Promise(resolve => {
                    setTimeout(() => {
                         slot.style.transition = 'none'; 
                         slot.style.transform = `translateY(0px)`; 
                         slot.classList.remove('spinning-slot');
                         slot.innerHTML = `<div class="slot-content">${finalPrizes[index]}</div>`;
                         resolve();
                    }, (2.5 + index * 0.5) * 1000); 
                 }));
            });
            
            await Promise.all(animations); 
            
             // 3. á‹áŒ¤á‰±áŠ• áˆ›áˆµáˆ‹á‰µ
             // ... (á‰€áˆªá‹ á‹¨á‹áŒ¤á‰µ áˆ›áˆµáˆ‹á‰µ áˆáŒ‚áŠ­ - áˆáˆ‰áˆ á‰µáŠ­áŠ­áˆ áŠá‹) ...
             let message = "";
             let totalCoins = 0; 

             if (finalPrizes[0] === 'ğŸ’' && finalPrizes[1] === 'ğŸ’' && finalPrizes[2] === 'ğŸ’') {
                 totalCoins = COIN_REWARD; 
                 message = `ğŸ‰ JACKPOT! +${totalCoins.toLocaleString()} coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!`; 
                 window.playSound('win'); 
             } else if (finalPrizes[0] === finalPrizes[1] && finalPrizes[1] === finalPrizes[2]) {
                totalCoins = 500;
                message = `ğŸ¥³ áˆ¶áˆµá‰µ á‰°áˆ˜áˆ³áˆ³á‹­! +${totalCoins} coin áŠ áˆ¸áŠ•áˆá‹‹áˆá¢`; 
             } else if (finalPrizes.filter(item => item === 'ğŸ’').length >= 2) {
                 totalCoins = 100;
                 message = `á‰µáŠ•áˆ½ á‰€áˆ¨! +${totalCoins} coin áŠ áˆ¸áŠ•áˆá‹‹áˆá¢`; 
             } else {
                 totalCoins = 0;
                 message = `ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆ! 0 coiná¢`; 
                 window.playSound('fail'); 
             }
             
             document.getElementById('game-message').innerText = message;
             
             // 4. Firebase áˆ‹á‹­ áˆ›á‹˜áˆ˜áŠ•
             currentSpinsLeft--;
             
             const extraUpdateData = {
                 slot_spins_left: currentSpinsLeft,
             };
             
             if (totalCoins > 0) {
                 await updateScore(totalCoins, 'Lucky Slot Game', null, extraUpdateData);
             } else {
                 const userRef = doc(db, "users", currentFirebaseUserId); 
                 await updateDoc(userRef, extraUpdateData);
             }
             
             // 5. UIáŠ• áˆ›á‹˜áˆ˜áŠ•
             window.updateSlotGameUI(); 
             
             // 6. á‰†áŒ£áˆªá‹áŠ• áˆ›á‹˜áˆ˜áŠ•
             // ğŸ›‘ğŸ›‘ğŸ›‘ === FIX #2 REMOVED === ğŸ›‘ğŸ›‘ğŸ›‘
             // á‹­áˆ… áˆ˜áˆµáˆ˜áˆ­ á‰°á‹ˆáŒá‹·áˆ!
             // window.startCooldownTimer(SLOTS_COOLDOWN_FIELD, 'reset-timer', 'spin-btn');
             // ğŸ›‘ğŸ›‘ğŸ›‘ === END OF FIX === ğŸ›‘ğŸ›‘ğŸ›‘
        }
        
        
      // ======================================================================
//         DAILY SPIN GAME CODE (FAST SPEED & FIXED ALIGNMENT)
// ======================================================================

const spinPrizes = [
    { index: 0, coins: 5000, text: "5000 coin" }, 
    { index: 1, coins: 50,   text: "50 coin" },   
    { index: 2, coins: 20,   text: "20 coin" },   
    { index: 3, coins: 2000, text: "2000 coin" }, 
    { index: 4, coins: 5,    text: "5 coin" },    
    { index: 5, coins: 0,    text: "0 coin" },    
    { index: 6, coins: 10,   text: "10 coin" },   
    { index: 7, coins: 1000, text: "1000 coin" }, 
    { index: 8, coins: 500,  text: "500 coin" },  
    { index: 9, coins: 200,  text: "200 coin" }   
];

const segmentAngle = 36; // 360 / 10

window.spinTheWheel = async () => {
    const timestampField = 'last_spin_time';
    const actionButton = document.getElementById('daily-spin-action');
    const wheel = document.getElementById('spin-wheel');

    // Check Limit
    if (typeof checkDailyLimit === "function") {
        const { isReady } = checkDailyLimit(timestampField);
        if (!isReady) {
            WebApp.showAlert(`âŒ á‹•áˆˆá‰³á‹Š áˆ½áŠ­áˆ­áŠ­áˆ­ (Daily Spin) áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
            return;
        }
    }

    actionButton.disabled = true;
    if(window.playSound) window.playSound('spin');

    // 1. Random Selection
    const randomIndex = Math.floor(Math.random() * spinPrizes.length);
    const winningPrize = spinPrizes[randomIndex];

    // ============================================================
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (THE FIX)
    // 1. ááŒ¥áŠá‰µ áˆˆáˆ˜áŒ¨áˆ˜áˆ­: spinCount = 10 (á‰ áŒ£áˆ áˆáŒ£áŠ• á‹­áˆ†áŠ“áˆ)
    // 2. áŠ áˆ°áˆ‹áˆˆá áˆˆáˆ›áˆµá‰°áŠ«áŠ¨áˆ: correctionOffset = -36 (á‹ˆá‹° áŠá‰µ á‹­áŒˆá‹á‹‹áˆ)
    // ============================================================
    
    const spinCount = 10; // áŠ áˆáŠ• 10 áŒŠá‹œ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ«áˆ (á‰ áŒ£áˆ á‹­áˆáŒ¥áŠ“áˆ)
    const correctionOffset = -36; // áŒáˆ›á‹ á‹ˆá‹° áŠ‹áˆ‹ áŠ¥áŠ•á‹³á‹­á‰€áˆ­ á‹ˆá‹°áŠá‰µ á‹­áŒˆá‹á‹‹áˆ

    // ============================================================

    const baseRotation = 360 * spinCount; 
    const targetRotation = baseRotation - (randomIndex * segmentAngle) - correctionOffset;

    // 2. Reset & Spin
    wheel.style.transition = 'none';
    wheel.style.transform = `rotate(0deg)`;

    setTimeout(async () => {
        // áŠ¥á‹šáˆ… áŒ‹áˆ­ cubic-bezier á‰°áˆµá‰°áŠ«áŠ­áˆáˆ (áˆ˜áŒ€áˆ˜áˆªá‹« áˆ‹á‹­ á‰ áŒ£áˆ áˆáŒ¥áŠ– áˆ˜áŒ¨áˆ¨áˆ» áˆ‹á‹­ á‰€áˆµ áŠ¥áŠ•á‹²áˆ)
        wheel.style.transition = 'transform 4.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
        wheel.style.transform = `rotate(${targetRotation}deg)`;

        // 4.5 áˆ°áŠ¨áŠ•á‹µ áˆ˜áŒ á‰ á‰…
        await new Promise(resolve => setTimeout(resolve, 4500));

        // áˆ½áˆáˆ›á‰µ áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        console.log(`Won Index: ${randomIndex}, Prize: ${winningPrize.text}`);

        let success = true;
        if (typeof updateScore === "function") {
            success = await updateScore(winningPrize.coins, 'Daily Spin', timestampField);
        }

        if (success) {
            let msg = `ğŸ¥³ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${winningPrize.text} áŠ áˆ¸áŠ•áˆá‹‹áˆ!`;
            if (typeof WebApp !== 'undefined' && WebApp.showAlert) {
                WebApp.showAlert(msg);
            } else {
                alert(msg);
            }
            if(window.playSound) window.playSound('win');
        }
        
        if (typeof startCooldownTimer === "function") {
            startCooldownTimer(timestampField, 'daily-spin-timer', 'daily-spin-action');
        }

    }, 50);
};


              // ======================================================================
        //                          DAILY SPIN GAME CODE áˆ˜áŒ¨áˆ¨áˆ» 
        // ======================================================================
 



        // ======================================================================
        //                          MYSTERY BOX GAME CODE
        // ======================================================================
        const mysteryPrizes = [100, 250, 500]; 
        let hasPlayedMysteryBox = false;
        let correctBoxIndex = -1;

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.resetMysteryBox = (showSuccessMessage = true) => {
            const actionButton = document.getElementById('mystery-box-action');
            const messageEl = document.getElementById('box-message');
            const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3')];
            
            boxes.forEach(box => {
                box.innerText = '?';
                box.classList.remove('opened', 'missed');
                box.style.pointerEvents = 'auto'; 
                box.style.backgroundColor = 'var(--et-red)';
                // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: playMysteryBox()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                box.onclick = () => window.playMysteryBox(parseInt(box.id.split('-')[1])); 
                // á‹¨3D áŒ¥áˆ‹á‹áŠ• á‹­áˆ˜áˆáˆ±
                box.style.boxShadow = '0 8px 0 #A83232';
                box.style.transform = 'translateY(0)';
            });
            
            actionButton.innerText = 'áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©';
            actionButton.disabled = false;
            actionButton.style.display = 'none'; 
            messageEl.innerText = 'áˆ³áŒ¥áŠ• á‹­áˆáˆ¨áŒ¡!';
            
            hasPlayedMysteryBox = false;
            correctBoxIndex = Math.floor(Math.random() * 3) + 1; 
            
            const { isReady } = checkDailyLimit('last_mystery_time');
            if (!isReady) {
                 boxes.forEach(box => box.style.pointerEvents = 'none');
                 messageEl.innerText = 'á‹›áˆ¬ á‰°áŒ«á‹á‰°á‹‹áˆá¢ áŠáŒˆ á‹­áˆáŠ­áˆ©á¢';
                 actionButton.style.display = 'block'; 
                 actionButton.innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
                 // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                 actionButton.onclick = window.showMainPage; 
            }
            
            if (showSuccessMessage) WebApp.showAlert('áŒ¨á‹‹á‰³á‹ á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ!');
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.playMysteryBox = async (selectedBoxIndex) => {
            const timestampField = 'last_mystery_time';
            const messageEl = document.getElementById('box-message');
            const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3')];
            const actionButton = document.getElementById('mystery-box-action');

            if (hasPlayedMysteryBox) return; 

            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                WebApp.showAlert(`âŒ áˆšáˆµáŒ¥áˆ«á‹Š áˆ£áŒ¥áŠ• (Mystery Box) áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
                return;
            }

            hasPlayedMysteryBox = true;
            boxes.forEach(box => box.style.pointerEvents = 'none'); 

            let coinsWon = 0; 
            const winningPrize = mysteryPrizes[Math.floor(Math.random() * mysteryPrizes.length)];
            
            boxes.forEach((box, index) => {
                const boxNum = index + 1;
                if (boxNum === correctBoxIndex) {
                    box.innerText = `+${winningPrize}`;
                    box.classList.add('opened');
                    box.style.backgroundColor = 'var(--et-green)';
                    box.style.boxShadow = '0 8px 0 #388E3C';
                    if (boxNum === selectedBoxIndex) {
                        coinsWon = winningPrize; 
                        // á‹¨áˆ˜áˆ¨áŒ¥áŠá‹áŠ• áˆ³áŒ¥áŠ• á‰µáŠ•áˆ½ á‹ˆá‹°áˆ‹á‹­ áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ áŠ¥áŠ“á‹µáˆ­áŒ
                        box.style.transform = 'translateY(-5px)'; 
                    }
                } else {
                    box.innerText = 'âŒ';
                    box.classList.add('missed');
                    box.style.backgroundColor = 'var(--tg-hint)';
                    box.style.boxShadow = '0 8px 0 #333';
                }
            });

            if (selectedBoxIndex === correctBoxIndex) {
                messageEl.innerText = `ğŸ¥³ áŠ áˆ¸áŠ•áˆá‹‹áˆ! ${winningPrize.toLocaleString()} coin!`; // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin
                window.playSound('win'); // ğŸ›‘ á‹¨ Win á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
            } else {
                messageEl.innerText = `ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆ³áŒ¥áŠ• á‰áŒ¥áˆ­ ${correctBoxIndex} áŠá‰ áˆ­á¢`;
                window.playSound('fail'); // ğŸ›‘ á‹¨ Fail á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
            }
            
            if (coinsWon > 0) { 
                await updateScore(coinsWon, 'Mystery Box Game', timestampField); // ğŸ›‘ pointsWon á‹ˆá‹° coinsWon
            } else {
                 WebApp.showAlert('âŒ áˆáŠ•áˆ coin áŠ áˆ‹áŒˆáŠ™áˆá¢ áŠáŒˆ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢'); // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin
            }
            
            startCooldownTimer(timestampField, 'mystery-box-timer', 'mystery-box-action');
            actionButton.style.display = 'block'; 
            actionButton.innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            actionButton.onclick = window.showMainPage;
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }




        // ======================================================================
        //                           REFLEX GAME CODE 
        // ======================================================================
        let timeoutID = null;
        let startTime = 0;
        let isWaitingForClick = false;

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.resetReflexGame = (showSuccessMessage = true) => {
            clearTimeout(timeoutID);
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-message').innerText = 'áˆˆáˆ˜áŒ€áˆ˜áˆ­ áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰áˆá á‹­áŒ«áŠ‘á¢';
            document.getElementById('reflex-result').innerText = '';
            document.getElementById('reflex-game-action').innerText = 'áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­';
            document.getElementById('reflex-game-action').disabled = false;
            // ?? á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick; 
            
            const { isReady } = checkDailyLimit('last_reflex_time');
            if (!isReady) {
                 document.getElementById('reflex-game-action').classList.add('cooldown');
                 document.getElementById('reflex-game-action').disabled = true;
                 document.getElementById('reflex-message').innerText = 'á‹›áˆ¬ á‰°áŒ«á‹á‰°á‹‹áˆá¢ áŠáŒˆ á‹­áˆáŠ­áˆ©á¢';
            } else {
                 document.getElementById('reflex-game-action').classList.remove('cooldown');
            }
            
            if (showSuccessMessage) WebApp.showAlert('áŒ¨á‹‹á‰³á‹ á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ!');
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.handleReflexTooEarlyClick = () => {
             if (isReflexGameRunning && !isWaitingForClick) {
                 clearTimeout(timeoutID);
                 // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexFailure()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                 window.handleReflexFailure("âŒ á‰ áŒ£áˆ á‰€á‹µáˆ˜á‹‹áˆ! áŠ áˆ¨áŠ•áŒ“á‹´ áŠ¥áˆµáŠªáˆ†áŠ• áˆ˜áŒ á‰ á‰… áŠá‰ áˆ¨á‰¥á‹á¢");
                 window.playSound('fail'); // ğŸ›‘ á‹¨ Fail á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
             }
        }
        
        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.startReflexGame = () => {
            const timestampField = 'last_reflex_time';
            const actionButton = document.getElementById('reflex-game-action');

            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                WebApp.showAlert(`âŒ á‹¨ááŒ¥áŠá‰µ áŒ¨á‹‹á‰³ (Reflex Game) áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
                return;
            }
            
            actionButton.disabled = true;
            actionButton.innerText = 'á‰°áŒ áŠ“á‰‹áˆ...';
            isReflexGameRunning = true; 
            
            document.getElementById('reflex-message').innerText = 'á‰€á‹­ áŠ¥áˆµáŠªáˆ†áŠ• á‹­áŒ á‰¥á‰...';
            document.getElementById('reflex-result').innerText = '';
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;

            const delay = Math.random() * 3000 + 1000; 
            
            timeoutID = setTimeout(() => {
                document.getElementById('reflex-message').style.display = 'none';
                document.getElementById('reflex-button').style.display = 'flex';
                document.getElementById('reflex-button').style.backgroundColor = 'var(--et-green)'; 
                document.getElementById('reflex-button').innerText = 'TAP ME!';
                isWaitingForClick = true;
                startTime = performance.now();
                
                timeoutID = setTimeout(() => {
                    // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: stopReflexGame()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                    window.stopReflexGame(null, true); 
                }, 3000); 
                
            }, delay);
        };
        
        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.handleReflexFailure = (message) => {
            clearTimeout(timeoutID);
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            
            document.getElementById('reflex-message').innerText = message;
            document.getElementById('reflex-message').style.display = 'block';
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-result').innerText = '0 coin'; 
            
            document.getElementById('reflex-game-action').innerText = 'áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­';
            document.getElementById('reflex-game-action').disabled = false;
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick; 
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.stopReflexGame = async (event, isTimeout = false) => {
            if (event && event.type === 'click') {
                event.stopPropagation(); 
            }

            if (!isWaitingForClick && !isTimeout) return;
            
            clearTimeout(timeoutID);
            const endTime = performance.now();
            const reactionTime = Math.round(endTime - startTime);
            
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-message').style.display = 'block';
            document.getElementById('reflex-message').innerText = 'áŒ¨á‹‹á‰³á‹ á‰°áŒ áŠ“á‰‹áˆ!';
            document.getElementById('reflex-play-area').onclick = null; 


            let coins = 0; 
            
            if (isTimeout) {
                document.getElementById('reflex-result').innerText = `âŒ áŒŠá‹œá‹ áŠ áˆááˆ! 0 coin`; 
                window.playSound('fail'); // ğŸ›‘ á‹¨ Fail á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
            } else {
                window.playSound('click'); // ğŸ›‘ á‹¨ Click á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
                if (reactionTime < 200) {
                    coins = 500; 
                } else if (reactionTime < 300) {
                    coins = 200;
                } else if (reactionTime < 500) {
                    coins = 100;
                } else {
                    coins = 50;
                }
            
                document.getElementById('reflex-result').innerText = `ááŒ¥áŠá‰µá‹: ${reactionTime}ms. áˆ½áˆáˆ›á‰µ: +${coins.toLocaleString()} coin!`; // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin

                if (await updateScore(coins, 'Reflex Game', 'last_reflex_time')) { 
                    WebApp.showAlert(`ğŸ¥³ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${coins.toLocaleString()} coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!`); 
                    window.playSound('win'); // ğŸ›‘ á‹¨ Win á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
                }
            }
            
            startCooldownTimer('last_reflex_time', 'reflex-game-timer', 'reflex-game-action');
            document.getElementById('reflex-game-action').innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-game-action').onclick = window.showMainPage;
            document.getElementById('reflex-game-action').disabled = false;
            
            setTimeout(() => {
                // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;
            }, 100); 
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }




        // ======================================================================
        //                          SCRATCH CARD GAME CODE ğŸ›‘ áŠ á‹²áˆµ á‹¨á‰°áŒ¨áˆ˜áˆ¨
        // ======================================================================
        
        let scratchCanvas, scratchCtx, isScratching = false;
        let isScratchGameActive = false; // áŒ¨á‹‹á‰³á‹ áŠ áŠ•á‹´ á‰¥á‰» áˆ½áˆáˆ›á‰µ áŠ¥áŠ•á‹²áˆ°áŒ¥
        let scratchPrizeAmount = 0;
        const SCRATCH_PRIZES = [100, 150, 200, 300, 500]; // áˆŠáŒˆáŠ™ á‹¨áˆšá‰½áˆ‰ áˆ½áˆáˆ›á‰¶á‰½

        // 1. á‹¨ Canvas áˆ˜áˆá‰…áˆá‰‚á‹« áˆ˜á‰†áŒ£áŒ áˆªá‹«
        function getScratchCoords(e) {
            const rect = scratchCanvas.getBoundingClientRect();
            let x, y;
            if (e.touches) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            return { x, y };
        }

        function startScratch(e) {
            if (!isScratchGameActive) return;
            isScratching = true;
            scratch(e);
        }

        function stopScratch() {
            if (!isScratchGameActive) return;
            isScratching = false;
            // áˆ˜áˆá‰…áˆá‰… áˆ²á‰†áˆ áˆáŠ• á‹«áˆ…áˆ áŠ¥áŠ•á‹°á‰°áˆá‰€áˆá‰€ á‰¼áŠ­ áˆ›á‹µáˆ¨áŒ
            checkScratchPercentage();
        }

        function scratch(e) {
            if (!isScratching || !isScratchGameActive) return;
            e.preventDefault(); // áŒˆáŒ¹ áŠ¥áŠ•á‹³á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ­ (scroll) á‹«á‹°áˆ­áŒ‹áˆ

            const { x, y } = getScratchCoords(e);
            
            // "destination-out" áˆ›áˆˆá‰µ áŠ á‹²áˆµ áˆµáŠ¥áˆ áˆ²áˆ³áˆ áŠ áˆ®áŒŒá‹áŠ• á‹«áŒ á‹á‹‹áˆ (á‹­áˆá‰…áá‰€á‹‹áˆ)
            scratchCtx.globalCompositeOperation = 'destination-out';
            scratchCtx.beginPath();
            scratchCtx.arc(x, y, 20, 0, Math.PI * 2, false); // 20px áˆ«á‹²á‹¨áˆµ á‹«áˆˆá‹ áŠ­á‰¥
            scratchCtx.fill();
        }

        // 2. áˆáŠ• á‹«áˆ…áˆ áŠ¥áŠ•á‹°á‰°áˆá‰€áˆá‰€ áˆ›á‹ˆá‰…
        function checkScratchPercentage() {
            if (!isScratchGameActive) return; // áŠ áˆµá‰€á‹µáˆ áŠ¨á‰°áŒ áŠ“á‰€á‰€ á‹­á‰°á‹á‰µ

            const imageData = scratchCtx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
            const data = imageData.data;
            let transparentPixels = 0;

            // áˆáˆ‰áŠ•áˆ á’áŠ­áˆ°áˆá‰½ áˆ˜á‰áŒ áˆ­ á‹á‹µ áˆµáˆˆáˆ†áŠá£ á‰ á‹¨ 32áŠ› á’áŠ­áˆ°áˆ áŠ¥áŠ•á‰†áŒ¥áˆ«áˆˆáŠ•
            for (let i = 0; i < data.length; i += 32) {
                // data[i+3] á‹¨á’áŠ­áˆ°áˆ‰áŠ• Alpha (transparency) á‹­á‹­á‹›áˆ
                if (data[i + 3] === 0) {
                    transparentPixels++;
                }
            }

            const totalPixels = (data.length / 32);
            const percentage = (transparentPixels / totalPixels) * 100;

            // 60% á‰ áˆ‹á‹­ áŠ¨á‰°áˆá‰€áˆá‰€ áˆ½áˆáˆ›á‰±áŠ• á‹­áˆµáŒ¡
            if (percentage > 60) {
                revealScratchPrize();
            }
        }

        // 3. áˆ½áˆáˆ›á‰±áŠ• áˆ˜áˆµáŒ á‰µ
        async function revealScratchPrize() {
            if (!isScratchGameActive) return; // á‹µáˆ­á‰¥ áˆ½áˆáˆ›á‰µ áŠ¥áŠ•á‹³á‹­áˆ°áŒ¥
            
            isScratchGameActive = false; // áŒ¨á‹‹á‰³á‹áŠ• á‹«á‰áˆ™
            window.playSound('win'); // ğŸ›‘ á‹¨á‹µáˆ á‹µáˆáŒ½

            // áˆ¸áˆ«á‹áŠ• (canvas) á‰€áˆµ á‰¥áˆ áŠ¥áŠ•á‹²áŒ á‹ áˆ›á‹µáˆ¨áŒ
            scratchCanvas.style.transition = 'opacity 0.5s ease';
            scratchCanvas.style.opacity = '0';
            
            document.getElementById('scratch-result-message').innerText = `ğŸ‰ +${scratchPrizeAmount.toLocaleString()} coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!`;

            // áˆ½áˆáˆ›á‰±áŠ• áŠ¥áŠ“ á‹¨áŒŠá‹œ áˆ›áˆ…á‰°áˆ™áŠ• (timestamp) á‹ˆá‹° Firebase áˆ˜áˆ‹áŠ­
            // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: "last_scratch_time" á‹¨áˆšáˆˆá‹áŠ• á‰µáŠ­áŠ­áˆˆáŠ› á‹¨ cooldown field áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•
            const success = await updateScore(scratchPrizeAmount, 'Scratch Card Game', 'last_scratch_time');
            
            if (success) {
                // UI áˆ›á‹˜áˆ˜áŠ•
                startCooldownTimer('last_scratch_time', 'scratch-card-timer', 'scratch-card-action');
                renderPageContent(); // áŠ áŒ á‰ƒáˆ‹á‹­ áŠáŒ¥á‰¥áŠ• á‹«á‹˜áˆáŠ“áˆ
                
                const actionButton = document.getElementById('scratch-card-action');
                actionButton.innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
                actionButton.style.display = 'block';
                actionButton.disabled = false;
                actionButton.onclick = window.showMainPage; // á‰°áŒá‰£áˆ©áŠ• áˆ˜á‰€á‹¨áˆ­
            } else {
                document.getElementById('scratch-result-message').innerText = 'áˆ½áˆáˆ›á‰µ á‰ áˆ˜áˆµáŒ á‰µ áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆá¢';
            }
        }


        // 4. á‹¨ Scratch Card áŒ¨á‹‹á‰³ á‹‹áŠ“ á‰°áŒá‰£áˆ­ (Initializer)
        // á‹­áˆ„ á‰°áŒá‰£áˆ­ áŒˆáŒ¹ áˆ²áŠ¨áˆá‰µ á‹ˆá‹­áˆ "Reset" áˆ²áŒ«áŠ• á‹­áŒ áˆ«áˆ
        window.initScratchCard = (isReset = false) => {
            const timestampField = 'last_scratch_time'; // ğŸ›‘ á‹­áˆ„ field áŠ¨ "SCRATCH" áŠ á‹áˆ«áˆ­ áŒ‹áˆ­ áˆ˜áˆ˜áˆ³áˆ°áˆ áŠ áˆˆá‰ á‰µ
            const actionButton = document.getElementById('scratch-card-action');
            const messageEl = document.getElementById('scratch-result-message');
            const prizeTextEl = document.getElementById('scratch-prize-text');
            
            scratchCanvas = document.getElementById('scratch-canvas');
            scratchCtx = scratchCanvas.getContext('2d', { willReadFrequently: true }); // willReadFrequently áˆˆ checkScratchPercentage
            
            // á‹¨ Canvas áˆµá‹á‰µ áŠ¥áŠ“ á‰áˆ˜á‰µ áˆ›áˆµá‰°áŠ«áŠ¨áˆ
            scratchCanvas.width = scratchCanvas.clientWidth;
            scratchCanvas.height = scratchCanvas.clientHeight;
            scratchCanvas.style.opacity = '1'; // á‰°áˆ˜áˆáˆ¶ áŠ¥áŠ•á‹²á‰³á‹­ áˆ›á‹µáˆ¨áŒ
            scratchCanvas.style.transition = 'none'; // á‰µáˆ«áŠ•á‹šáˆ½áŠ‘áŠ• áˆ›áŒ½á‹³á‰µ

            // á‹¨áŒŠá‹œ áŒˆá‹°á‰¡áŠ• (Cooldown) áˆ›áˆ¨áŒ‹áŒˆáŒ¥
            const { isReady } = checkDailyLimit(timestampField);

            if (isReady || isReset) {
                // 1. áŒ¨á‹‹á‰³á‹ á‹áŒáŒ áŠá‹
                isScratchGameActive = true;
                
                // 2. á‹¨á‹˜áˆá‰€á‹° áˆ½áˆáˆ›á‰µ áˆ˜áˆáˆ¨áŒ¥
                scratchPrizeAmount = SCRATCH_PRIZES[Math.floor(Math.random() * SCRATCH_PRIZES.length)];
                prizeTextEl.innerHTML = `<span>+${scratchPrizeAmount.toLocaleString()} ğŸ’°</span>`;
                
                // 3. á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áˆ¸áˆ« (Canvas) áˆ˜áˆ™áˆ‹á‰µ
                // (áˆˆáˆáˆ³áˆŒ á‰ áŒáˆ«áŒ«áˆ› á‰€áˆˆáˆ)
                scratchCtx.globalCompositeOperation = 'source-over'; // á‹ˆá‹° áˆ˜á‹°á‰ áŠ› á‹¨áˆµáŠ¥áˆ áˆáŠ“á‰´ áˆ˜áˆ˜áˆˆáˆµ
                scratchCtx.fillStyle = '#AAAAAA'; // á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹ á‰€áˆˆáˆ
                scratchCtx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
                // áŠ¨áˆ‹á‹­ áŒ½áˆá áˆ˜áŒ¨áˆ˜áˆ­ (áŠ áˆ›áˆ«áŒ­)
                scratchCtx.fillStyle = '#333333';
                scratchCtx.font = 'bold 20px Arial';
                scratchCtx.textAlign = 'center';
                scratchCtx.fillText('SCRATCH HERE', scratchCanvas.width / 2, scratchCanvas.height / 2 + 8);
                
                // 4. Event Listeners áˆ˜áŒ¨áˆ˜áˆ­ (á‹«áˆá‰°á‹°áŒˆáˆ™ áˆ˜áˆ†áŠ“á‰¸á‹áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥ áŠ á‹«áˆµáˆáˆáŒáˆá£ á‰  init áŒŠá‹œ á‰¥á‰» áŠá‹)
                scratchCanvas.addEventListener('mousedown', startScratch);
                scratchCanvas.addEventListener('mousemove', scratch);
                window.addEventListener('mouseup', stopScratch); // áˆ˜áˆµáŠ®á‰± áˆ‹á‹­
                
                scratchCanvas.addEventListener('touchstart', startScratch, { passive: false });
                scratchCanvas.addEventListener('touchmove', scratch, { passive: false });
                window.addEventListener('touchend', stopScratch);

                // 5. UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
                messageEl.innerText = 'áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆá‰…áˆá‰… áˆ½áˆáˆ›á‰µá‹áŠ• á‹«áŒáŠ™!';
                actionButton.style.display = 'none'; // áŠ á‹áˆ«áˆ©áŠ• áˆ˜á‹°á‰ á‰…
                scratchCanvas.style.display = 'block'; // áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áˆ›áˆ³á‹¨á‰µ

            } else {
                // 1. áŒ¨á‹‹á‰³á‹ á‹áŒáŒ áŠ á‹­á‹°áˆˆáˆ (Cooldown áˆ‹á‹­ áŠá‹)
                isScratchGameActive = false;
                
                // 2. áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áˆ˜á‹°á‰ á‰… áŠ¥áŠ“ "áŠ áˆá‰‹áˆ" á‹¨áˆšáˆ áˆ›áˆ³á‹¨á‰µ
                scratchCanvas.style.display = 'none';
                prizeTextEl.innerHTML = '<span>ğŸš«<br>áˆˆá‹›áˆ¬ á‰°áŒ áŠ“á‰‹áˆ</span>';
                
                // 3. UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
                messageEl.innerText = 'áŒŠá‹œá‹ áŠ¥áˆµáŠªá‹«áˆá‰… á‹­áŒ á‰¥á‰á¢';
                actionButton.innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
                actionButton.style.display = 'block';
                actionButton.disabled = false;
                actionButton.onclick = window.showMainPage;
            }
            
            // á‹¨áŒŠá‹œ á‰†áŒ£áˆªá‹áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ (á‹áŒáŒáˆ á‰£á‹­áˆ†áŠ•áˆ)
            startCooldownTimer(timestampField, 'scratch-card-timer', 'scratch-card-action');
        }
        
        // ======================================================================
        //                          SCRATCH CARD GAME CODE áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================





// ======================================================================
// âœ… ğŸ›‘ áŠ á‹²áˆµ: áˆˆ Exchange Page á‹¨áˆšáˆ†áŠ‘ áˆ¨á‹³á‰µ á‰°áŒá‰£áˆ«á‰µ
// ======================================================================

const EXCHANGE_RATE = 10000; // 10,000 Coin = 1 Smart Coin

// [+] áŠ¥áŠ“ [-] áŠ á‹áˆ«áˆ®á‰½áŠ• áŠ¥áŠ•á‹²áˆ°áˆ« á‹«á‹°áˆ­áŒ‹áˆ
window.adjustExchangeInput = (amount) => {
    const inputEl = document.getElementById('exchangePointsInput');
    let currentValue = parseInt(inputEl.value) || 0;
    let newValue = currentValue + amount;

    // áŠ¨á‹á‰…á‰°áŠ›á‹ áˆáŒ£áŠ” (Rate) á‰ á‰³á‰½ áŠ¥áŠ•á‹³á‹­á‹ˆáˆ­á‹µ
    if (newValue < EXCHANGE_RATE) {
        newValue = EXCHANGE_RATE;
    }
    
    // âœ… áŠ«áˆˆáŠ• "Coin" (currentScore) áŠ¥áŠ•á‹³á‹­á‰ áˆáŒ¥
    if (newValue > currentScore) {
        newValue = currentScore;
    }
    
    inputEl.value = newValue;
    window.calculateSmartCoin(); // á‹áŒ¤á‰±áŠ• á‹«áˆ°áˆ‹áˆ
}

// áˆáŠ• á‹«áˆ…áˆ "Smart Coin" áŠ¥áŠ•á‹°áˆáŠ“áŒˆáŠ á‹«áˆ°áˆ‹áˆ
window.calculateSmartCoin = () => {
    const inputEl = document.getElementById('exchangePointsInput');
    const resultEl = document.getElementById('smartCoinResult');
    let pointsToExchange = parseInt(inputEl.value) || 0;
    
    let smartCoinsToGet = 0;
    
    // á‰µáŠ­áŠ­áˆˆáŠ› á‹¨ 10,000 á‰¥á‹œá‰µ áˆ˜áˆ†áŠ‘áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
    if (pointsToExchange >= EXCHANGE_RATE && pointsToExchange % EXCHANGE_RATE === 0) {
        smartCoinsToGet = pointsToExchange / EXCHANGE_RATE;
        resultEl.innerText = `${smartCoinsToGet.toLocaleString()} Smart Coin`;
    } else {
        resultEl.innerText = "0 Smart Coin";
    }
    
    window.validateExchangeButton(); // áŠ á‹áˆ«áˆ©áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
}

// á‹¨ "EXCHANGE NOW" áŠ á‹áˆ«áˆ­áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
window.validateExchangeButton = () => {
    const inputEl = document.getElementById('exchangePointsInput');
    const buttonEl = document.getElementById('finalExchangeButton');
    let pointsToExchange = parseInt(inputEl.value) || 0;

    const isValid = pointsToExchange >= EXCHANGE_RATE && 
                    pointsToExchange <= currentScore && 
                    pointsToExchange % EXCHANGE_RATE === 0;

    if (isValid) {
        buttonEl.disabled = false;
        buttonEl.classList.remove('disabled-btn');
        // âœ… á‰€áˆˆáˆ™áŠ• áŠ¨áˆŒáˆá‰½ áŠ á‹áˆ«áˆ®á‰½ áŒ‹áˆ­ áŠ áˆµá‰°áŠ«áŠ­áˆˆáŠá‹‹áˆ
        buttonEl.style.backgroundColor = 'var(--et-green)'; 
        buttonEl.style.cursor = 'pointer';
    } else {
        buttonEl.disabled = true;
        buttonEl.classList.add('disabled-btn');
        buttonEl.style.backgroundColor = '#555';
        buttonEl.style.cursor = 'not-allowed';
    }
}



        // ======================================================================
        //                          EXCHANGE PAGE CODE 
        // ======================================================================
        
        document.addEventListener('input', (event) => {
            if (event.target.id === 'exchangePointsInput') {
                const enteredPoints = parseInt(event.target.value); 
                const changeButton = document.getElementById('finalChangeButton');
                const availableScore = currentScore; 
                const requiredMinimum = 10000;

                const isValid = enteredPoints >= requiredMinimum && 
                                enteredPoints % 10000 === 0 &&
                                enteredPoints <= availableScore;

                if (isValid) {
                    changeButton.disabled = false;
                    changeButton.style.backgroundColor = 'var(--et-red)'; 
                    changeButton.style.cursor = 'pointer';
                } else {
                    changeButton.disabled = true;
                    changeButton.style.backgroundColor = '#a0a0a0';
                    changeButton.style.cursor = 'not-allowed';
                }
            }
        });
// âœ…âœ…âœ… á‹­áˆ„ áˆ™áˆ‰ á‰ áˆ™áˆ‰ áŠ á‹²áˆ± á‹¨ Exchange Button áŠ áˆ˜áŠ­áŠ•á‹® áŠá‹ âœ…âœ…âœ…
document.addEventListener('click', async (event) => {
    if (event.target.id === 'finalExchangeButton' && !event.target.disabled) {

        const pointsInput = document.getElementById('exchangePointsInput');
        const changeButton = document.getElementById('finalExchangeButton');
        const exchangeMessage = document.getElementById('exchangeMessage');

        const pointsToExchange = parseInt(pointsInput.value); // á‹­áˆ„ "Coin" áŠá‹

        // á‹¨áˆá‹á‹áŒ¥ áˆáŒ£áŠ” (Rate)
        const EXCHANGE_RATE = 10000; // 10,000 Coin = 1 Smart Coin

        // áˆáŠ• á‹«áˆ…áˆ "Smart Coin" áŠ¥áŠ•á‹°áˆšá‹«áŒˆáŠ áŠ¥áŠ“áˆµáˆ‹
        const smartCoinsToGet = pointsToExchange / EXCHANGE_RATE;

        if (pointsToExchange < EXCHANGE_RATE || pointsToExchange % EXCHANGE_RATE !== 0) {
            exchangeMessage.style.color = '#F44336';
            exchangeMessage.innerText = `âŒ áˆá‹á‹áŒ¡ á‰¢á‹«áŠ•áˆµ ${EXCHANGE_RATE.toLocaleString()} Coin á‹ˆá‹­áˆ á‰¥á‹œá‰¶á‰¹ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µá¢`;
            return;
        }

        if (currentScore < pointsToExchange) {
            exchangeMessage.style.color = '#F44336';
            exchangeMessage.innerText = 'âŒ á‹­á‰…áˆ­á‰³á£ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢';
            return;
        }

        changeButton.disabled = true;
        changeButton.innerText = 'á‰ áˆ˜á‰€á‹¨áˆ­ áˆ‹á‹­...';

        // === á‹­áˆ„ áŠá‹ á‹‹áŠ“á‹ á‹¨áˆá‹á‹áŒ¥ áŠ áˆ˜áŠ­áŠ•á‹® ===
        const userRef = doc(db, "users", currentFirebaseUserId); 

        try {
            // "Coin" (total_score) áŠ¥áŠ•á‰€áŠ•áˆ³áˆˆáŠ•
            // "Smart Coin" (smart_coin_balance) áŠ¥áŠ•á‹°áˆáˆ«áˆˆáŠ•
            // á‹­áˆ„ á‰ áŠ áŠ•á‹µ áˆ‹á‹­ (atomically) á‹­áˆ°áˆ«áˆ
            await updateDoc(userRef, {
                total_score: increment(pointsToExchange * -1),
                smart_coin_balance: increment(smartCoinsToGet)
            });

            // á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ¨á‰°áˆˆá‹ˆáŒ 
            exchangeMessage.style.color = 'var(--et-green)';
            exchangeMessage.innerText = `âœ… áˆá‹á‹áŒ¥ á‰°áˆ³áŠ­á‰·áˆ! +${smartCoinsToGet.toLocaleString()} Smart Coin áŠ áŒáŠá‰°á‹‹áˆá¢`;

            // Global á‰°áˆˆá‹‹á‹‹áŒ®á‰½áŠ• á‹ˆá‹²á‹«á‹áŠ‘ áˆ›á‹˜áˆ˜áŠ• (onSnapshot áŠ¥áˆµáŠªáˆ˜áŒ£ áŠ¨áˆ˜áŒ á‰ á‰… á‹­áˆá‰…)
            currentScore -= pointsToExchange;
            currentSmartCoinBalance += smartCoinsToGet;
            window.saveGeneralHistory('Swap', pointsToExchange, 'Coin', 'Success');

            // á‹¨ Profile áŠ¥áŠ“ Tasks áŒˆáŒ½ UI áˆ›á‹˜áˆ˜áŠ•
            renderPageContent(); 

        } catch (error) {
            exchangeMessage.style.color = '#F44336';
            exchangeMessage.innerText = `âŒ á‰ áˆá‹á‹áŒ¥ á‹ˆá‰…á‰µ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ: ${error.message}`;
        }

        // === á‹¨áˆá‹á‹áŒ¥ áŠ áˆ˜áŠ­áŠ•á‹® áŠ¥á‹šáˆ… á‹«á‰ á‰ƒáˆ ===

        changeButton.innerText = 'EXCHANGE NOW';
        changeButton.disabled = true; // áŠ¥áŠ•á‹°áŒˆáŠ“ validate áˆ›á‹µáˆ¨áŒ áˆµáˆ‹áˆˆá‰ á‰µ
        pointsInput.value = EXCHANGE_RATE.toString(); // á‹ˆá‹° áˆ˜áŒ€áˆ˜áˆªá‹«á‹ á‹­áˆ˜áˆáˆ°á‹
        calculateSmartCoin(); // UI á‹«á‹˜áˆáŠ“áˆ

        setTimeout(() => {
            exchangeMessage.innerText = '';
        }, 5000);
    }

    // ... (á‹«áŠ•á‰° á‹¨á‹µáˆ®á‹ á‹¨ 'finalChangeButton' áŠ áˆ˜áŠ­áŠ•á‹® áŠ¥á‹šáˆ… áŒ‹áˆ­ á‹­á‹ˆáŒˆá‹³áˆ) ...
});

// ğŸ›‘ áˆ›áˆ³áˆ°á‰¢á‹«: `submitExchangeRequest` á‹¨áˆšáˆˆá‹áŠ• á‰°áŒá‰£áˆ­ (function) áŠ¨áŠ®á‹µáˆ… á‹áˆµáŒ¥ áˆ™áˆ‰ áˆˆáˆ™áˆ‰ áˆ›áˆµá‹ˆáŒˆá‹µ á‰µá‰½áˆ‹áˆˆáˆ…á¢


        
        // ======================================================================
        //                          EXCHANGE PAGE CODE áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================


// =========================================================
// âœ… TRANSACTION HISTORY LOGIC
// =========================================================

// 1. á‰³áˆªáŠ­áŠ• áŠ¨ LocalStorage áˆ›áˆáŒ£á‰µ
const getGeneralHistory = () => {
    try {
        const history = localStorage.getItem('generalTransactionHistory');
        return JSON.parse(history || '[]');
    } catch (e) {
        return [];
    }
};

// 2. áŠ á‹²áˆµ á‰³áˆªáŠ­ áˆ˜áˆ˜á‹áŒˆá‰¥ (á‹­áˆ…áŠ•áŠ• á‰  Swap áŠ¥áŠ“ Withdraw áŒŠá‹œ áŠ¥áŠ•áŒ áˆ«á‹‹áˆˆáŠ•)
window.saveGeneralHistory = (type, amount, coinType, status) => {
    let history = getGeneralHistory();
    
    const newEntry = {
        id: Date.now(), // Unique ID
        date: new Date().toLocaleString(),
        type: type,       // 'Swap' or 'Withdraw'
        amount: amount,
        coinType: coinType, // 'Coin' or 'Smart Coin'
        status: status    // 'Success', 'Pending'
    };

    history.unshift(newEntry); // áŠ á‹²áˆ±áŠ• á‹ˆá‹° áˆ‹á‹­ áŠ áˆáŒ£
    if (history.length > 30) history.pop(); // áŠ¨30 á‰ áˆ‹á‹­ áŠ¨áˆ†áŠ á‹¨á‹µáˆ®á‹áŠ• áŠ áŒ¥á‹
    
    localStorage.setItem('generalTransactionHistory', JSON.stringify(history));
};

// 3. á‰³áˆªáŠ©áŠ• á‰ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ áˆ›áˆ³á‹¨á‰µ
window.renderTransactionHistory = () => {
    const listContainer = document.getElementById('general-history-list');
    const history = getGeneralHistory();

    if (history.length === 0) {
        listContainer.innerHTML = '<p style="text-align: center; color: #888; margin-top: 20px;">áˆáŠ•áˆ á‹¨á‰°áˆ˜á‹˜áŒˆá‰  á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>';
        return;
    }

    let htmlContent = '';
    
    history.forEach(item => {
        let icon = '';
        let colorClass = '';
        let amountSign = '';

        // áˆˆáŠ¥á‹­á‰³ á‹¨áˆšáˆ†áŠ• á‰€áˆˆáˆ áŠ¥áŠ“ áˆáˆáŠ­á‰µ áˆ˜áˆáˆ¨áŒ¥
        if (item.type === 'Swap') {
            icon = 'ğŸ’±';
            colorClass = '#FFC107'; // á‰¢áŒ« (Swap)
            amountSign = '-';
        } else if (item.type === 'Withdraw') {
            icon = 'ğŸ’¸';
            colorClass = '#F44336'; // á‰€á‹­ (Withdraw)
            amountSign = '-';
        } else if (item.type === 'Deposit' || item.type === 'Reward') {
            icon = 'ğŸ’°';
            colorClass = '#4CAF50'; // áŠ áˆ¨áŠ•áŒ“á‹´
            amountSign = '+';
        }

        htmlContent += `
            <div class="modern-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 15px; text-align: left;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 24px; background: #333; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">${icon}</div>
                    <div>
                        <div style="font-weight: bold; font-size: 16px; color: white;">${item.type}</div>
                        <div style="font-size: 12px; color: #888;">${item.date}</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: bold; font-size: 16px; color: ${colorClass};">
                        ${amountSign}${item.amount.toLocaleString()}
                    </div>
                    <div style="font-size: 11px; color: #aaa;">${item.coinType}</div>
                    <div style="font-size: 10px; margin-top: 2px; color: ${item.status === 'Success' ? '#4CAF50' : '#FF9800'}">
                        ${item.status}
                    </div>
                </div>
            </div>
        `;
    });

    listContainer.innerHTML = htmlContent;
};

// 4. áŒˆáŒ¹áŠ• áˆ˜áŠ­áˆá‰» Function
window.showTransactionHistory = () => {
    window.renderTransactionHistory(); // áˆ˜áŒ€áˆ˜áˆªá‹« á‰³áˆªáŠ©áŠ• áŒ«áŠ•
    switchPage('transaction-history-page'); // áŒˆáŒ¹áŠ• áŠ­áˆá‰µ
};

        
 

        // ======================================================================
        // âœ… ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (WITHDRAWAL PAGE) áŠ®á‹µ
        // ======================================================================

        let selectedWithdrawMethod = null;
        let selectedWithdrawFee = 0;
        const MIN_WITHDRAWAL = 100; // á‹á‰…á‰°áŠ› áˆ›á‹áŒ«

        // á‹¨áˆ˜á‹áŒ« á‹˜á‹´á‹á‰½ áŠ¥áŠ“ áŠ­áá‹«á‹á‰»á‰¸á‹ (á‰ áˆ˜á‰¶áŠ›)
        const withdrawFees = {
            telegram: 0.01, // 1%
            crypto: 0.015,  // 1.5%
            paypal: 0.02    // 2%
        };

        /**
         * á‹¨áˆ˜á‹áŒ« áˆ˜áŒ áŠ• áˆ˜á‰†áŒ£áŒ áˆªá‹« (+/-)
         */
        window.adjustWithdrawInput = (amount) => {
            const inputEl = document.getElementById('withdrawAmountInput');
            let currentValue = parseInt(inputEl.value) || 0;
            let newValue = currentValue + amount;

            if (newValue < MIN_WITHDRAWAL) {
                newValue = MIN_WITHDRAWAL;
            }
            
            
    if (newValue > currentSmartCoinBalance) { 
        newValue = currentSmartCoinBalance;
    }
}
        /**
         * á‹¨áˆ˜áŠ­áˆá‹« á‹˜á‹´ áˆ˜áˆáˆ¨áŒ«
         */
        window.selectMethod = (method, element) => {
            // áˆáˆ‰áŠ•áˆ .active áŠ¨ .method-wrapper áˆ›áˆµá‹ˆáŒˆá‹µ
            document.querySelectorAll('#withdraw-page .method-wrapper').forEach(wrapper => {
                wrapper.classList.remove('active');
            });

            // á‹¨á‰°áŒ«áŠá‹áŠ• .active áˆ›á‹µáˆ¨áŒ
            const parentWrapper = element.closest('.method-wrapper');
            if (parentWrapper) {
                parentWrapper.classList.add('active');
            }

            selectedWithdrawMethod = method;
            selectedWithdrawFee = withdrawFees[method] || 0;
            
            window.validateWithdrawal(); // á‹˜á‹´ áˆ²áˆ˜áˆ¨áŒ¥ áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        }

        /**
         * áŒˆáŒ¹áŠ• á‹¨áˆšá‹«áˆ¨áŒ‹áŒáŒ¥ á‹‹áŠ“ á‰°áŒá‰£áˆ­ (Validation)
         */
          /**
 * áŒˆáŒ¹áŠ• á‹¨áˆšá‹«áˆ¨áŒ‹áŒáŒ¥ á‹‹áŠ“ á‰°áŒá‰£áˆ­ (Validation)
 */
window.validateWithdrawal = () => {
    const inputEl = document.getElementById('withdrawAmountInput');
    const messageEl = document.getElementById('withdrawMessage');
    const buttonEl = document.getElementById('finalWithdrawButton');
    
    const amount = parseInt(inputEl.value) || 0;
    
    // 1. á‹˜á‹´ á‰°áˆ˜áˆ­áŒ§áˆ?
    if (!selectedWithdrawMethod) {
        messageEl.innerText = "âš ï¸ áŠ¥á‰£áŠ­á‹ á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡á¢";
        buttonEl.classList.add('disabled-btn');
        buttonEl.disabled = true;
        return;
    }
    
    // 2. áˆ˜áŒ áŠ‘ áŠ¨á‹á‰…á‰°áŠ›á‹ á‹«áŠ•áˆ³áˆ?
    if (amount < MIN_WITHDRAWAL) {
        messageEl.innerText = `âš ï¸ á‹á‰…á‰°áŠ›á‹ á‹¨áˆ›á‹áŒ« áˆ˜áŒ áŠ• ${MIN_WITHDRAWAL} áŠá‹á¢`;
        buttonEl.classList.add('disabled-btn');
        buttonEl.disabled = true;
        return;
    }
    
    // 3. áŠ­áá‹« (Fee) áˆ›áˆµáˆ‹á‰µ
    const feeAmount = Math.ceil(amount * selectedWithdrawFee);
    const totalDeducted = amount + feeAmount;
    
    // 4. âœ…âœ…âœ… áˆ›áˆµá‰°áŠ«áŠ¨á‹«á‹ áŠ¥á‹šáˆ… áŒ‹áˆ­ áŠá‹ âœ…âœ…âœ…
    // "currentScore" á‹¨áŠá‰ áˆ¨á‹ á‹ˆá‹° "currentSmartCoinBalance" á‰°á‰€á‹­áˆ¯áˆ
    if (totalDeducted > currentSmartCoinBalance) { 
        messageEl.innerText = `âš ï¸ á‰ á‰‚ Smart Coin á‹¨áˆˆá‹á‰µáˆá¢ (áŠ­áá‹«áŠ• áŒ¨áˆáˆ® ${totalDeducted} á‹«áˆµáˆáˆáŒ‹áˆ)`;
        buttonEl.classList.add('disabled-btn');
        buttonEl.disabled = true;
        return;
    }
    
    // 5. áˆáˆ‰áˆ áŠáŒˆáˆ­ á‰µáŠ­áŠ­áˆ áŠ¨áˆ†áŠ
    messageEl.innerText = `Fee: ${feeAmount} | Total: ${totalDeducted} (To receive: ${amount})`;
    messageEl.style.color = 'var(--et-green, #4CAF50)'; // áŠ áˆ¨áŠ•áŒ“á‹´ á‰€áˆˆáˆ
    buttonEl.classList.remove('disabled-btn');
    buttonEl.disabled = false;
}


/**
 * á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ£á‰µ áŒ¥á‹«á‰„áŠ• á‹ˆá‹° Firebase áˆ˜áˆ‹áŠ­
 */
// ======================================================================
// âœ… ğŸ›‘ áŒŠá‹œá‹«á‹Š áˆ›áˆµá‰°áŠ«áŠ¨á‹«: WithdrawaláŠ• áˆˆáŒŠá‹œá‹ áˆ˜á‹áŒ‹á‰µ
// ======================================================================
window.initiateWithdrawal = async () => {
    const messageEl = document.getElementById('withdrawMessage');
    const buttonEl = document.getElementById('finalWithdrawButton');
    const inputEl = document.getElementById('withdrawAmountInput'); 
    
    // 1. áˆ˜áŒ áŠ‘áŠ• á‹ˆá‹° á‰áŒ¥áˆ­ áˆ˜á‰€á‹¨áˆ­
    const amount = parseInt(inputEl.value) || 0;

    // 2. áŠ á‹áˆ«áˆ©áŠ• áˆˆáŒŠá‹œá‹ áˆ›á‰¦á‹˜áŠ• (Processing...)
    buttonEl.disabled = true;
    buttonEl.innerHTML = 'PROCESSING...';

    // 3. á‰³áˆªáŠ©áŠ• áˆ˜áˆ˜á‹áŒˆá‰¥ á‰¥á‰» (áŒˆáŠ•á‹˜á‰¥ áŠ á‹­á‰€áŠ•áˆµáˆ!)
    // "Pending" á‰¥áˆˆáŠ• áˆµáˆˆáˆáŠ•áˆ˜á‹˜áŒá‰ á‹á£ á‰°áŒ á‰ƒáˆšá‹ áŒ¥á‹«á‰„á‹ áŠ¥áŠ•á‹°á‹°áˆ¨áˆ° á‹­áˆ¨á‹³áˆ
    window.saveGeneralHistory('Withdraw', amount, 'Smart Coin', 'Pending');

    // ğŸ›‘ áˆ›áˆ³áˆ°á‰¢á‹«: áŠ¥á‹šáˆ… áŒ‹áˆ­ "currentSmartCoinBalance -= amount" á‹¨áˆšáˆ áŠ®á‹µ á‹¨áˆˆáˆá¢
    // áˆµáˆˆá‹šáˆ… áŠ¨áˆ°á‹á‹¨á‹ áŠ áŒ á‰ƒáˆ‹á‹­ áˆ‚áˆ³á‰¥ áˆ‹á‹­ áˆáŠ•áˆ áŠ á‹­á‰€áŠáˆµáˆá¢

    // 4. á‹¨áˆ›áˆ³á‹ˆá‰‚á‹« áˆ˜áˆá‹•áŠ­á‰µ áˆ˜áˆµáŒ á‰µ
    messageEl.style.color = 'var(--et-yellow)';
    messageEl.innerText = "âš ï¸ áŒ¥á‹«á‰„á‹ á‰°áˆ˜á‹áŒá‰§áˆ (Pending)! á‰°áŒá‰£áˆ© áˆ²áŒ€áˆ˜áˆ­ áˆ›á‹áŒ£á‰µ á‹­á‰½áˆ‹áˆ‰á¢";
    
    // 5. áŠ¨ 2 áˆ°áŠ¨áŠ•á‹µ á‰ áŠ‹áˆ‹ áŠ á‹áˆ«áˆ©áŠ• áˆ˜áˆ˜áˆˆáˆµ
    setTimeout(() => {
        messageEl.innerText = "";
        buttonEl.innerHTML = 'WITHDRAW NOW';
        buttonEl.disabled = false;
        // áŠ á‹áˆ«áˆ© áŠ¥áŠ•á‹°áŒˆáŠ“ áŠ¥áŠ•á‹²áˆ°áˆ« validateWithdrawaláŠ• áŠ¥áŠ•áŒ áˆ«áˆˆáŠ•
        window.validateWithdrawal(); 
    }, 2000);
}


        // ======================================================================
        // âœ… ğŸ›‘ á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (WITHDRAWAL PAGE) áŠ®á‹µ áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================






// ======================================================================
// ======================================================================
// âœ… ğŸ›‘ áŠ á‹²áˆµ: KENO GAME LOGIC (áŠ¨ Firebase áŒ‹áˆ­ á‹¨á‰°á‹‹áˆƒá‹°)
// ======================================================================
// ======================================================================

// á‹¨ Keno áŒ¨á‹‹á‰³ á‰…áŠ•á‰¥áˆ®á‰½
const KENO_TOTAL_NUMBERS = 80; 
const KENO_MAX_PICKS = 10;     
const KENO_DRAW_COUNT = 20;    
const KENO_DRAW_INTERVAL = 1000; // ááŒ¥áŠá‰±áŠ• áŒ¨áˆáˆ¬á‹‹áˆˆáˆ
const KENO_MIN_BET = 100; 

// á‹¨ Keno áŒ¨á‹‹á‰³ á‰°áˆˆá‹‹á‹‹áŒ®á‰½
let kenoTotalPoints = 0; // á‰  Firebase coin á‹­á‰°áŠ«áˆ
let kenoSelectedNumbers = [];
let kenoDrawnNumbers = [];
let kenoBetAmount = KENO_MIN_BET;
let kenoGameInProgress = false;
let kenoLastBetAmount = KENO_MIN_BET; 
let kenoLastSelectedNumbers = [];
// History á‰  localStorage á‹­á‰€áˆ˜áŒ£áˆ (áŠ¨ Firebase áŠáŒ»)
let kenoGameHistory = JSON.parse(localStorage.getItem('kenoHistory') || '[]');

// á‹¨ Keno UI áŠ¤áˆˆáˆ˜áŠ•á‰¶á‰½ (á‰  initKenoGame á‹áˆµáŒ¥ á‹­áŒ«áŠ“áˆ‰)
let kenoTotalPointsEl, kenoGridEl, kenoBetAmountInput, kenoBetBtn, kenoPickInfoEl, kenoMessageEl, kenoSelectedPicksAreaEl, kenoDrawShakerAreaEl, kenoDrawCountAreaEl, kenoDrawStatusEl, kenoRandomPickBtn, kenoHistoryListEl, kenoPaytableContentEl, kenoCurrentBallAreaEl;

/**
 * á‹¨ Keno áŒˆáŒ½ áˆ²áŠ¨áˆá‰µ á‹­áˆ… á‰°áŒá‰£áˆ­ á‹­áŒ áˆ«áˆ
 */
window.initKenoGame = () => {
    // 1. á‹¨ UI áŠ¤áˆˆáˆ˜áŠ•á‰¶á‰½áŠ• áˆ›áŒáŠ˜á‰µ
    kenoTotalPointsEl = document.getElementById('keno-total-points');
    kenoGridEl = document.getElementById('keno-grid');
    kenoBetAmountInput = document.getElementById('keno-bet-amount-input');
    kenoBetBtn = document.getElementById('keno-bet-btn');
    kenoPickInfoEl = document.getElementById('keno-pick-info');
    kenoMessageEl = document.getElementById('keno-message');
    kenoSelectedPicksAreaEl = document.getElementById('keno-selected-picks-area');
    kenoDrawShakerAreaEl = document.getElementById('keno-draw-shaker-area');
    kenoDrawCountAreaEl = document.getElementById('keno-draw-count-area');
    kenoDrawStatusEl = document.getElementById('keno-draw-status');
    kenoRandomPickBtn = document.getElementById('keno-random-pick-btn');
    kenoHistoryListEl = document.getElementById('keno-history-list');
    kenoPaytableContentEl = document.getElementById('keno-paytable-content');
    kenoCurrentBallAreaEl = document.getElementById('keno-current-ball-area');

    // 2. âœ… á‹¨ Firebase coináŠ• áˆ˜áŒ«áŠ•
    kenoTotalPoints = currentScore; // áŠ¨á‹‹áŠ“á‹ áˆ˜á‰°áŒá‰ áˆªá‹« coin áˆ˜á‹áˆ°á‹µ
    kenoBetAmount = KENO_MIN_BET;
    
    // 3. áŒ¨á‹‹á‰³á‹áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
    window.kenoCreateGrid();
    window.kenoRenderHistory(); 
    window.kenoResetGame(); 
    window.kenoRenderPaytable();
    
    // 4. UI áˆ›á‹˜áˆ˜áŠ•
    window.kenoUpdateUI();
}

// ------------------- KENO TAB LOGIC -------------------
window.kenoShowTab = (tabId, clickedButton) => {
    document.querySelectorAll('#keno-game-page .keno-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('#keno-game-page .keno-tab-button').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('active');
    if (clickedButton) {
        clickedButton.classList.add('active');
    }
    
    if (tabId === 'keno-history-tab') {
        window.kenoRenderHistory();
    } else if (tabId === 'keno-results-tab') {
        window.kenoRenderPaytable();
    }
}

window.kenoRenderPaytable = () => {
    const paytableData = [
        {picks: 1, payouts: {1: '10x'}},
        {picks: 3, payouts: {2: '1x', 3: '100x'}},
        {picks: 5, payouts: {3: '1x', 4: '10x', 5: '500x'}},
        {picks: 7, payouts: {4: '3x', 5: '30x', 6: '200x', 7: '5000x'}},
        {picks: 10, payouts: {3: 1, 4: '2x', 5: '10x', 6: '50x', 7: '100x', 8: '500x', 9: '5000x', 10: '25000x'}}
    ];
    
    if (!kenoPaytableContentEl) return;
    kenoPaytableContentEl.innerHTML = ''; 
    
    paytableData.forEach(item => {
        const card = document.createElement('div');
        card.className = 'keno-paytable-card';
        let tableHtml = '<table><thead><tr><th>Matches</th><th>Multiplier (x)</th></tr></thead><tbody>';
        Object.entries(item.payouts).forEach(([matches, multiplier]) => {
            tableHtml += `<tr><td>${matches} ${matches == 1 ? 'Hit' : 'Hits'}</td><td>${multiplier}</td></tr>`;
        });
        tableHtml += '</tbody></table>';
        card.innerHTML = `<div class="keno-paytable-header">${item.picks} ${item.picks === 1 ? 'Pick' : 'Picks'}</div>${tableHtml}`;
        kenoPaytableContentEl.appendChild(card);
    });
}

// ------------------- KENO GAME LOGIC -------------------

window.kenoUpdateUI = () => {
    if (!kenoTotalPointsEl) return; // áŒˆáŒ¹ áŠ«áˆá‰°áŒ«áŠ áˆ˜á‹áŒ£á‰µ
    
    // âœ… á‹¨ Firebase coináŠ• áˆ›áŠ•á‰ á‰¥
    kenoTotalPoints = currentScore;
    
    kenoTotalPointsEl.textContent = `${kenoTotalPoints.toFixed(2)} Coin`; 
    
    if (kenoBetAmount < KENO_MIN_BET) kenoBetAmount = KENO_MIN_BET;
    // âœ… áŠ¨áá‰°áŠ›á‹ á‹áˆ­áˆ­á‹µ áŠ«áˆˆá‹á‰µ coin áŒ‹áˆ­ áˆ›áˆµá‰°áŠ«áŠ¨áˆ
    if (kenoBetAmount > kenoTotalPoints) kenoBetAmount = kenoTotalPoints;
    
    // á‰°áŒ á‰ƒáˆšá‹ á‰ áŠ¥áŒ… áŠ¨á‰€á‹¨áˆ¨
    if (parseFloat(kenoBetAmountInput.value) > kenoTotalPoints) {
        kenoBetAmount = kenoTotalPoints;
    }
    
    kenoBetAmountInput.value = kenoBetAmount.toFixed(0); // .00 áŠ áˆµá‹ˆáŒáŒƒáˆˆáˆ
    kenoBetAmountInput.min = KENO_MIN_BET;
    
    kenoPickInfoEl.textContent = `${kenoSelectedNumbers.length} Picks | Select up to ${KENO_MAX_PICKS} numbers`;
    kenoSelectedPicksAreaEl.innerHTML = `á‹¨áˆ˜áˆ¨áŒ§á‰¸á‹ á‰áŒ¥áˆ®á‰½: <span style="font-weight: bold;">[ ${kenoSelectedNumbers.sort((a, b) => a - b).join(', ')} ]</span>`; 
    
    const canBet = kenoSelectedNumbers.length > 0 && 
                   kenoSelectedNumbers.length <= KENO_MAX_PICKS && 
                   kenoBetAmount <= kenoTotalPoints && 
                   !kenoGameInProgress && 
                   kenoTotalPoints >= KENO_MIN_BET;
                   
    kenoBetBtn.disabled = !canBet;
    
    // á‹¨áˆ˜áˆá‹•áŠ­á‰µ áˆµáˆ­á‹“á‰µ
    if (kenoTotalPoints < KENO_MIN_BET) {
        kenoMessageEl.textContent = "ğŸ˜” Coin áŠ áˆá‰‹áˆ! áˆˆáˆ˜áŒ«á‹ˆá‰µ á‰¢á‹«áŠ•áˆµ 100 Coin á‹«áˆµáˆáˆáŒá‹á‰³áˆá¢";
        kenoBetBtn.disabled = true;
    } else if (kenoBetAmount > kenoTotalPoints) {
        kenoMessageEl.textContent = "âš ï¸ á‹¨á‹áˆ­áˆ­á‹µ áˆ˜áŒ áŠ•á‹ áŠ¨Coiná‹ á‹­á‰ áˆáŒ£áˆá¢";
        kenoBetBtn.disabled = true;
    } else if (kenoSelectedNumbers.length === 0 && !kenoGameInProgress) {
        kenoMessageEl.textContent = "â–¶ï¸ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰áŒ¥áˆ­ á‹­áˆáˆ¨áŒ¡á¢";
    } else if (!kenoGameInProgress) {
        kenoMessageEl.textContent = "âœ… á‰áŒ¥áˆ®á‰½ á‰°áˆ˜áˆ­áŒ á‹‹áˆ! áŠ áˆáŠ• BET á‹­áŒ«áŠ‘á¢";
    }
}

window.kenoChangeBet = (amount) => {
    let newBet = kenoBetAmount + amount;
    if (newBet < KENO_MIN_BET) newBet = KENO_MIN_BET; 
    
    // âœ… á‹¨ Firebase coináŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    kenoTotalPoints = currentScore;
    if (newBet > kenoTotalPoints) newBet = kenoTotalPoints;
    
    kenoBetAmount = newBet;
    window.kenoUpdateUI();
};

// á‹¨ Bet Input áˆˆá‹áŒ¥áŠ• áˆ›á‹³áˆ˜áŒ¥ (áŠ áŠ•á‹µ áŒŠá‹œ á‰¥á‰»)
document.addEventListener('input', (event) => {
    if (event.target.id === 'keno-bet-amount-input') {
        let newBet = parseFloat(kenoBetAmountInput.value) || KENO_MIN_BET;
        if (newBet < KENO_MIN_BET) newBet = KENO_MIN_BET; 
        
        kenoTotalPoints = currentScore; // âœ… á‹¨ Firebase coináŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        if (newBet > kenoTotalPoints) newBet = kenoTotalPoints;
        
        kenoBetAmount = newBet;
        kenoBetAmountInput.value = newBet.toFixed(0); // .00 áŠ áˆµá‹ˆáŒáŒƒáˆˆáˆ
        window.kenoUpdateUI();
    }
});


window.kenoCreateGrid = () => {
    if (!kenoGridEl) return;
    kenoGridEl.innerHTML = '';
    for (let i = 1; i <= KENO_TOTAL_NUMBERS; i++) {
        const cell = document.createElement('div');
        cell.className = 'number-cell';
        cell.textContent = i;
        cell.dataset.number = i;
        cell.onclick = () => window.kenoSelectNumber(i);
        kenoGridEl.appendChild(cell);
    }
}

window.kenoSelectNumber = (number) => {
    if (kenoGameInProgress) return;
    const index = kenoSelectedNumbers.indexOf(number);
    const cell = document.querySelector(`#keno-game-page [data-number="${number}"]`);

    if (index > -1) {
        kenoSelectedNumbers.splice(index, 1);
        cell.classList.remove('selected');
    } else if (kenoSelectedNumbers.length < KENO_MAX_PICKS) {
        kenoSelectedNumbers.push(number);
        cell.classList.add('selected'); 
        window.playSound('click'); // âœ… á‹µáˆáŒ½ á‰°á‰€á‹­áˆ¯áˆ
    } else {
        kenoMessageEl.textContent = `á‰¢á‰ á‹› ${KENO_MAX_PICKS} á‰áŒ¥áˆ®á‰½ á‰¥á‰» áˆ˜áˆáˆ¨áŒ¥ á‹­á‰½áˆ‹áˆ‰á¢`;
    }
    window.kenoUpdateUI();
}

window.kenoRandomSelect = (count) => {
    if (kenoGameInProgress) return;
    window.kenoResetSelection(); 

    const allNumbers = Array.from({ length: KENO_TOTAL_NUMBERS }, (_, i) => i + 1);
    allNumbers.sort(() => Math.random() - 0.5); 
    const picks = allNumbers.slice(0, count);
    
    picks.forEach(num => window.kenoSelectNumber(num));
    kenoMessageEl.textContent = `á‰ á‹˜áˆá‰€á‹° ${count} á‰áŒ¥áˆ®á‰½ á‰°áˆ˜áˆ­áŒ á‹‹áˆá¢ BET á‹­áŒ«áŠ‘á¢`;
    window.kenoUpdateUI();
}

window.kenoResetSelection = () => {
    kenoSelectedNumbers.forEach(num => {
         const cell = document.querySelector(`#keno-game-page [data-number="${num}"]`);
         if (cell) cell.classList.remove('selected');
    });
    kenoSelectedNumbers = [];
}

// ------------------- KENO ASYNC GAME FLOW -------------------

window.kenoStartGame = async () => {
    if (kenoGameInProgress) return;
    
    kenoBetAmount = parseFloat(kenoBetAmountInput.value);
    kenoTotalPoints = currentScore; // âœ… á‹¨á‰…áˆ­á‰¥ áŒŠá‹œ coináŠ• áŠ¨ Firebase áˆ›áŠ•á‰ á‰¥

    if (kenoBetAmount < KENO_MIN_BET || kenoBetAmount > kenoTotalPoints) { 
        kenoMessageEl.textContent = `á‰µáŠ­áŠ­áˆˆáŠ› á‹¨á‹áˆ­áˆ­á‹µ áˆ˜áŒ áŠ• á‹«áˆµáŒˆá‰¡ (Min ${KENO_MIN_BET} Coin)!`;
        return;
    }
    if (kenoSelectedNumbers.length === 0) {
         kenoMessageEl.textContent = "áŠ¥á‰£áŠ­á‹áŠ• á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰áŒ¥áˆ­ á‹­áˆáˆ¨áŒ¡á¢";
         return;
    }

    kenoGameInProgress = true;
    kenoBetBtn.disabled = true;
    kenoMessageEl.textContent = `á‹áˆ­áˆ­á‹µ á‰ áˆ›áˆµáŒˆá‰£á‰µ áˆ‹á‹­...`;
    
    // âœ… 1. coináŠ• áŠ¨ Firebase áˆ˜á‰€áŠáˆµ
    const success = await updateScore(kenoBetAmount * -1, 'Keno Bet');
    
    if (!success) {
        // áˆ˜á‰€áŠáˆ± áŠ«áˆá‰°áˆ³áŠ« (áˆˆáˆáˆ³áˆŒ: á‰ á‰‚ coin áŠ¨áˆŒáˆˆ)
        kenoGameInProgress = false;
        kenoMessageEl.textContent = "âŒ á‹áˆ­áˆ­á‹µ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢";
        window.kenoUpdateUI(); // UIáŠ• áˆ›á‹˜áˆ˜áŠ•
        return;
    }
    
    // âœ… 2. áˆ˜á‰€áŠáˆ± áŠ¨á‰°áˆ³áŠ« áŒ¨á‹‹á‰³á‹áŠ• áˆ˜á‰€áŒ áˆ
    window.playSound('kenoBet'); // ğŸ¶ áŠ á‹²áˆµ á‹µáˆáŒ½
    
    kenoTotalPoints = currentScore; // áŠ á‹²áˆ±áŠ• (á‹¨á‰€áŠáˆ°á‹áŠ•) coin áˆ˜á‹«á‹
    kenoLastBetAmount = kenoBetAmount; 
    kenoLastSelectedNumbers = [...kenoSelectedNumbers]; 
    kenoDrawnNumbers = [];
    
    window.kenoShowTab('keno-live-tab'); 

    kenoGridEl.style.width = '60%'; 
    kenoDrawShakerAreaEl.style.display = 'flex';
    
    document.getElementById('keno-bet-controls').style.display = 'none';
    kenoRandomPickBtn.style.display = 'none';
    
    window.kenoToggleGridInteraction(false);
    window.kenoUpdateUI(); // á‹¨ coin áˆ›áˆ³á‹«á‹áŠ• á‹«á‹˜áˆáŠ“áˆ
    
    kenoDrawStatusEl.textContent = 'á‰ áˆ‚á‹°á‰µ áˆ‹á‹­...';
    kenoMessageEl.textContent = `á‹áˆ­áˆ­á‹µá‹ á‰°á‰€á‰£á‹­áŠá‰µ áŠ áŒáŠá‰·áˆá¢ áŠ¥áŒ£á‹ á‰ áˆ‚á‹°á‰µ áˆ‹á‹­ áŠá‹á¢`;

    const allNumbers = Array.from({ length: KENO_TOTAL_NUMBERS }, (_, i) => i + 1);
    allNumbers.sort(() => Math.random() - 0.5); 
    const winningNumbers = allNumbers.slice(0, KENO_DRAW_COUNT);

    window.kenoStartLiveDraw(winningNumbers);
}

window.kenoStartLiveDraw = (winningNumbers) => {
    let drawIndex = 0;
    kenoCurrentBallAreaEl.textContent = '?';
    
    const drawInterval = setInterval(() => {
        if (drawIndex >= KENO_DRAW_COUNT) {
            clearInterval(drawInterval);
            setTimeout(window.kenoFinishGame, 1500); // á‰µáŠ•áˆ½ á‰†á‹­á‰¶ á‹áŒ¤á‰±áŠ• á‹«áˆ³á‹«áˆ
            return;
        }
        
        const drawnNumber = winningNumbers[drawIndex];
        kenoDrawnNumbers.push(drawnNumber);
        
        kenoCurrentBallAreaEl.textContent = drawnNumber;
        kenoDrawCountAreaEl.textContent = `${drawIndex + 1} / ${KENO_DRAW_COUNT}`;

        const cell = document.querySelector(`#keno-game-page [data-number="${drawnNumber}"]`);
        if (cell) {
            cell.classList.add('drawn-cell'); 
            if (kenoSelectedNumbers.includes(drawnNumber)) {
                cell.classList.add('match'); 
                window.playSound('kenoDraw'); // ğŸ¶ áŠ á‹²áˆµ á‹µáˆáŒ½
            }
        }

        drawIndex++;
    }, KENO_DRAW_INTERVAL);
}

window.kenoFinishGame = async () => {
    const matches = kenoSelectedNumbers.filter(num => kenoDrawnNumbers.includes(num)).length;
    const { winAmount, multiplier } = window.kenoCalculatePayout(matches, kenoLastBetAmount, kenoSelectedNumbers.length);
    
    let resultMessage;
    
    // âœ… 3. á‹«áˆ¸áŠáˆá‹áŠ• coin á‹ˆá‹° Firebase áˆ˜áŒ¨áˆ˜áˆ­
    if (winAmount > 0) {
        window.playSound('kenoWin'); // ğŸ¶ áŠ á‹²áˆµ á‹µáˆáŒ½
        resultMessage = `ğŸ‘ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${matches} á‰°á‹›áˆ›áŒ…! ${multiplier}x á‹«áˆ¸áŠ•á‰: +${winAmount.toFixed(2)} Coin`; 
        await updateScore(winAmount, 'Keno Win'); // async áˆ˜áŒ á‰ á‰…
    } else {
        window.playSound('fail'); // ğŸ¶ á‹¨áˆ½áŠ•áˆá‰µ á‹µáˆáŒ½
        resultMessage = `ğŸ™ áŠ áˆá‰°áˆ³áŠ«áˆá¢ ${matches} á‰°á‹›áˆ›áŒ…á¢ á‹áˆ­áˆ­á‹µ áŒ áá‰·áˆ (-${kenoLastBetAmount.toFixed(2)} Coin)`; 
    }
    
    kenoTotalPoints = currentScore; // âœ… á‹¨áˆ˜áŒ¨áˆ¨áˆ»á‹áŠ• coin áŠ¨ Firebase áˆ›áŠ•á‰ á‰¥
    
    kenoDrawStatusEl.textContent = 'á‹áŒ¤á‰µ: á‰°áŒ áŠ“á‰‹áˆ';
    kenoMessageEl.textContent = resultMessage;
    
    window.kenoSaveHistory(kenoLastSelectedNumbers, kenoDrawnNumbers, kenoLastBetAmount, winAmount);

    setTimeout(window.kenoResetGame, 4000); // áˆˆ 4 áˆ°áŠ¨áŠ•á‹µ á‹áŒ¤á‰±áŠ• á‹«áˆ³á‹«áˆ
}

window.kenoCalculatePayout = (matches, bet, picks) => {
    let payoutTable = {};
    if (picks === 1) payoutTable = { 1: 10 }; 
    else if (picks === 2) payoutTable = { 2: 50 };
    else if (picks === 3) payoutTable = { 2: 1, 3: 100 };
    else if (picks === 4) payoutTable = { 3: 5, 4: 200 }; 
    else if (picks === 5) payoutTable = { 3: 1, 4: 10, 5: 500 }; 
    else if (picks === 6) payoutTable = { 3: 0, 4: 2, 5: 20, 6: 1000 }; 
    else if (picks === 7) payoutTable = { 4: 3, 5: 30, 6: 200, 7: 5000 }; 
    else if (picks === 8) payoutTable = { 4: 1, 5: 10, 6: 80, 7: 500, 8: 10000 }; 
    else if (picks === 9) payoutTable = { 4: 0, 5: 5, 6: 40, 7: 250, 8: 2000, 9: 15000 };
    else if (picks === 10) payoutTable = { 3: 1, 4: 2, 5: 10, 6: 50, 7: 100, 8: 500, 9: 5000, 10: 25000 };
    
    const multiplier = payoutTable[matches] || 0;
    const winAmount = bet * multiplier;
    return { winAmount, multiplier };
}

// ------------------- KENO HISTORY (localStorage) -------------------
window.kenoSaveHistory = (picks, drawn, bet, win) => {
    const newId = kenoGameHistory.length > 0 ? kenoGameHistory[0].id + 1 : 1;
    const entry = {
        id: newId, 
        date: new Date().toLocaleTimeString(),
        picks: picks.sort((a, b) => a - b),
        drawn: drawn.sort((a, b) => a - b),
        bet: bet.toFixed(2),
        win: win.toFixed(2),
        result: win > 0 ? 'WIN' : 'LOSS'
    };
    kenoGameHistory.unshift(entry); 
    if (kenoGameHistory.length > 10) kenoGameHistory.pop(); 
    localStorage.setItem('kenoHistory', JSON.stringify(kenoGameHistory));
    window.kenoRenderHistory();
}

window.kenoRenderHistory = () => {
    if (!kenoHistoryListEl) return;
    if (kenoGameHistory.length === 0) {
        kenoHistoryListEl.innerHTML = '<p style="text-align: center;">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</p>';
        return;
    }
    kenoHistoryListEl.innerHTML = '';
    kenoGameHistory.forEach(entry => {
        const div = document.createElement('div');
        const resultClass = entry.result === 'WIN' ? 'win' : 'loss';
        div.className = `keno-history-card ${resultClass}`;
        div.innerHTML = `
            <div class="card-header">
                <span class="game-id">Game #${entry.id} <span class="game-date">(${entry.date})</span></span>
                <span class="game-result ${resultClass}">${entry.result}</span>
            </div>
            <div class="card-body">
                <p><strong>Picks (${entry.picks.length}):</strong> <span class="pick-list">${entry.picks.join(', ')}</span></p>
                <p><strong>Result:</strong> ${entry.result === 'WIN' ? `Won +${entry.win}` : `Lost -${entry.bet}`} Coin</p>
                <details>
                    <summary>Show Drawn Numbers</summary>
                    <p class="drawn-list">${entry.drawn.join(', ')}</p>
                </details>
            </div>
        `;
        kenoHistoryListEl.appendChild(div);
    });
}

// ------------------- KENO UTILITY FUNCTIONS -------------------
window.kenoToggleGridInteraction = (enabled) => {
    document.querySelectorAll('#keno-game-page .number-cell').forEach(cell => {
        cell.classList.toggle('disabled', !enabled);
    });
}

window.kenoResetGame = () => {
    kenoGameInProgress = false;
    kenoSelectedNumbers = []; 
    
    document.querySelectorAll('#keno-game-page .number-cell').forEach(cell => {
        cell.classList.remove('selected', 'drawn-cell', 'match', 'disabled');
    });
    
    window.kenoShowTab('keno-live-tab'); 

    kenoDrawShakerAreaEl.style.display = 'none';
    kenoGridEl.style.width = '100%'; 

    document.getElementById('keno-bet-controls').style.display = 'flex';
    kenoRandomPickBtn.style.display = 'block';
    
    kenoDrawStatusEl.textContent = 'Waiting...';
    kenoCurrentBallAreaEl.textContent = '?';
    kenoDrawCountAreaEl.textContent = '0 / 20';
    
    window.kenoToggleGridInteraction(true);
    
    // âœ… á‹¨ Firebase coináŠ• áŠ¥áŠ•á‹°áŒˆáŠ“ áˆ˜áŒ«áŠ•
    kenoTotalPoints = currentScore;
    kenoBetAmount = KENO_MIN_BET; // á‹áˆ­áˆ­á‹µáŠ• á‹ˆá‹° á‹á‰…á‰°áŠ›á‹ áˆ˜áˆ˜áˆˆáˆµ
    
    window.kenoUpdateUI();
}

// ======================================================================
// âœ… ğŸ›‘ á‹¨ KENO GAME LOGIC áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================


// ======================================================================
// ======================================================================
// âœ… ğŸ›‘ á‹¨áˆ˜áŒ¨áˆ¨áˆ»á‹ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Staking Game Logic (FULL VERSION)
// ======================================================================
// ======================================================================

// á‹¨ Stake á•áˆ‹áŠ–á‰½
const STAKING_PLANS = [
    // ğŸ›‘ á•áˆ‹áŠ• 1: 0.10 á‰°á‰€á‹­áˆ® á‹ˆá‹° 0.20 (20% á‹ˆáˆˆá‹µ)
    { id: 1, title: "Bronze Plan", amount: 10000, duration_hours: 24, interest_rate: 0.20 },
    // ğŸ›‘ á•áˆ‹áŠ• 2: 0.12 á‰°á‰€á‹­áˆ® á‹ˆá‹° 0.25 (25% á‹ˆáˆˆá‹µ)
    { id: 2, title: "Silver Plan", amount: 50000, duration_hours: 24, interest_rate: 0.25 },
    // ğŸ›‘ á•áˆ‹áŠ• 3: 0.15 á‰°á‰€á‹­áˆ® á‹ˆá‹° 0.30 (30% á‹ˆáˆˆá‹µ)
    { id: 3, title: "Gold Plan", amount: 100000, duration_hours: 24, interest_rate: 0.30 }
];

let stakeCooldownInterval = null; 

// ====================================================
// Navigation Fix
// ====================================================

window.showMainLobby = () => {
    
    document.querySelectorAll('.game-page-container').forEach(page => {
        page.style.display = 'none';
    });

    const mainPage = document.getElementById('tasks-page');
    if (mainPage) {
        mainPage.style.display = 'block';
    }
    
    const rootContainer = document.getElementById('root');
    if (rootContainer) {
        rootContainer.style.display = 'block';
    }

    const navBar = document.getElementById('nav-bar');
    if (navBar) {
        navBar.style.display = 'flex';
    }
    
    document.querySelectorAll('#nav-bar .nav-item').forEach(item => {
        item.classList.remove('active');
    });
    const tasksNav = document.getElementById('nav-tasks');
    if (tasksNav) {
        tasksNav.classList.add('active');
    }
};

// ====================================================
// History Functions
// ====================================================

const getStakeHistory = () => {
    try {
        const history = localStorage.getItem('stakeHistory');
        return JSON.parse(history || '[]');
    } catch (e) {
        console.error("Error loading stake history:", e);
        return [];
    }
};

window.saveStakeHistory = (type, amount, note) => {
    let stakeGameHistory = getStakeHistory(); 
    
    const newId = stakeGameHistory.length > 0 ? (stakeGameHistory[0].id + 1) : 1;
    const entry = {
        id: newId, 
        date: new Date().toLocaleString(), 
        type: type, 
        amount: amount,
        note: note
    };
    stakeGameHistory.unshift(entry); 
    if (stakeGameHistory.length > 20) stakeGameHistory.pop(); 
    localStorage.setItem('stakeHistory', JSON.stringify(stakeGameHistory));
    window.renderStakeHistory();
}

window.renderStakeHistory = () => {
    const historyListEl = document.getElementById('stake-history-list');
    if (!historyListEl) return;
    
    const stakeGameHistory = getStakeHistory(); 
    
    if (stakeGameHistory.length === 0) {
        historyListEl.innerHTML = '<p style="text-align: center; color: var(--stake-text-secondary);">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</p>';
        return;
    }
    
    historyListEl.innerHTML = '';
    stakeGameHistory.forEach(entry => {
        const div = document.createElement('div');
        const typeClass = entry.type === 'Stake' ? 'stake' : 'claim';
        const amountSign = entry.type === 'Stake' ? '-' : '+';
        
        div.className = `stake-history-card ${typeClass}`;
        div.innerHTML = `
            <div class="card-header">
                <span class="action-type">${entry.type}</span>
                <span class="action-amount ${typeClass}">${amountSign}${entry.amount.toLocaleString()} Coin</span>
            </div>
            <div class="card-body">
                <strong>${entry.note}</strong><br>
                <span class="action-date">${entry.date}</span>
            </div>
        `;
        historyListEl.appendChild(div);
    });
}
// ====================================================
// ğŸ“¢ á‹¨áŒáˆ áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰°áŒá‰£áˆ­ (Timed & Skippable Ad Logic)
// ====================================================

/**
 * âœ… áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áŠ¨áŒˆáŒ¹ áˆ‹á‹­ áˆ™áˆ‰ á‰ áˆ™áˆ‰ á‹¨áˆšá‹«áŒ á‹ á‰°áŒá‰£áˆ­
 */
window.removeSelfAd = () => {
    const adContainer = document.getElementById('self-ad-banner-container');
    if (adContainer) {
        // á‹¨áŒ á‹á‰ á‰µáŠ• áˆáŠ­áŠ•á‹«á‰µ áˆˆáˆ›áˆ³á‹¨á‰µ (áˆˆáŒŠá‹œá‹ á‰£á‹¶ áŠ¥áŠ“á‹°áˆ­áŒˆá‹‹áˆˆáŠ•)
        adContainer.innerHTML = ''; 
        adContainer.style.display = 'none';
    }
};

window.loadSelfAd = (containerId) => {
    // ğŸ›‘ á‹¨áŠ¥áˆ­áˆµá‹ á‹¨áˆ›áˆµá‰³á‹ˆá‰‚á‹« áˆ˜áˆ¨áŒƒ
    const adData = {
        title: "á‹¨áŠ á‹³áˆ› á‹¨áˆµáˆ« áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰»áŠ“áˆ á‹­á‰€áˆ‹á‰€áˆ‰!",
        imageUrl: "https://tame3232.github.io/2/adama-jobs-ad.jpg", // âœ… lowercase áŠ• áˆ˜áŒ á‰€áˆ!
        linkUrl: "https://t.me/adama_jobss",
        callToAction: "á‹­á‰€áˆ‹á‰€áˆ‰!"
    };

    const AD_DURATION_MS = 30000; // ğŸ›‘ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ á‹¨áˆšá‰†á‹­á‰ á‰µ áŒ á‰…áˆ‹áˆ‹ áŒŠá‹œ (30 áˆ°áŠ¨áŠ•á‹µ)
    const SKIP_DELAY_MS = 5000;  // ğŸ›‘ á‹¨ Skip Button á‹¨áˆšá‰³á‹­á‰ á‰µ áŒŠá‹œ (5 áˆ°áŠ¨áŠ•á‹µ)

    const adContainer = document.getElementById(containerId);
    if (!adContainer) return;

    // 1. áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• á‰  HTML á‹áˆµáŒ¥ áˆ›áˆµáŒˆá‰£á‰µ
    adContainer.style.display = 'block';
    adContainer.innerHTML = `
        <div id="self-ad-content" style="position: relative; margin-top: 15px; margin-bottom: 20px;
    border: 2px solid var(--glow-secondary); 
    animation: spinBorder 2.5s infinite alternate ease-in-out; ">

            <a href="${adData.linkUrl}" target="_blank" 
                style="display: flex; 
                       flex-direction: column; 
                       justify-content: center;
                       align-items: flex-start;
                       min-height: 80px; 
                       padding: 10px; 
                       border-radius: 10px; 
                       text-decoration: none; 
                       color: #ffffff;
                       position: relative; 
                       background-image: url(${adData.imageUrl});
                       background-size: cover; 
                       background-position: center; 
                       background-repeat: no-repeat;">
                       
                <div style="position: absolute; 
                            top: 0; 
                            left: 0; 
                            width: 100%; 
                            height: 100%; 
                            background-color: #00000060; 
                            border-radius: 10px;">
                </div>
                
                <div style="flex-grow: 1; z-index: 2; position: relative;"> 
                    <h4 style="margin: 0; font-size: 15px; font-weight: 700; color: #ffffff;">${adData.title}</h4>
                    <p style="margin: 0; font-size: 13px; color: #ffffff;">${adData.callToAction}</p>
                </div>
            </a>
            
            <button id="skipAdButton" 
                style="display: none; position: absolute; top: 5px; right: 5px; background-color: #000000a0; color: #fff; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; font-size: 12px; z-index: 10;">
                Skip Ad â­ï¸
            </button>
        </div>
    `;

    // 2. ğŸ›‘ á‹ˆá‹²á‹«á‹áŠ‘ á‹¨ 30 áˆ°áŠ¨áŠ•á‹±áŠ• áˆ›áŒ¥áŠá‹« Timer áŠ¥áŠ•áŒ€áˆáˆ«áˆˆáŠ• (áˆµáˆ…á‰°á‰µ á‰¢áˆáŒ áˆ­áˆ áŠ¥áŠ•á‹²áˆ°áˆ«)
    let skipTimer; // á‹­áˆ…áŠ•áŠ• áŠ¨á‰³á‰½ áŠ¥áŠ•áŒ€áˆáˆ¨á‹‹áˆˆáŠ•
    
    const autoRemoveTimer = setTimeout(() => {
        window.removeSelfAd();
        // SkipTimer áˆŠáŠ–áˆ­áˆ áˆ‹á‹­áŠ–áˆ­áˆ áˆµáˆˆáˆšá‰½áˆá£ áŠ«áˆˆ á‰¥á‰» áŠ¥áŠ“áŒ¸á‹³á‹‹áˆˆáŠ•
        if (skipTimer) {
             clearTimeout(skipTimer);
        }
    }, AD_DURATION_MS);

    // 3. áŠ¨áŒ¥á‰‚á‰µ áŒŠá‹œ á‰ áŠ‹áˆ‹ (100ms) á‹¨ Skip Button áŠ• áŠ¥áŠ•áˆáˆáŒ‹áˆˆáŠ•
    setTimeout(() => {
        const skipButton = document.getElementById('skipAdButton');
        
        if (!skipButton) return; // áŠ á‹áˆ«áˆ© áŠ«áˆá‰°áŒˆáŠ˜ á‹­áˆ„ Logic á‹­á‰†áˆ›áˆá£ áŒáŠ• 30s Timer á‹­áˆ°áˆ«áˆ

        // Skip Button áŠ¨ 5 áˆ°áŠ¨áŠ•á‹µ á‰ áŠ‹áˆ‹ áŠ¥áŠ•á‹²á‰³á‹­ á‹«á‹µáˆ­áŒ‰
        skipTimer = setTimeout(() => {
            skipButton.style.display = 'block';
            skipButton.innerText = 'Skip Ad â­ï¸';
        }, SKIP_DELAY_MS);
        
        // Skip Button áˆ²áŒ«áŠ• áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• á‹ˆá‹²á‹«á‹áŠ‘ áŠ¥áŠ•á‹²á‹«áŒ á‹ á‹«á‹µáˆ­áŒ‰
        skipButton.onclick = () => {
            clearTimeout(skipTimer);
            clearTimeout(autoRemoveTimer);
            window.removeSelfAd();
        };
        
    }, 100); // 100 áˆšáˆŠ áˆ°áŠ¨áŠ•á‹µ áŠ¥áŠ•áŒ á‰¥á‰ƒáˆˆáŠ•

};


// ====================================================
// Staking Logic
// ====================================================

window.showStakeTab = (tabId, clickedButton) => {
    document.querySelectorAll('#staking-page .stake-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('#staking-page .stake-tab-button').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('active');
    if (clickedButton) {
        clickedButton.classList.add('active');
    }
    
    if (tabId === 'stake-history-tab') {
        window.renderStakeHistory();
    }
}


/**
 * á‹¨ Stake áŒˆáŒ½ áˆ²áŠ¨áˆá‰µ UI áŠ• á‹«á‹‹á‰…áˆ«áˆ
 * ğŸ›‘ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ áŠ¥á‹šáˆ… á‹­áŒ áˆ«áˆ
 */
window.initStakingPage = () => {
    if (typeof currentUserDocData === 'undefined' || !currentUserDocData) return;

    if (stakeCooldownInterval) {
        clearInterval(stakeCooldownInterval);
        stakeCooldownInterval = null;
    }

    document.getElementById('stake-total-points').textContent = `${currentScore.toLocaleString()} Coin`;
    
    window.updateStakingUI();
    
    // ğŸ›‘ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜áŒ¥áˆ«á‰µ
    window.loadSelfAd('self-ad-banner-container');
    
    window.showStakeTab('stake-live-tab', document.querySelector('#stake-tab-navigation .stake-tab-button'));
}

window.updateStakingUI = () => {
    const inputCard = document.getElementById('staking-input-card');
    const claimCard = document.getElementById('staking-claim-card');
    const stakedAmount = currentUserDocData.staked_amount || 0;
    const stakeStartTime = currentUserDocData.stake_start_time; // Firebase Timestamp

    if (stakedAmount > 0 && stakeStartTime) {
        inputCard.style.display = 'none';
        claimCard.style.display = 'block';
        window.startStakeClaimTimer(stakedAmount, stakeStartTime);
    } else {
        inputCard.style.display = 'block';
        claimCard.style.display = 'none';
        window.renderStakePlans(); 
    }
    
    document.getElementById('stake-total-points').textContent = `${currentScore.toLocaleString()} Coin`;
}

window.renderStakePlans = () => {
    const plansContainer = document.getElementById('stake-plans-container');
    if (!plansContainer) return;
    
    plansContainer.innerHTML = ''; 
    
    STAKING_PLANS.forEach(plan => {
        const canAfford = typeof currentScore !== 'undefined' && currentScore >= plan.amount;
        const returnAmount = plan.amount * (1 + plan.interest_rate);
        
        const planCard = document.createElement('div');
        planCard.className = `stake-plan-card ${canAfford ? '' : 'disabled'}`;
        planCard.innerHTML = `
            <div class="plan-header">
                <div class="plan-title">${plan.title}</div>
                <div class="plan-rate">+${plan.interest_rate * 100}%</div>
            </div>
            <div class="plan-details">
                Stake: <span>${plan.amount.toLocaleString()} Coin</span><br>
                Duration: <span>${plan.duration_hours} Hours</span><br>
                Return: <span>${returnAmount.toLocaleString()} Coin</span>
            </div>
        `;
        
        if (canAfford) {
            planCard.onclick = () => window.handleStakeClick(plan);
        } else {
            planCard.onclick = () => {
                document.getElementById('stakeInputMessage').innerText = `âŒ á‹­áˆ…áŠ• á•áˆ‹áŠ• áˆˆáˆ˜áŒ á‰€áˆ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢`;
            }
        }
        
        plansContainer.appendChild(planCard);
    });
}

/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ: á‹¨ Claim áŠ«áˆ­á‹µ áˆ°á‹“á‰µ á‰†áŒ£áˆª áŠ¨ Progress Bar áŒ‹áˆ­
 */
window.startStakeClaimTimer = (stakedAmount, stakeStartTime) => {
    const stakedAmountDisplay = document.getElementById('stakedAmountDisplay');
    const claimButton = document.getElementById('stakeClaimButton');
    const timerDisplay = document.getElementById('stakeCooldownTimer');
    const returnMsg = document.getElementById('stakeReturnMessage');
    const progressBar = document.getElementById('stakeProgressBar'); 
    const accruedDisplay = document.getElementById('accruedInterestDisplay'); 

    const durationHours = currentUserDocData.stake_duration_hours || 24;
    const durationMs = durationHours * 60 * 60 * 1000;
    const interestRate = currentUserDocData.stake_interest_rate || 0.20;
    
    // áŒ á‰…áˆ‹áˆ‹ á‹¨áˆšáŒˆáŠ˜á‹ á‰µáˆ­á (Total Profit)
    const totalProfit = stakedAmount * interestRate;
    const returnAmount = stakedAmount + totalProfit;

    stakedAmountDisplay.innerText = stakedAmount.toLocaleString();
    returnMsg.innerText = `+${returnAmount.toLocaleString()} Coin`;

    const updateTimer = () => {
        const now = new Date();
        const startTime = stakeStartTime.toDate ? stakeStartTime.toDate() : new Date(stakeStartTime);
        const elapsedMs = now.getTime() - startTime.getTime(); // á‹«áˆˆáˆá‹ áŒŠá‹œ
        const remainingMs = durationMs - elapsedMs; // á‹¨á‰€áˆ¨á‹ áŒŠá‹œ

        // 1. á‹¨áˆ‚á‹°á‰µ áŠ áˆáˆŒ áˆ›áˆµáˆ‹á‰µ (Progress Percentage)
        let progressPercent = (elapsedMs / durationMs) * 100;
        if (progressPercent > 100) progressPercent = 100;
        if (progressBar) progressBar.style.width = `${progressPercent}%`;

        // 2. áŠ¥áˆµáŠ«áˆáŠ• á‹¨á‰°áŒ áˆ«á‰€áˆ˜ á‹ˆáˆˆá‹µ áˆ›áˆ³á‹¨á‰µ (Accrued Interest) - áˆˆá‹•á‹­á‰³ á‰¥á‰»
        let accrued = (totalProfit * (progressPercent / 100));
        if (accruedDisplay) accruedDisplay.innerText = `+${accrued.toFixed(2)}`;

        // 3. áŒŠá‹œá‹ áŠ«áˆˆá‰€
        if (remainingMs <= 0) {
            timerDisplay.innerText = "âœ… Completed!";
            timerDisplay.style.color = "var(--et-green)";
            
            claimButton.disabled = false;
            claimButton.innerText = `CLAIM ${returnAmount.toLocaleString()} COIN`;
            claimButton.style.backgroundColor = "var(--et-green)";
            claimButton.style.boxShadow = "0 0 15px rgba(76, 175, 80, 0.5)"; // á‹¨áˆšá‹«á‰ áˆ« áŠ á‹áˆ«áˆ­
            
            if (stakeCooldownInterval) clearInterval(stakeCooldownInterval);
        } else {
            // áŒŠá‹œá‹ áŠ«áˆ‹áˆˆá‰€
            timerDisplay.innerText = formatTime(remainingMs); 
            timerDisplay.style.color = "var(--tg-text)";
            
            claimButton.disabled = true;
            claimButton.innerText = "LOCKED ğŸ”’";
            claimButton.style.backgroundColor = "#555";
            claimButton.style.boxShadow = "none";
        }
    };

    updateTimer(); 
    if (window.stakeCooldownInterval) clearInterval(window.stakeCooldownInterval);
    window.stakeCooldownInterval = setInterval(updateTimer, 1000); 
}


/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ: "Claim Reward" á‰°áŒá‰£áˆ­ (Safe & Animated)
 */
window.handleClaimStakeClick = async () => {
    const claimButton = document.getElementById('stakeClaimButton');
    
    if (claimButton.disabled || claimButton.getAttribute('data-processing') === 'true') return; 

    claimButton.setAttribute('data-processing', 'true');
    claimButton.disabled = true;
    claimButton.innerText = "Processing... ğŸ”„";

    const stakedAmount = currentUserDocData.staked_amount || 0;
    const interestRate = currentUserDocData.stake_interest_rate || 0.20; 
    
    if (stakedAmount === 0) {
        claimButton.innerText = "Error: No Stake";
        claimButton.removeAttribute('data-processing');
        return;
    }

    const rewardAmount = stakedAmount * interestRate;
    const totalReturn = Math.floor(stakedAmount + rewardAmount); 

    if (typeof db === 'undefined' || !currentFirebaseUserId) {
         WebApp.showAlert("Connection Error.");
         return;
    }

    const userRef = doc(db, "users", currentFirebaseUserId);
    
    try {
        await updateDoc(userRef, {
            total_score: increment(totalReturn), 
            staked_amount: 0,                  
            stake_start_time: null,
            stake_duration_hours: null,
            stake_interest_rate: null
        });

        window.playSound('win');
        window.triggerConfetti(totalReturn); 
        
        window.saveStakeHistory('Claim', totalReturn, `+${(interestRate*100).toFixed(0)}% Profit`);
        
        currentScore += totalReturn;
        currentUserDocData.staked_amount = 0;
        currentUserDocData.stake_start_time = null;
        
        window.updateStakingUI(); 
        window.renderPageContent(); 

        WebApp.showAlert(`ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${totalReturn.toLocaleString()} Coin á‹ˆá‹° áˆ‚áˆ³á‰¥á‹ áŒˆá‰¥á‰·áˆ!`);

    } catch (error) {
        console.error("Claim Error:", error);
        claimButton.disabled = false;
        claimButton.innerText = "RETRY CLAIM";
        claimButton.removeAttribute('data-processing');
        WebApp.showAlert(`âŒ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ: ${error.message}`);
    }
}


/**
 * "Stake Now" (á•áˆ‹áŠ• áˆ²áˆ˜áˆ­áŒ¥)
 */
window.handleStakeClick = async (plan) => {
    const stakeInputMessage = document.getElementById('stakeInputMessage');
    
    if (plan.amount > currentScore) {
        stakeInputMessage.innerText = `âŒ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢`;
        return;
    }

    document.querySelectorAll('#staking-page .stake-plan-card').forEach(card => {
        card.style.pointerEvents = 'none';
        card.style.opacity = '0.5';
    });
    stakeInputMessage.innerText = "Staking...";

    const userRef = doc(db, "users", currentFirebaseUserId);
    try {
        await updateDoc(userRef, {
            total_score: increment(plan.amount * -1), 
            staked_amount: plan.amount,              
            stake_start_time: serverTimestamp(),       
            stake_duration_hours: plan.duration_hours,
            stake_interest_rate: plan.interest_rate
        });
        
        const successMessage = `âœ… ${plan.amount.toLocaleString()} Coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ Stake á‰°á‹°áˆ­áŒ“áˆ!`;
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.showAlert) {
            WebApp.showAlert(successMessage);
        } else {
            alert(successMessage);
        }
        
        window.playSound('win');
        
        window.saveStakeHistory('Stake', plan.amount, plan.title);

        currentScore -= plan.amount;
        currentUserDocData.staked_amount = plan.amount;
        currentUserDocData.stake_start_time = { toDate: () => new Date() }; 
        currentUserDocData.stake_duration_hours = plan.duration_hours;
        currentUserDocData.stake_interest_rate = plan.interest_rate;
        
        updateStakingUI(); 
        renderPageContent(); 

    } catch (error) {
        stakeInputMessage.innerText = `âŒ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ: ${error.message}`;
        window.renderStakePlans(); 
    }
}







// ======================================================================
//  Staking Game Logic áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================

// ======================================================================
// âœ… DAILY CIPHER GAME LOGIC
// ======================================================================
const DAILY_CIPHER_CODE = "SMART"; // ğŸ›‘ á‹­áˆ…áŠ•áŠ• á‰ á‹¨á‰€áŠ‘ áŠ¨ Firebase á‹ˆá‹­áˆ áŠ¥á‹šáˆ áˆ˜á‰€á‹¨áˆ­ á‰µá‰½áˆ‹áˆˆáˆ…
const CIPHER_REWARD = 50000; 

window.submitDailyCipher = async () => {
    const inputEl = document.getElementById('cipher-input');
    const messageEl = document.getElementById('cipher-message');
    const userCode = inputEl.value.toUpperCase().trim();
    const timestampField = 'last_daily_cipher_time';

    // 1. Cooldown áˆ˜áˆá‰°áˆ½
    const { isReady } = checkDailyLimit(timestampField);
    if (!isReady) {
        messageEl.innerText = "âŒ áˆˆá‹›áˆ¬ áŒ¨áˆ­áˆ°á‹‹áˆ! áŠáŒˆ á‹­áˆ˜áˆˆáˆ±á¢";
        messageEl.style.color = "var(--et-red)";
        return;
    }

    // 2. áŠ®á‹±áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    if (userCode === DAILY_CIPHER_CODE) {
        // á‰µáŠ­áŠ­áˆ áŠ¨áˆ†áŠ
        window.playSound('win');
        const success = await updateScore(CIPHER_REWARD, 'Daily Cipher', timestampField);
        
        if (success) {
            messageEl.innerText = `ğŸ‰ á‰µáŠ­áŠ­áˆ! +${CIPHER_REWARD.toLocaleString()} Coin áŠ áŒáŠá‰°á‹‹áˆ!`;
            messageEl.style.color = "var(--et-green)";
            inputEl.value = "";
            
            // Cooldown áˆ›áˆµáŒ€áˆ˜áˆ­
            startCooldownTimer(timestampField, 'daily-cipher-timer', 'cipher-submit-btn');
            renderPageContent();
        }
    } else {
        // áˆµáˆ…á‰°á‰µ áŠ¨áˆ†áŠ
        window.playSound('fail');
        messageEl.innerText = "âŒ á‹¨á‰°áˆ³áˆ³á‰° áŠ®á‹µ! áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢";
        messageEl.style.color = "var(--et-red)";
        inputEl.classList.add('shake-animation');
        setTimeout(() => inputEl.classList.remove('shake-animation'), 500);
    }
};


// ======================================================================
// âœ… MEMORY MATCH GAME LOGIC
// ======================================================================
const MEMORY_ICONS = ['ğŸ’', 'ğŸ’°', 'ğŸš€', 'â‚¿', 'ETH', 'ğŸ²']; // 6 áŒ¥áŠ•á‹¶á‰½ (12 áŠ«áˆ­á‹¶á‰½)
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let matchedPairs = 0;
let memoryTimerInterval;
let memoryTimeLeft = 60;

// âœ… áŠ á‹²áˆµ á‰°áŒá‰£áˆ­: áŒ¨á‹‹á‰³á‹áŠ• áˆˆá‰…á‰€á‹ áˆ²á‹ˆáŒ¡ á‹¨á‰†áŒ£áˆªá‹á‰½áŠ• áˆ›á…á‹³á‰µ
window.cleanupGame = () => {
    if (window.memoryTimerInterval) {
        clearInterval(window.memoryTimerInterval);
        window.memoryTimerInterval = null;
    }
    window.showMainPage();
};

window.startMemoryGame = () => {
    const timestampField = 'last_memory_game_time';
    const messageEl = document.getElementById('memory-message');
    
    // 1. Cooldown áˆ˜áˆá‰°áˆ½
    const { isReady } = checkDailyLimit(timestampField);
    
    if (!isReady) {
        // âœ… á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ áˆáŒ‚áŠ­: áŒˆá‹°á‰¥ áˆ‹á‹­ áŠ¨áˆ†áŠ á‰†áŒ£áˆªá‹áŠ•áˆ áŒ áˆ­á‰°áŠ• áˆ˜áˆá‹•áŠ­á‰µ áŠ¥áŠ“áˆ³á‹«áˆˆáŠ•
        messageEl.innerText = "âŒ Memory Game áˆˆ24 áˆ°á‹“á‰µ áŒˆá‹°á‰¥ áˆ‹á‹­ áŠá‹! áŠáŒˆ á‹­áˆ˜áˆˆáˆ±á¢";
        messageEl.style.color = "var(--et-red)";
        
        // á‰†áŒ£áˆªá‹áŠ• á‹«áˆµáŒ€áˆáˆ«áˆ (áŒŠá‹œá‹áŠ• á‹«áˆ³á‹«áˆ áŠ¥áŠ“ áŠ á‹áˆ«áˆ©áŠ• á‹«áŒá‹³áˆ)
        startCooldownTimer(timestampField, 'memory-game-timer-display', 'memory-start-btn');
        return; 
    }

    // 2. áŒ¨á‹‹á‰³á‹áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ (á‹¨á‰€áˆ¨á‹ áŠ®á‹µá‹)
    const grid = document.getElementById('memory-game-grid');
    const startBtn = document.getElementById('memory-start-btn');
    
    grid.innerHTML = '';
    messageEl.innerText = '';
    startBtn.style.display = 'none';
    let matchedPairs = 0;
    let memoryTimeLeft = 60;
    let hasFlippedCard = false;
    let lockBoard = false;

    // 3. áŠ«áˆ­á‹¶á‰½áŠ• áˆ›á‹°á‰£áˆˆá‰… (Double the icons and shuffle)
    const cardsArray = [...MEMORY_ICONS, ...MEMORY_ICONS];
    cardsArray.sort(() => 0.5 - Math.random());
    // ... (á‹¨á‰€áˆ¨á‹ á‹¨áŠ«áˆ­á‹µ áˆ˜ááŒ áˆªá‹« áŠ®á‹µ á‹­á‰€áŒ¥áˆ‹áˆ)
    
    // 4. HTML áˆ˜ááŒ áˆ­
    cardsArray.forEach(icon => {
        const card = document.createElement('div');
        card.classList.add('memory-card');
        card.dataset.icon = icon;
        
        card.innerHTML = `
            <div class="front-face">${icon}</div>
            <div class="back-face">?</div>
        `;
        
        card.addEventListener('click', flipCard);
        grid.appendChild(card);
    });

    // 5. áˆ°á‹“á‰µ á‰†áŒ£áˆª áˆ›áˆµáŒ€áˆ˜áˆ­
    document.getElementById('memory-game-timer-display').innerText = `Time: ${memoryTimeLeft}s`;
    if (memoryTimerInterval) clearInterval(memoryTimerInterval);
    
    memoryTimerInterval = setInterval(() => {
        memoryTimeLeft--;
        document.getElementById('memory-game-timer-display').innerText = `Time: ${memoryTimeLeft}s`;
        
        if (memoryTimeLeft <= 0) {
            window.endMemoryGame(false);
        }
    }, 1000);
};


function flipCard() {
    if (lockBoard) return;
    if (this === firstCard) return;

    this.classList.add('flip');
    window.playSound('click');

    if (!hasFlippedCard) {
        hasFlippedCard = true;
        firstCard = this;
        return;
    }

    secondCard = this;
    checkForMatch();
}

function checkForMatch() {
    let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

    if (isMatch) {
        disableCards();
        window.playSound('win');
    } else {
        unflipCards();
    }
}

function disableCards() {
    firstCard.removeEventListener('click', flipCard);
    secondCard.removeEventListener('click', flipCard);
    
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');

    resetBoard();
    matchedPairs++;

    if (matchedPairs === MEMORY_ICONS.length) {
        window.endMemoryGame(true);
    }
}

function unflipCards() {
    lockBoard = true;

    setTimeout(() => {
        firstCard.classList.remove('flip');
        secondCard.classList.remove('flip');
        resetBoard();
    }, 1000);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}
window.endMemoryGame = async (isWin) => {
    clearInterval(memoryTimerInterval);
    const messageEl = document.getElementById('memory-message');
    const startBtn = document.getElementById('memory-start-btn');
    const timestampField = 'last_memory_game_time';
    const grid = document.getElementById('memory-game-grid'); // Grid ElementáŠ• áŠ áŒáŠ

    // âœ… á‹ˆáˆ³áŠ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: á‰°áŒ¨áˆ›áˆª áŠ­áˆŠáŠ®á‰½áŠ• á‹ˆá‹²á‹«á‹áŠ‘ áˆˆáˆ˜áŠ¨áˆ‹áŠ¨áˆ áˆ˜á‰†áˆˆá
    grid.style.pointerEvents = 'none';
    
    let scoreToAward = 0;
    
    if (isWin) {
        scoreToAward = 5000;
        messageEl.innerText = `ğŸ‰ áŒ¨áˆ­áˆ°á‹‹áˆ! +${scoreToAward.toLocaleString()} Coin!`;
        window.playSound('win');
    } else {
        messageEl.innerText = "ğŸ˜¢ áŒŠá‹œá‹ áŠ áˆˆá‰€! áŠ áˆá‰°áˆ³áŠ«áˆá¢";
        window.playSound('fail');
    }

    // á‹¨áŒŠá‹œ áŒˆá‹°á‰¡áŠ• (Timestamp) á‹«áˆµáŒ€áˆáˆ«áˆ
    await updateScore(scoreToAward, isWin ? 'Memory Game Win' : 'Memory Game Cooldown', timestampField);
    
    // á‹¨24 áˆ°á‹“á‰µ áŒˆá‹°á‰¡áŠ• á‰ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ á‹«áˆ³á‹«áˆ áŠ¥áŠ“ á‰áˆá‰áŠ• á‹­á‰†áŒ£áŒ áˆ«áˆ
    startCooldownTimer(timestampField, 'memory-game-timer-display', 'memory-start-btn');
    
    // á‹¨áŒ¨á‹‹á‰³á‹áŠ• Grid á‰£á‹¶ áˆ›á‹µáˆ¨áŒ
    grid.innerHTML = '';
    // á‹¨ pointerEvents áŠ• áŠ¥áŠ•á‹°áŒˆáŠ“ áˆˆáˆ›áŠ•á‰ƒá‰µ áŠ á‹«áˆµáˆáˆáŒáˆ áˆáŠ­áŠ•á‹«á‰±áˆ grid.innerHTML = '' á‹«á‹°áˆ­áŒˆá‹‹áˆ
}

        // ======================================================================
        //                         MAIN RENDER FUNCTION
        // ======================================================================

        function renderPageContent() {
            // 1. coin áˆ›áˆ³á‹«á‹á‰½áŠ• á‰  Tasks áŠ¥áŠ“ Profile áŒˆáŒ¾á‰½ áˆ‹á‹­ áˆ›á‹˜áˆ˜áŠ•
            document.getElementById('tasks-score-display').innerText = currentScore.toLocaleString() + ' ğŸ’°'; // ğŸ›‘ score
            
            // 2. Profile Page
            const profileScoreDisplay = document.getElementById('profile-score-display');
            if (profileScoreDisplay) {
                profileScoreDisplay.innerText = currentScore.toLocaleString(); // ğŸ›‘ score
            }
            const profileSmartCoinDisplay = document.getElementById('profile-smart-coin-display');
    if (profileSmartCoinDisplay) {
        profileSmartCoinDisplay.innerText = currentSmartCoinBalance.toLocaleString(); 
    }
            const profileTicketDisplay = document.getElementById('profile-ticket-display'); 
            if (profileTicketDisplay) {
                profileTicketDisplay.innerText = currentTickets.toLocaleString();
            }
            
            const profileBalanceValue = document.querySelector('.profile-stat-box .balance-value');
             if (profileBalanceValue) {
                // áˆˆáŒŠá‹œá‹ coináŠ• áŠ¥áŠ•á‹° áˆá‰µáŠ­ áŒˆáŠ•á‹˜á‰¥ áˆ›áˆ³á‹¨á‰µ (á‹ˆá‹­áˆ áŠ¥áŠ•á‹°áˆáˆˆáŒ‰á‰µ)
                const birrEquivalent = (currentScore / 1000).toFixed(2); // ğŸ›‘ score
                profileBalanceValue.innerText = `${birrEquivalent} á‰¥áˆ­`; 
            }

            // 3. Top Page (Leaderboard) áˆ‹á‹­ áˆ›á‹˜áˆ˜áŠ•
            document.getElementById('top-score-display').innerText = currentScore.toLocaleString() + ' ğŸ’°'; // ğŸ›‘ score
            document.getElementById('top-rank-display').innerText = currentRank; 

            // 4. á‹¨á‰°áŒ á‰ƒáˆš áˆµáˆ áŠ¥áŠ“ áŠ áˆáˆ³áˆ áˆ›áˆ³á‹«
            let username = 'á‰°áŒ«á‹‹á‰½';
            if (currentUserDocData?.username) {
                username = currentUserDocData.username;
            } else {
                 username = getTelegramUsername(); 
            }
            
            const usernameDisplay = document.getElementById('profile-username');
            if (usernameDisplay) {
                usernameDisplay.innerText = username;
            }
            
            const profileAvatar = document.getElementById('profile-avatar');
            if (profileAvatar) {
                profileAvatar.innerHTML = getAvatarHtml(username, currentUserDocData?.photo_url); 
            }
            
            // 5. á‹¨á‰´áˆŒáŒáˆ«áˆ Main ButtonáŠ• áˆ˜á‰†áŒ£áŒ áˆ­
            const isTasksPage = document.getElementById('tasks-page')?.style.display === 'block';

            if (isTasksPage) {
                const { isReady } = checkDailyLimit('last_gift_time');
                if (isReady) {
                    WebApp.MainButton.setText(`ğŸ á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³ (+10 coin)`); 
                    WebApp.MainButton.show();
                    WebApp.MainButton.setParams({ color: '#4CAF50', text_color: '#FFFFFF' });
                } else {
                    WebApp.MainButton.hide();
                }
            } else {
                 WebApp.MainButton.hide();
            }
            
            // ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›á‹˜áˆ˜áŠ•áŠ• áˆ›áˆµáŠ¬á‹µ
            if (isTasksPage && timerIntervals['card_status_update']) {
                updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                // ğŸ›‘ NEW: áˆˆ Slot Game Card
                updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
            }
            
            // ğŸ›‘ NEW: Slot Game UI á‰ áŒˆáŒ¹ áˆ‹á‹­ áŠ«áˆˆ áˆ›á‹˜áˆ˜áŠ•
            if (document.getElementById('slots-game-page')?.style.display === 'block') {
                 window.updateSlotGameUI();
            }


        }


// ======================================================================
//                              INITIALIZATION
// ======================================================================
window.onload = async () => {
    WebApp.ready(); 
    WebApp.setHeaderColor('secondary_bg_color');
    
    
    WebApp.MainButton.onClick(async () => {
        const coinsToAdd = 200; 
        const { isReady } = checkDailyLimit('last_gift_time');
        if (!isReady) {
            WebApp.showAlert(`âŒ á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³ áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
            return;
        }
        await updateScore(coinsToAdd, 'Daily Gift', 'last_gift_time');
    });
    
    await new Promise(resolve => { 
        onAuthStateChanged(auth, async (user) => {
            // ğŸ›‘ === á‹¨á‰´áˆŒáŒáˆ«áˆ ID áŠ áˆ˜áŠ­áŠ•á‹® === ğŸ›‘
            try {
                if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
                    telegramUserId = WebApp.initDataUnsafe.user.id.toString();
                } else {
                    // This is a fallback for testing in a browser
                    telegramUserId = 'TGMOCK-' + Math.floor(Math.random() * 10000); 
                }
                // Set the global variable for the "Copy" button
                window.telegramUserId = telegramUserId; 
            } catch (e) {
                console.error("CRITICAL: Failed to get Telegram User ID.", e);
                WebApp.showAlert("áˆµáˆ…á‰°á‰µ: á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ˜áˆ¨áŒƒáŠ• áˆ›áŒáŠ˜á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢");
            }
            // ğŸ›‘ === á‹¨á‰´áˆŒáŒáˆ«áˆ ID áŠ áˆ˜áŠ­áŠ•á‹® áˆ˜áŒ¨áˆ¨áˆ» === ğŸ›‘

            if (user) {
                currentFirebaseUserId = user.uid;
                // ğŸ›‘ âœ… FIX: á‹ˆáŒª á‰†áŒ£á‰¢ áˆ˜áá‰µáˆ„
                setupCurrentUserListener(user.uid); 
            } else {
                await firebaseLogin(); 
            }
            resolve(); 
        });
    });
    
    switchPage('tasks-page'); 

    // ğŸ›‘ áˆ›áˆ³áˆ°á‰¢á‹«: Loading screen áŠ áˆáŠ• á‹¨áˆšáŒ á‹á‹ setupCurrentUserListener á‹áˆµáŒ¥ áŠá‹
    const loadingContainer = document.getElementById('loading-container');
    // if (loadingContainer) {
    //     loadingContainer.style.opacity = '0';
    //     setTimeout(() => {
    //         loadingContainer.style.display = 'none';
    //     }, 500); 
    // }
};

    </script>
</body>
</html>
